'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1469:function(D,M,d){d.r(M);d.d(M,"RtcUtils",function(){return l});D=d(0);var m=d(8),f=d(1498),a=d(35);class l{static QUe(r,w=f.RealtimeChannel.Vxf){let v;try{v=a.c(r)}catch(u){throw r=String.format("Failed to JSON-serialize payload : {0}",u),m.ULS.sendTraceTag(18637072,500,10,r),Error.argument("payload",r);}if(v.length>w)throw r=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,w),m.ULS.sendTraceTag(18637074,
500,10,r),Error.argument("payload",r);return v}static deserialize(r,w,v){if(!r)return null;if(Object.getType(r)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",w,Object.getType(r).getName(),v);m.ULS.sendTraceTag(18637075,500,10,u);return null}u=null;try{u=a.a(r)}catch(z){r=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",w,z,v),m.ULS.sendTraceTag(18637077,
500,10,r)}return u}static J9b(r){if(!r)return"";if("string"===typeof r)return r.toString();try{return a.c(r)}catch(w){return r.toString()}}static n4k(r){let w,v,u;w=0;u=v=null;if(!r)return{E4h:w,G4h:v,exception:u};try{const z=r.source;z&&Object.getType(z)===String&&(u=z);const B=r.context;B&&(r=B,w=r.status?r.status:0,v=r.statusText?r.statusText:null)}catch(z){}return{E4h:w,G4h:v,exception:u}}}Object(D.a)(l,"RtcUtils",null,[])},1488:function(D,M,d){d.r(M);D=d(0);var m=d(8),f=d(43),a=d(81),l;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(l||(l={}));Object(D.b)("ApiType",l);var r;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(r||(r=
{}));Object(D.b)("EventCountType",r);var w=d(1570);d.d(M,"FrequentLoggingMetrics",function(){return v});class v{constructor(u){this.Coh=this.uGh=null;this.Coi=this.ZIh=0;this.qx=null;this.kOg=this.exe=0;this.hg=u;this.F1l();this.Hne=this.gDg=this.Lxe=!1;this.xqc=0}get D3k(){return this.Hne}B_n(u){this.kOg=u;window.setInterval(Object(f.a)(this,this.nwf,"logMetricsBatchAndReset"),u);this.exe=(new Date).getTime()}UN(u,z){this.UPn(u)&&!this.gDg||this.D3k||!window.navigator.onLine||this.hg.hMa||(this.qx[u][z]++,
this.Lxe=!0)}F1l(){this.qx=Array(3);for(let u=0;3>u;u++){this.qx[u]=Array(7);for(let z=0;7>z;z++)this.qx[u][z]=0}}Fkk(){const u={};for(let z=0;3>z;z++)for(let B=0;7>B;B++)this.glm(z,B)&&(u[l[z]+r[B]]=this.qx[z][B]);u.FSDomain=this.uGh;u.ConnectionDomain=this.Coh;u.FSRetryInterval=this.ZIh;u.MaxPayloadSize=this.Coi;u.LogNumber=this.xqc;1===this.xqc&&(u.FSLatencies=w.a.instance.Xpl(),u.ConLatencies=w.a.instance.Ekl());return u}glm(u,z){return 2===u&&3!==z&&0!==z?!1:!0}UPn(u){return 2===u?!1:!0}nwf(){if(this.Lxe){this.xqc++;
if((new Date).getTime()-this.exe<5E3+this.kOg){var u=a.a.toJSON(this.Fkk());m.ULS.sendTraceTag(50644352,500,15,u)}this.exe=(new Date).getTime();for(u=0;3>u;u++)for(let z=0;7>z;z++)this.qx[u][z]=0;this.Lxe=!1}}NCm(){this.gDg=!0}static get instance(){return v._instance}static create(u){v.instance||(v._instance=new v(u));return v.instance}}v._instance=null;Object(D.a)(v,"FrequentLoggingMetrics",null,[862])},1498:function(D,M,d){d.r(M);D=d(0);var m=d(8),f=d(43),a=d(430),l=d(1637),r=d(82),w=d(2);class v{constructor(oa,
pa){this.status=oa;this.U7b=pa}}Object(D.a)(v,"UserStatusInfo",null,[]);var u=d(46),z=d(1570);class B{constructor(oa,pa){this.data=oa;this.timeStamp=pa}}Object(D.a)(B,"PresenceData",null,[]);class G{constructor(oa){this.aya=!1;this.Atb=0;this.Gje=!1;this.setTimeout=G.l1e;this.clearTimeout=G.c1e;this.mAm=Object(f.a)(this,this.azm,"logRtcConnectingUsageStatement");this.Uv=oa}KOm(){this.aya||(this.Atb=this.setTimeout(()=>{this.aya=!1;this.Pli()},8E3),this.aya=!0,this.Gje=!1)}BPm(){this.ZY()}SVm(){this.Pli()}Pli(){this.ZY();
this.Gje||(this.Gje=!0,this.mAm())}azm(){m.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Uv)}ZY(){this.aya&&this.clearTimeout(this.Atb);this.Atb=0;this.aya=!1}static l1e(oa,pa){return window.setTimeout(oa,pa)}static c1e(oa){window.clearTimeout(oa)}}Object(D.a)(G,"ConnectedUsageKpiLogger",null,[879]);class F{constructor(){this.PIi=this.NOf;this.SIi=this.QOf;this.RIi=this.POf;this.WIi=this.TOf;this.VIi=this.SOf;this.cPf=this.dPf;this.$Of=this.aPf;this.zHb=
this.YOf;this.lWc=this.ZOf;this.QIi=this.OOf;this.mNa=this.XBf;this.mhb=this.YBf}NOf(){}QOf(){}POf(){}TOf(){}SOf(){}aPf(){}ZOf(){}YOf(){}dPf(){}OOf(){}XBf(){}YBf(){}}Object(D.a)(F,"NoopRealtimeChannelMetrics",null,[870,211]);class K{}K.N2c="presenceUpdated";K.updateNotification="updateNotification";K.cDi="persistentStateCleared";K.updatePersistentState="persistentStateUpdated";Object(D.a)(K,"RtcClientMethodNames",null,[]);class N{}N.NXl="realtimeChannelHub";N.N2c="UpdatePresence";N.kO="SendUpdateNotification";
N.Taf="GetCompletePersistentStateWithMetadata";N.updatePersistentState="UpdatePersistentState";N.vLb="UpdateClientInfo";Object(D.a)(N,"RtcHubMethodNames",null,[]);class H{constructor(oa){this.rv=oa}Kkn(oa){this.rv.on(K.N2c,oa)}Eln(oa){this.rv.on(K.updateNotification,oa)}Jkn(oa){this.rv.on(K.updatePersistentState,oa)}Ikn(oa){this.rv.on(K.cDi,oa)}Wco(oa){this.rv.off(K.N2c,oa)}gdo(oa){this.rv.off(K.updateNotification,oa)}Vco(oa){this.rv.off(K.updatePersistentState,oa)}Uco(oa){this.rv.off(K.cDi,oa)}N2c(oa){return this.rv.invoke(N.N2c,
oa)}vLb(oa){return this.rv.invoke(N.vLb,oa)}kO(oa,pa){return this.rv.invoke(N.kO,oa,pa)}Taf(oa){return this.rv.invoke(N.Taf,oa)}updatePersistentState(oa,pa){return this.rv.invoke(N.updatePersistentState,oa,pa)}}Object(D.a)(H,"RealtimeChannelProxy",null,[876,877,878]);class J{constructor(){this.dhe=this.gug=!1;this.bhe=0;this.Uie=this.NFe=this.MFe=this.dge=!1;this.goe=0;this.GXg=!1;this.FXg=this.EXg=0;this.fEe=!1;this.mEe=this.kEe=this.oEe=this.gEe=0;this.lEe=!1}get sfk(){return this.dhe}get rfk(){return this.bhe}get D9j(){return this.dge}get sRn(){return this.MFe}get tRn(){return this.NFe}get Tvk(){return this.Uie}get JBd(){return this.goe}get nyn(){return this.GXg}get ZRi(){return this.EXg}get myn(){return this.FXg}get iyn(){return this.fEe}get jyn(){return this.gEe}get eSi(){return this.oEe}get $Ri(){return this.kEe}get bSi(){return this.mEe}get aSi(){return this.lEe}static createInstance(oa){const {RealtimeChannel:pa}=
d(1498);return oa?Object.assign(new J,{gug:oa.$("AwayStatusManagerIsEnabled"),dhe:oa.$("AwayStatusOneMinuteTimeoutIsEnabled"),bhe:oa.rc("AwayCoauthorThresholdMs",9E5),dge:oa.$("RtcAllowCrossDomainAccessEnabled"),MFe:oa.$("ShouldLogOnContentNotification"),NFe:oa.$("ShouldLogOnHostSubscriptionNotification"),Uie:oa.$("RtcClientMetricsEnabled"),goe:oa.rc("RtcFindSessionRequestTimeoutInMS",6E4),GXg:oa.$("RtcJsClientFrequentlyLogsMetrics"),EXg:oa.rc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
FXg:oa.rc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),fEe:oa.$("RtcClientMessageTelemetryEnabled"),gEe:oa.rc("RtcClientMessageTelemetrySampleSize",5),oEe:oa.rc("RtcSendTelemetryMessageIntervalInMS",3E5),kEe:oa.rc("RtcLogClientMessageMetricsTimeOutInMs",2E4),mEe:oa.rc("RtcMaxPayloadSizeInCharactersOverride",pa.Vxf),lEe:oa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new J,{gug:!1,dhe:!1,bhe:9E5,dge:!1,MFe:!1,NFe:!0,Uie:!1,goe:9E4,fEe:!1,
gEe:5,oEe:3E5,kEe:2E4,mEe:pa.Vxf,lEe:!1})}}Object(D.a)(J,"RealtimeChannelSettings",null,[875]);class L extends Sys.EventArgs{constructor(oa,pa){super();this.newState=oa;this.oldState=pa}}Object(D.a)(L,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class I extends Sys.EventArgs{constructor(oa,pa){super();this.Svk=oa;this.e3a=pa}}Object(D.a)(I,"ClientInfoEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(oa){super();this.presence=oa}}Object(D.a)(R,"MyPresenceUpdatedEventArgs",
Sys.EventArgs,[]);var C=d(1791),P=d(1790),W=d(1788);class X extends Sys.EventArgs{constructor(oa,pa=null){super();this.El=oa;this.vXj=pa}get type(){return this.El}get WI(){return this.vXj}}Object(D.a)(X,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class V extends Sys.EventArgs{constructor(){super()}}Object(D.a)(V,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class Y extends Sys.EventArgs{constructor(oa,pa,Ya,Ja,nb,Bb){super();this.khc=oa;this.rXe=pa;this.ZAk=Ya;this.fEh=nb;
this.xVe=Ja;this.$w=Bb}}Object(D.a)(Y,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class ca extends Sys.EventArgs{constructor(oa){super();this.hubConnection=oa}}Object(D.a)(ca,"RefreshProxyEventArgs",Sys.EventArgs,[]);class fa extends Sys.EventArgs{constructor(oa,pa){super();this.Yda=oa;this.errorMessage=pa}}Object(D.a)(fa,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class sa extends Sys.EventArgs{constructor(oa,pa,Ya){super();this.type=oa;this.presence=pa;this.e3a=Ya}}Object(D.a)(sa,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(oa,pa,Ya,Ja){super();this.type=oa;this.WI=pa;this.CRk=Ya;this.e3a=Ja}}Object(D.a)(ia,"SendUpdateNotificationEventArgs",Sys.EventArgs,[]);class ea extends Sys.EventArgs{constructor(){super()}}Object(D.a)(ea,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class da extends Sys.EventArgs{constructor(oa){super();this.$td=oa}}Object(D.a)(da,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class ja extends Sys.EventArgs{constructor(oa,
pa){super();this.type=oa;this.Qko=pa}}Object(D.a)(ja,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var Ga=d(67);class ya{constructor(){this.sa=new Ga.a}Obn(oa,pa){this.sa.raiseEvent("CSC",new L(oa,pa))}Gcn(oa){this.sa.raiseEvent("RP",new ca(oa))}o1d(oa){this.sa.raiseEvent("RC",oa)}Jcn(){this.sa.raiseEvent("RMID")}Fcn(oa,pa,Ya,Ja,nb,Bb){this.sa.raiseEvent("RPS",new Y(oa,pa,Ya,Ja,nb,Bb))}$Hi(oa,pa){this.sa.raiseEvent("UPSR",new ja(oa,pa))}NHi(oa,pa){this.sa.raiseEvent("PU",new W.a(oa,pa))}mcn(oa){this.sa.raiseEvent("MPU",
new R(oa))}nOf(oa,pa,Ya,Ja){this.sa.raiseEvent("SUN",new ia(oa,pa,Ya,Ja))}Ycn(oa,pa){this.sa.raiseEvent("UNR",new X(oa,pa))}UHi(oa,pa,Ya){this.sa.raiseEvent("SP",new sa(oa,pa,Ya))}Bcn(oa,pa){this.sa.raiseEvent("PSU",new P.a(oa,pa))}Acn(oa){this.sa.raiseEvent("PSC",new C.a(oa))}gcn(oa){this.sa.raiseEvent("IPSC",new C.a(oa))}Zcn(oa){this.sa.raiseEvent("UPSC",new da(oa))}Kcn(oa,pa){this.sa.raiseEvent("SPC",new ea(oa,pa))}RHi(oa,pa){this.sa.raiseEvent("RCF",new fa(oa,pa))}acn(oa){this.sa.raiseEvent("CPSWM",
new V(oa))}Xcn(oa,pa){this.sa.raiseEvent("UCI",new I(oa,pa))}xya(oa){this.sa.addHandler("CSC",oa)}gXc(oa){this.sa.removeHandler("CSC",oa)}o7j(oa){this.sa.addHandler("RP",oa)}n7j(oa){this.sa.addHandler("RC",oa)}r7j(oa){this.sa.addHandler("RMID",oa)}m7j(oa){this.sa.addHandler("RPS",oa)}N7j(oa){this.sa.addHandler("UPSR",oa)}UUa(oa){this.sa.addHandler("PU",oa)}QHb(oa){this.sa.removeHandler("PU",oa)}o5j(oa){this.sa.addHandler("IPU",oa)}K7j(oa){this.sa.addHandler("UCI",oa)}v7j(oa){this.sa.addHandler("SUN",
oa)}p5j(oa){this.sa.addHandler("IUNR",oa)}j1(oa){this.sa.addHandler("UNR",oa)}RHb(oa){this.sa.removeHandler("UNR",oa)}lqd(oa){this.sa.addHandler("PSU",oa)}A2d(oa){this.sa.removeHandler("PSU",oa)}n5j(oa){this.sa.addHandler("IPSU",oa)}kqd(oa){this.sa.addHandler("PSC",oa)}z2d(oa){this.sa.removeHandler("PSC",oa)}m5j(oa){this.sa.addHandler("IPSC",oa)}M7j(oa){this.sa.addHandler("UPSC",oa)}u7j(oa){this.sa.addHandler("SP",oa)}x7j(oa){this.sa.addHandler("SPC",oa)}static getInstance(){return ya._instance||
(ya._instance=new ya)}}ya._instance=null;Object(D.a)(ya,"RtcEventHub",null,[874]);var ta=d(72),ua=d(151);class Sa{constructor(oa){this.$vc=null;this.KOa=0;this.xyb=!1;this.rm=oa;this.rm.xya(Object(f.a)(this,this.zfa,"onConnectionStateChanged"))}zfa(oa,pa){this.KOa=pa.newState}wWm(){m.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.rm.o1d()}e0l(oa){this.$vc.init(oa)}}Object(D.a)(Sa,"ARtcMessageHandler",null,[]);var ka=d(1364);class ha{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(D.a)(ha,"PresenceDataEntryForClients",null,[]);var Ca=d(81);class Pa{constructor(oa,pa=""){this.oSj=oa;this.uHa=pa}send(){return this.oSj()}get messageId(){return this.uHa}}Object(D.a)(Pa,"MessageHandler",null,[888]);var Xa=d(1594);class qa extends Sys.EventArgs{constructor(oa,pa,Ya,Ja){super();this.cSf=oa;this.reconnectDelay=pa;this.reason=Ya;this.fVf=Ja}}Object(D.a)(qa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class Ea{constructor(){this.eHe=this.Fi=null}get ni(){return this.Fi?
this.eHe?this.eHe.getTime()-this.Fi.getTime():(new Date).getTime()-this.Fi.getTime():0}start(){this.Fi=new Date}stop(){this.eHe=new Date}}Object(D.a)(Ea,"SimpleStopwatch",null,[]);var Ia=d(1642),na;(function(oa){oa[oa.contentUpdate=0]="contentUpdate";oa[oa.editorsTableUpdate=1]="editorsTableUpdate";oa[oa.fileNameUpdate=2]="fileNameUpdate";oa[oa.wetContentUpdate=3]="wetContentUpdate";oa[oa.persistedContentUpdate=4]="persistedContentUpdate";oa[oa.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";
oa[oa.replicationTelemetry=6]="replicationTelemetry";oa[oa.lockUpdate=7]="lockUpdate";oa[oa.collabServiceContentUpdate=8]="collabServiceContentUpdate";oa[oa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";oa[oa.saveTargetUpdate=10]="saveTargetUpdate";oa[oa.uploadToOcsUpdate=11]="uploadToOcsUpdate";oa[oa.labelUpdate=12]="labelUpdate";oa[oa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";oa[oa.subscribeOrExtend=14]="subscribeOrExtend";oa[oa.elapsedBootTelemetry=15]=
"elapsedBootTelemetry";oa[oa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";oa[oa.clientToClientResponseMessage=17]="clientToClientResponseMessage";oa[oa.verifyNotificationPipeline=18]="verifyNotificationPipeline";oa[oa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";oa[oa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";oa[oa.last=21]="last"})(na||(na={}));Object(D.b)("UpdateNotificationType",na);var Na=d(1641),Oa=d(1060),Ra=d(1061);class ab extends Sa{constructor(oa,
pa,Ya,Ja,nb,Bb,mb,Qb,Vb,mc){super(mb);this.rv=null;this.aOg=!1;this.uHa=0;this.jBe=new ua.a;this.eJj=ab.hll();this.mAe=w.AFrameworkApplication.K.lb("OwningFeatureCrewForRtcNotificationKpis");this.Md=oa;this.MQg=this.LQg=0;this.$vc=pa;this.$vc.mqd(Object(f.a)(this,this.wWm,"onTooManyUndeliveredMessages"));this._clientId=Ya;this.WPj=nb;this.rm.o7j(Object(f.a)(this,this.fUm,"onRefreshProxyRequired"));this.rm.m7j(Object(f.a)(this,this.dUm,"onRefreshAllPersistentStateRequest"));this.rm.v7j(Object(f.a)(this,
this.kO,"sendUpdateNotification"));this.rm.o5j(Object(f.a)(this,this.IRm,"onInternalPresenceUpdated"));this.rm.p5j(Object(f.a)(this,this.JRm,"onInternalUpdateNotificationReceived"));this.rm.n5j(Object(f.a)(this,this.HRm,"onInternalPersistentStateUpdated"));this.rm.m5j(Object(f.a)(this,this.GRm,"onInternalPersistentStateCleared"));this.rm.u7j(Object(f.a)(this,this.VYc,"sendPersistentState"));this.rm.K7j(Object(f.a)(this,this.vLb,"updateClientInfo"));this.le=Bb;this.Uv=Ja;this.qx=Qb;this.WU=Vb;this.Tqc=
mc;this.zoa=Object(ta.a)(String,w.AFrameworkApplication.sessionStartInfoSettings.Application)||""}fUm(oa,pa){this.rv=this.WPj(pa.hubConnection);this.$vc.reset();this.rv.Kkn(Object(f.a)(this,this.R2,"onPresenceUpdated"));this.rv.Jkn(Object(f.a)(this,this.TFb,"onPersistentStateUpdated"));this.rv.Ikn(Object(f.a)(this,this.h$b,"onPersistentStateCleared"));this.rv.Eln(Object(f.a)(this,this.taa,"onUpdateNotificationReceived"))}zfa(oa,pa){this.KOa=pa.newState;2===pa.newState&&this.tDn()}tDn(){for(let oa of this.jBe)this.kO(null,
new ia(oa.key,oa.value,!1,new a.a));this.jBe=new ua.a}dUm(oa,pa){pa.xVe();for(oa=0;3>oa;++oa)this.ZCn(oa,pa)}ZCn(oa,pa){try{this.rv.Taf(oa).done(Ya=>{pa.khc(pa.rXe,"GetCompletePresenceSuccess")&&(pa.ZAk.SVm(),m.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Uv),this.rm.Jcn(),this.xTm(oa,Ya),this.rm.acn(Ya),pa.fEh.xb(oa)&&this.rm.UHi(oa,pa.fEh.J(oa),new a.a))}).fail(Ya=>{const {RtcUtils:Ja}=d(1469);pa.khc(pa.rXe,"GetCompletePresenceFail")&&(m.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",Ja.J9b(Ya),this.Uv),this.rm.o1d())}).always(()=>{pa.$w&&pa.$w.stop()})}catch(Ya){m.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",pa.rXe,Ya.message)}}VYc(oa,pa){var {RtcUtils:Ya}=d(1469);oa=pa.presence;let Ja;const nb=pa.e3a;this.WU.UN(1,0);try{Ja=Ya.QUe(oa,this.Tqc)}catch(mb){this.WU.UN(1,
3);m.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",mb.message);nb.setException(mb);return}Ya=new r.a;Ya.Z(this._clientId,Object.assign(new ha,{Presence:oa,TimeStamp:(new Date).getTime()}));this.rm.$Hi(pa.type,Ya);if(2!==this.KOa)this.qx.zHb(),this.WU.UN(1,2),nb.Gg(null);else{var Bb=this.uHa.toString();++this.uHa;oa=new Pa(()=>this.vDn(pa.type,Ja,Bb),Bb);oa=this.T9i(0,pa.type).add(oa);oa.BWd(mb=>{2===mb&&this.WU.UN(1,6);nb.Gg(null)});
oa.AWd(()=>{})}}vDn(oa,pa,Ya){let Ja=null;const nb=new Ea,Bb=new Xa.a;m.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Uv);if(2!==this.KOa)return this.qx.zHb(),this.WU.UN(1,2),m.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Uv),Bb.Fxf(),Bb;this.le&&20>this.LQg&&(Ja=this.le.fg("WebServiceCall","Send Presence Message"),this.LQg++);nb.start();Bb.OQc(1);try{this.rv.updatePersistentState(oa,pa).done(()=>{this.qx.$Of();this.WU.UN(1,
1);m.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ya,this.Uv);Bb.Ygb(1);nb&&(nb.stop(),nb.ni>this.Md.ZRi?this.WU.UN(1,4):this.WU.UN(1,5))}).fail(mb=>{const {RtcUtils:Qb}=d(1469);this.xyb||(this.qx.zHb(),this.WU.UN(1,3),m.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ya,Qb.J9b(mb),this.Uv));Bb.Ygb(2)}).always(()=>{Ja&&Ja.stop()})}catch(mb){m.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
mb.message),this.WU.UN(1,3),Bb.Ygb(2)}return Bb}vLb(oa,pa){({RtcUtils:oa}=d(1469));const Ya=pa.Svk,Ja=pa.e3a;let nb;try{nb=oa.QUe(Ya,this.Tqc)}catch(Bb){m.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",Bb.message);Ja.setException(Bb);return}try{this.rv.vLb(nb).done(()=>{m.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(Bb=>{const {RtcUtils:mb}=d(1469);this.xyb||m.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
mb.J9b(Bb));Ja.Gg(null)})}catch(Bb){m.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",Bb.message),Ja.Gg(null)}}kO(oa,pa){({RtcUtils:oa}=d(1469));const Ya=pa.type,Ja=pa.WI,nb=pa.CRk,Bb=pa.e3a;let mb;this.WU.UN(0,0);try{mb=oa.QUe(Ja,this.Tqc)}catch(Vb){this.WU.UN(0,3);m.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Vb.message);Bb.setException(Vb);return}if(2!==this.KOa)nb?this.jBe.Z(Ya,
Ja):(this.qx.zHb(),this.WU.UN(0,2)),Bb.Gg(null);else{var Qb=this.uHa.toString();++this.uHa;pa=new Pa(()=>this.cEn(Ya,mb,Qb),Qb);pa=this.T9i(1,Ya).add(pa);pa.BWd(Vb=>{2===Vb&&this.WU.UN(0,6);Bb.Gg(null)});pa.AWd(()=>{})}}cEn(oa,pa,Ya){let Ja=null;const nb=new Ea,Bb=new Xa.a;m.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.Uv);if(2!==this.KOa)return this.qx.zHb(),this.WU.UN(0,2),m.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.Uv),Bb.Fxf(),Bb;this.le&&3===oa&&20>this.MQg&&(Ja=this.le.fg("WebServiceCall","Send WetContent Update"),this.MQg++);nb.start();Bb.OQc(1);this.rv.kO(oa,pa).done(()=>{this.qx.$Of();this.WU.UN(0,1);m.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ya,this.Uv);Bb.Ygb(1);nb&&(nb.stop(),nb.ni>this.Md.ZRi?this.WU.UN(0,4):this.WU.UN(0,5))}).fail(mb=>{const {RtcUtils:Qb}=d(1469);this.xyb||(this.qx.zHb(),this.WU.UN(0,3),m.ULS.sendTraceTag(3249507,500,
15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ya,Qb.J9b(mb),this.Uv));Bb.Ygb(2)}).always(()=>{Ja&&Ja.stop()});return Bb}$ga(){this.rv.Wco(Object(f.a)(this,this.R2,"onPresenceUpdated"));this.rv.Vco(Object(f.a)(this,this.TFb,"onPersistentStateUpdated"));this.rv.Uco(Object(f.a)(this,this.h$b,"onPersistentStateCleared"));this.rv.gdo(Object(f.a)(this,this.taa,"onUpdateNotificationReceived"))}IRm(oa,pa){this.R2(pa.VEa,pa.yyd)}R2(oa){this.qx.lWc();this.TFb(0,oa)}HRm(oa,
pa){this.TFb(pa.type,pa.VEa)}xTm(oa,pa){const Ya={};for(let Ja in pa)Ya[Ja]=pa[Ja].Presence;this.uxi(oa,Ya,pa)}TFb(oa,pa){this.qx.lWc();this.uxi(oa,pa)}uxi(oa,pa,Ya=null){var {RtcUtils:Ja}=d(1469);if(m.ULS.u7(500,100))for(var nb in pa);delete pa[this._clientId];if(!Ca.a.isEmpty(pa)){for(var Bb in pa)nb=Bb,pa[nb]=Ja.deserialize(pa[Bb],"Presence",nb,!1,this.Tqc);Ja=new r.a;Bb=(new Date).getTime();for(let mb in pa){nb=pa[mb];let Qb=mb,Vb;Ya?(Vb=Ya[Qb],Vb.Presence=nb):Vb=Object.assign(new ha,{Presence:nb,
TimeStamp:Bb});Ja.Z(Qb,Vb)}this.rm.$Hi(oa,Ja);switch(oa){case 0:this.aOg||(m.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Uv),this.aOg=!0,w.AFrameworkApplication.jh&&w.AFrameworkApplication.jh.GCm());this.rm.NHi(pa,[]);break;default:this.rm.Bcn(oa,pa)}}}GRm(oa,pa){this.h$b(pa.$td)}h$b(oa){this.qx.lWc();if(m.ULS.u7(500,100))for(let pa=0;pa<oa.length;++pa);oa.length&&(this.rm.Zcn(oa),this.rm.Acn(oa),this.rm.NHi({},oa))}JRm(oa,pa){this.taa(pa.type,pa.WI)}taa(oa,
pa=null){this.Md.sRn&&0===oa&&m.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===oa&&this.mAe&&0<this.mAe.length){var Ya=Object.assign(new Na.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.mAe,vetoPillar:"RealTimeCoauth"});(Ya=ka.a.getInstance(Ya))&&Ya.logKpiUsage(this.eJj)}this.Md.tRn&&13===oa&&m.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
pa||"<none>"));this.qx.lWc();5===oa?(pa=(oa=this.U0m(pa))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",oa.reason,oa.reconnectDelay):"Received client reconnection request from the server without params.",m.ULS.sendTraceTag(18637071,500,50,pa),this.rm.o1d(oa)):(pa=d(1469).RtcUtils.deserialize(pa,String.format("UpdateNotification-{0}",na[oa]),null,!1,this.Tqc),this.rm.Ycn(oa,pa))}U0m(oa){try{if(!oa||""===oa)return null;const pa=JSON.parse(oa);
return new qa(pa[Ia.a.$Tf],pa[Ia.a.hyn],pa[Ia.a.lyn],pa[Ia.a.fVf])}catch(pa){return m.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",pa.message),null}}T9i(oa,pa){return this.$vc.tKl(this.uKl(oa,pa))}uKl(oa,pa){return oa+","+pa}static hll(){var oa=new Map;oa.set("SkipAria","True");oa=Object.assign(new Oa.a,{extendedProperties:oa});return Object.assign(new Ra.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:oa,blockFutureEmissionDurationInMs:3E5})}}
Object(D.a)(ab,"RtcMessageHandler",Sa,[]);class zb{Gsh(oa,pa=""){const {MaxOutstandingThrottler:Ya}=d(1638);return Ya.createInstance(oa,pa)}hJk(oa,pa=""){const {MaxRateThrottler:Ya}=d(1640);return Ya.createInstance(oa,pa)}}Object(D.a)(zb,"ThrottlerFactory",null,[873]);var Qa=d(1643);class yb{constructor(oa){this.Md=null;this.zh=!1;this.sa=new Ga.a;this.zxe=new r.a;this.xxe=new r.a;this.FIe=oa;this.gQb=this.FIe.Gsh(pa=>pa.send(),"GlobalMaxOustandingThrottler");this.gQb.mqd(()=>{this.sa.raiseEvent("TMUDM")})}init(oa){this.zh||
(this.Md=oa,this.gQb.init(this.Md.nlb,this.Md.COl),this.zh=!0)}tKl(oa){var {MaxRateThrottler:pa}=d(1640),{MaxOutstandingThrottler:Ya}=d(1638);this.zh||this.init(new Qa.a(pa.Mvh,Ya.jwh,Ya.Yvh,yb.iEm));({value:pa}=this.zxe.Dc(oa)).returnValue||(({value:pa}=this.xxe.Dc(oa)).returnValue||(pa="MaxOutstandingThrottler-"+oa,pa=this.FIe.Gsh(Object(f.a)(this.gQb,this.gQb.add,"add"),pa),pa.init(this.Md.nlb,this.Md.hEm),pa.mqd(()=>{this.sa.raiseEvent("TMUDM")}),this.xxe.add(oa,pa)),Ya="MaxRateThrottler-"+oa,
pa=this.FIe.hJk(Object(f.a)(pa,pa.add,"add"),Ya),pa.init(this.Md.iGm),this.zxe.add(oa,pa));return pa}reset(){for(let oa of this.zxe)oa.value.bPf();for(let oa of this.xxe)oa.value.bPf(),oa.value.reset();this.gQb.bPf();this.gQb.reset()}mqd(oa){this.sa.addHandler("TMUDM",oa)}}yb.iEm=1E3;Object(D.a)(yb,"ThrottlerManager",null,[872]);var lb;(function(oa){oa[oa.unspecified=0]="unspecified";oa[oa.word=1]="word";oa[oa.excel=2]="excel";oa[oa.powerPoint=3]="powerPoint";oa[oa.test=4]="test";oa[oa.wacFrontEnd=
5]="wacFrontEnd";oa[oa.oneNote=6]="oneNote";oa[oa.visio=7]="visio";oa[oa.officeMobile=8]="officeMobile";oa[oa.cosmosDBChangefeed=9]="cosmosDBChangefeed";oa[oa.last=10]="last"})(lb||(lb={}));Object(D.b)("RtcClientAppName",lb);const Eb=(oa,pa,Ya,Ja,nb,Bb,mb,Qb,Vb=null,mc=null,ob=null,cb=null)=>{const db=J.createInstance(w.AFrameworkApplication.K),kb=w.AFrameworkApplication.buildVersion?w.AFrameworkApplication.buildVersion:"1.0",Wb=bc(oa,pa,mb,kb),Fb=db.Tvk?d(1789).RealtimeChannelMetrics.createInstance(Wb):
new F;var nc=d(1488).FrequentLoggingMetrics.create(nb);db.nyn&&nc.B_n(db.myn);var gc="";gc=Vb&&""!==Vb?Vb:"/rtc2/";nc.uGh=u.a.b2(gc);const Jc=gc+"signalr";Vb=gc+"findsession";const tb=N.NXl;gc=new zb;ob=ob||ya.getInstance();m.ULS.shipAssertTag(556867617,500,db.bSi<=d(1498).RealtimeChannel.Doi,"Client attempting to override max payload size beyond absolute limit");const dc=Math.min(db.bSi,d(1498).RealtimeChannel.Doi);nc.Coi=dc;nc=new ab(db,new yb(gc),oa,Wb,Yb=>new H(Yb.createHubProxy(tb)),Qb,ob,Fb,
nc,dc);mc||(mc=d(1683).FindSessionStrategy.createInstance(pa,nb,Vb,Qb,kb,mb,oa,Wb,ob,Bb,Ja,cb));mc.JBd=db.JBd;pa=new G(Wb);Ya=Ya?Ya.split(","):null;oa=new (d(1498).RealtimeChannel)(oa,Ya,Wb,Qb,()=>$.hubConnection(Jc),mc,nc,pa,ob,Fb,db,nb);oa.init();return oa},bc=(oa,pa,Ya)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",oa,Pb(lb[Ya]),Pb("browser"),pa),Pb=oa=>oa?oa.charAt(0).toLocaleUpperCase()+oa.substring(1,oa.length):oa;d.d(M,"RealtimeChannel",function(){return Va});class Va{constructor(oa,
pa,Ya,Ja,nb,Bb,mb,Qb,Vb,mc,ob,cb){this.cHe=!1;this.g4=null;this.P0=new r.a;this.tkc=1;this.Nba=null;this.Bl=!1;this.zve=(new Date(0)).getTime();this.k_g=0;this._clientId=oa;this.und=pa;this.a8=0;this.le=Ja;this.Fje=Qb;this.RRj=mb;this.Lsj=Vb;this.Pxj=nb;this.Q4a=Bb;this.Uv=Ya;this.qx=mc;this.Md=ob;this.hg=cb;this.VTj=1>100*Math.random()}get $Ma(){return this.Q4a.$Ma}set $Ma(oa){this.Q4a.$Ma=oa}get rjb(){return this.RRj}get rm(){return this.Lsj}init(){this.rm.n7j(Object(f.a)(this,this.xyd,"disconnectAndCreateNewConnection"));
this.rm.N7j(Object(f.a)(this,this.RWm,"onUpdatePersistentStateRequestReceivedInternal"));this.rm.M7j(Object(f.a)(this,this.QWm,"onUpdatePersistentStateClearedRequestReceived"));this.hg.kWb(this.qx);w.AFrameworkApplication.rK(()=>{const {FrequentLoggingMetrics:oa}=d(1488);this.qx.cPf();oa.instance&&oa.instance.nwf()});this.Ysh();this.LUk();this.rm.x7j(Object(f.a)(this,this.ffo,"updateConnectionQueryString"))}LUk(){try{const Ya=$.signalR;if(!Ya)throw Error.invalidOperation("Failed to retrieve Signalr object");
const Ja=Ya.version;if(!Ja)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===Ja){var oa=Ya.transports;if(!oa)throw Error.invalidOperation("Failed to retrieve transports object");var pa=oa.longPolling;if(!pa)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!pa.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");pa.supportsKeepAlive=this.xLk()}}catch(Ya){m.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Ya.message)}}xLk(){return()=>!1}Ysh(){const oa=++this.tkc;this.zve=(new Date(0)).getTime();this.Nba=this.Pxj();this.rm.Gcn(this.Nba);this.Nba.stateChanged(pa=>{this.OOm(pa,oa)});this.Nba.connectionSlow(Object(f.a)(this,this.LVm,"onSlowConnection"));this.Nba.error(Object(f.a)(this,this.DVm,"onSignalRError"));this.Nba.log=Object(f.a)(this,this.EVm,"onSignalRLog")}khc(oa,pa){return oa!==this.tkc?(m.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
pa),!1):!0}connect(){2!==this.a8&&1!==this.a8&&(m.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Uv),this.Fje.KOm(),z.a.instance.C_n(),this.zfa(1,this.a8),this.T5i())}T5i(){const oa=this.tkc;this.cHe=!1;this.qx.PIi();this.Q4a.nFl(Object(f.a)(this,this.WAk,"connectSignalrConnection"),Object(f.a)(this,this.Bvi,"onFailureToConnect"),Object(f.a)(this.rjb,this.rjb.e0l,"initThrottlerManager"),Object(f.a)(this,this.khc,"verifyConnectionToken"),oa)}Bvi(oa=null){this.qx.RIi();
let pa=null;!oa||"documentsessiondeleted"!==(pa=oa.toLowerCase())&&"documentsessionexpired"!==pa?this.xyd():(m.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Uv,oa),this.disconnect())}xyd(oa,pa=null){m.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.g4);oa=(oa=2===this.a8||1===this.a8)&&!this.rjb.xyb;let Ya=!0,Ja=0;pa&&Object.getType(pa)!==Object.getType(Sys.EventArgs.Empty)&&
pa.cSf&&""!==pa.cSf&&(oa=!0,this.Q4a.TLn(pa.cSf),Ya=pa.fVf,Ja=pa.reconnectDelay);oa&&this.zfa(1,this.a8);++this.tkc;this.rjb.$ga();this.L0n(Ya);this.Q4a.gWk();this.Ysh();oa&&window.setTimeout(Object(f.a)(this,this.T5i,"startConnecting"),Math.min(Ja,3E4))}ffo(){let oa=null;const pa=({correlationId:oa}=this.Q4a.cPh()).returnValue;this.Nba.qs=pa;m.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Uv,oa)}WAk(oa){const {FrequentLoggingMetrics:pa}=
d(1488);this.zve=(new Date).getTime();let Ya=null;this.Nba.qs=({correlationId:Ya}=this.Q4a.cPh()).returnValue;this.Md.D9j&&(this.Nba.url=oa,pa.instance&&(pa.instance.Coh=u.a.b2(oa)));let Ja=null;this.le&&(Ja=this.le.fg("WebServiceCall","ConnectToServer"));m.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Uv);oa={};this.und&&(oa.transport=1===this.und.length?this.und[0]:this.und);oa.pingInterval=null;z.a.instance.kWc(1,0);oa.waitForPageLoad=!1;this.Nba.start(oa,null).done(nb=>
{this.qx.SIi();z.a.instance.kWc(1,1,!0);m.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",nb.id,Ya)}).fail(nb=>{m.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.Q4a.$V,Ya,this.Uv);this.Bvi();this.qx.QIi(nb);z.a.instance.kWc(1,1,!1);this.rm.RHi(0,{["CorrelationId"]:Ya,["ErrorDetails"]:nb,["ConnectionState"]:l.a[this.a8]})}).always(()=>{const {FrequentLoggingMetrics:nb}=
d(1488);Ja&&Ja.stop();nb.instance&&(nb.instance.Hne=!1)})}disconnect(){const {FrequentLoggingMetrics:oa}=d(1488);0===this.a8?m.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Uv):(this.qx.VIi(),oa.instance&&(oa.instance.Hne=!0),m.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Uv),this.rjb.xyb=!0,this.Fje.BPm(),this.zfa(0,this.a8),this.xyd(),this.rjb.xyb=!1)}L0n(oa){const pa=this.Bok(),Ya=this.Nba,Ja=this.g4,
nb=()=>{if(this.cHe)m.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.cHe=!0,Ya.stop(!0,oa)}catch(Bb){m.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",Bb.message)}};0<pa?(m.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Ja,pa),window.setTimeout(nb,pa)):(m.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Ja),nb())}Bok(){let oa=0;0===this.Nba.state&&(oa=this.zve+Va.Eoo-
(new Date).getTime(),0>oa&&(oa=0));return oa}get connectionState(){return this.a8}xya(oa){this.rm.xya(oa)}gXc(oa){this.rm.gXc(oa)}pVi(oa){this.VYc(0,oa)}VYc(oa,pa){const Ya=new a.a;this.rm.UHi(oa,pa,Ya);return Ya.task}UUa(oa){this.rm.UUa(oa)}QHb(oa){this.rm.QHb(oa)}lqd(oa){this.rm.lqd(oa)}A2d(oa){this.rm.A2d(oa)}kqd(oa){this.rm.kqd(oa)}z2d(oa){this.rm.z2d(oa)}hJc(oa){return this.rMl(oa)}gzb(){return this.I$e(0)}I$e(oa){const pa={};for(let Ya of this.P0)Ya.value.xb(oa)&&(pa[Ya.key]=Ya.value.J(oa).data);
return pa}rMl(oa){return this.P0.xb(oa)&&this.P0.J(oa).xb(0)?this.P0.J(oa).J(0).data:null}RWm(oa,pa){for(let Ya of pa.Qko)this.P0.xb(Ya.key)||this.P0.Z(Ya.key,new ua.a),oa=Ya.value,this.P0.J(Ya.key).Z(pa.type,new B(oa.Presence,new Date(oa.TimeStamp))),Ya.key===this._clientId&&0===pa.type&&this.rm.mcn(oa.Presence)}QWm(oa,pa){for(const Ya of pa.$td)this.P0.remove(Ya)}vfl(){const oa=new ua.a;if(!this.P0.xb(this._clientId))return oa;for(let pa of this.P0.J(this._clientId))oa.Z(pa.key,pa.value.data);return oa}kO(oa,
pa=null,Ya=!1){const Ja=new a.a;this.rm.nOf(oa,pa,Ya,Ja);return Ja.task}j1(oa){this.rm.j1(oa)}RHb(oa){this.rm.RHb(oa)}Mdb(oa){let pa,Ya;return({value:pa}=this.P0.Dc(oa)).returnValue&&({value:Ya}=pa.Dc(0)).returnValue?new v(this.wMl(Ya),Ya.timeStamp):null}wGc(){const oa={};for(let pa of this.P0)pa.value.Dc(0).returnValue&&(oa[pa.key]=this.Mdb(pa.key));return oa}vLb(oa){const pa=new a.a;this.rm.Xcn(oa,pa);return pa.task}get clientId(){return this._clientId}get cXn(){return this.VTj}dispose(){const {FrequentLoggingMetrics:oa}=
d(1488);this.Bl||(this.rjb.$ga(),this.hg.p2d(this.qx),this.qx.cPf(),oa.instance&&oa.instance.nwf(),this.Bl=!0)}OOm(oa,pa){this.khc(pa,"StateChangedSignalR")&&this.zfa(this.eqh(oa.newState),this.eqh(oa.oldState))}zfa(oa,pa){var {FrequentLoggingMetrics:Ya}=d(1488),{ClientToClientMessageTelemetry:Ja}=d(1696);if((1!==this.a8||0!==pa||1!==oa)&&this.a8!==pa){const nb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.a8,
pa,oa]));m.ULS.sendTraceTag(3290053,500,10,nb)}if(this.a8!==oa){switch(oa){case 2:Ya.instance&&Ya.instance.NCm();this.g4=this.Nba.id;m.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.g4,this.Uv);this.Rzm(this.Nba);m.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ya=null;this.le&&(Ya=this.le.fg("WebServiceCall","Receive First Presence"));Ja=this.tkc;this.rm.Fcn(Object(f.a)(this,this.khc,"verifyConnectionToken"),Ja,this.Fje,Object(f.a)(this,
this.xVe,"clearExistingPersistentState"),this.vfl(),Ya);this.Md.iyn&&(Ya=100*Math.random()<=this.Md.jyn,d(1696).ClientToClientMessageTelemetry.D2b(this.rm,this.Md,Ya).start());break;case 1:2===pa&&m.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.g4);break;case 0:if(Ja.instance&&Ja.instance.stop(),this.rjb.xyb)m.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.g4);else{1===pa&&(m.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.g4),this.qx.WIi());2===pa&&m.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.g4);this.xyd();return}}this.a8=oa;this.rm.Obn(oa,pa)}}Rzm(oa){if(oa&&oa.transport&&oa.transport.name){oa=oa.transport.name;var pa=oa.toLowerCase();
"websockets"===pa?m.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",oa,this.Uv):"serversentevents"===pa?m.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",oa,this.Uv):"foreverframe"===pa?m.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",oa,this.Uv):"longpolling"===pa?m.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",oa,this.Uv):"mocktransport"!==pa&&m.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
oa)}else m.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}LVm(){if(this.Md.aSi){const oa=u.a.jT(this.$Ma,"mid");m.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.g4,oa)}else m.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.g4)}DVm(){m.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.g4)}EVm(oa){oa=d(1469).RtcUtils.J9b(oa);if(this.Md.aSi&&oa.startsWith("Keep alive timed out.")){const pa=
u.a.jT(this.$Ma,"mid");m.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",oa,pa)}else this.cXn&&2E3>this.k_g&&!oa.startsWith("Invok")&&!oa.startsWith("Trigger")&&(m.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",oa),this.k_g++)}xVe(){let oa;const pa=[];({value:oa}=this.P0.Dc(this._clientId)).returnValue&&this.P0.remove(this._clientId);for(let Ya of this.P0.keys)Array.add(pa,Ya);for(const Ya of pa)this.P0.remove(Ya);oa&&this.P0.Z(this._clientId,oa);this.rm.gcn(pa)}eqh(oa){switch(oa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",oa,"Unknown SignalR state");}}wMl(oa){return oa&&oa.timeStamp?(new Date).getTime()-oa.timeStamp.getTime()>(this.Md.sfk?6E4:this.Md.rfk)?2:1:1}static createInstance(oa,pa,Ya,Ja,nb,Bb,mb,Qb=null,Vb=null,mc=null,ob=null,cb=null,db=null){return Eb(oa,pa,Ya,db,Ja,nb,Bb,mb,Qb,Vb,mc,cb,ob)}}Va.Doi=31E3;Va.Vxf=8E3;Va.Eoo=15E3;Object(D.a)(Va,"RealtimeChannel",null,[849,850])},1570:function(D,M,d){d.d(M,"a",function(){return m});
D=d(0);class m{constructor(){this.o0g=!1;this.bsb=null;this.zyg=0;this.eoe=this.puh();this.v7c=this.puh();this.Dnb=this.$Pb=0;this.lw=()=>new Date}get G1n(){return this.o0g}puh(){const f=Array(6);for(let a=0;a<f.length;a++)f[a]=0;return f}Xpl(){return this.eoe.toString()}Ekl(){return this.v7c.toString()}C_n(){this.bsb=this.lw()}kWc(f,a,l=!1){this.G1n||(l&&(this.o0g=!0),l=this.lw(),0===f&&5<this.$Pb||1===f&&5<this.Dnb||(this.zyg<f?(1===this.$Pb%2&&(this.eoe[this.$Pb]=-1,this.$Pb++),this.zyg=f,1===
a&&(this.v7c[this.Dnb]=-1,this.Dnb++),this.v7c[this.Dnb]=this.n1f(l),this.Dnb++):0===f?(this.eoe[this.$Pb]=this.n1f(l),this.$Pb++):(this.v7c[this.Dnb]=this.n1f(l),this.Dnb++)))}n1f(f){const a=f.getTime()-this.bsb.getTime();this.bsb=f;return a}static get instance(){m._instance||(m._instance=new m);return m._instance}static set instance(f){m._instance=f}}m._instance=null;Object(D.a)(m,"LatencyMetrics",null,[])},1594:function(D,M,d){D=d(0);class m{constructor(){this.rvg=this.zje=!1;this.callback=null}zSc(a){this.callback=
a;this.Uaj()}Vni(a){this.zje||(this.zje=!0,this.Hxj=a,this.Uaj())}Uaj(){this.zje&&this.callback&&!this.rvg&&(this.rvg=!0,this.callback(this.Hxj))}}Object(D.a)(m,"CompletionTask",null,[]);d.d(M,"a",function(){return f});class f{constructor(){this.lPg=new m;this.jPg=new m}BWd(a){this.lPg.zSc(a)}AWd(a){this.jPg.zSc(a)}OQc(a){this.lPg.Vni(a)}Ygb(a){this.jPg.Vni(a)}Fxf(){this.OQc(2);this.Ygb(2)}}Object(D.a)(f,"MessageStatus",null,[887])},1637:function(D,M,d){d.d(M,"a",function(){return m});D=d(0);var m;
(function(f){f[f.disconnected=0]="disconnected";f[f.connecting=1]="connecting";f[f.connected=2]="connected"})(m||(m={}));Object(D.b)("ChannelConnectionState",m)},1638:function(D,M,d){d.r(M);d.d(M,"MaxOutstandingThrottler",function(){return l});D=d(0);var m=d(43),f=d(67);M=d(1639);var a=d(1594);class l extends M.a{constructor(r,w=""){super(r,w);this.N8b=this.nlb=0;this.sa=new f.a;this.fRb=!1;this.Qfd=this.X7c=this.w7c=this.EIe=0;this.$0=[];this.clearTimeout=l.c1e}add(r){this.gRb||this.init(l.jwh,l.Yvh);
this.Ftb++;const w=new a.a;this.p6b?this.k6d(r,w):this.Qfd<this.N8b?this.UYc(r,w):(this.k6d(r,w),this.fRb=!1);return w}UYc(r,w){r=this.FYg(r);const v=this.setTimeout(Object(m.a)(this,this.wSm,"onMessageWaitTimeExpired"),this.nlb);++this.Qfd;Array.add(this.$0,v);const u=this.w7c;r.BWd(z=>{w.OQc(z)});r.AWd(z=>{this.w7c===u&&(this.vSm(u,v),w.Ygb(z))})}vSm(r,w){this.w7c===r&&(--this.Qfd,this.clearTimeout(w),Array.remove(this.$0,w),this.p6b&&this.SDn())}SDn(){this.p6b&&!this.fRb&&(this.EIe=this.setTimeout(Object(m.a)(this,
this.TDn,"sendThrottledMessageFromTimer"),0),this.fRb=!0)}TDn(){this.fRb=!1;if(this.p6b){const r=this.Omd,w=this.YUb;this.mAc(!1);this.UYc(r,w)}}wSm(){++this.X7c;this.X7c>Math.floor(this.N8b/2)&&(this.X7c=-1E9,this.sa.raiseEvent("TMUDM"))}mqd(r){this.sa.addHandler("TMUDM",r)}reset(){this.Ftb=this.Zvc=this.amc=this.X7c=0;++this.w7c;for(const r of this.$0)this.clearTimeout(r);this.Qfd=0;this.$0=[];this.mAc(!0);this.fRb&&(this.clearTimeout(this.EIe),this.EIe=0,this.fRb=!1)}init(r,w){this.gRb||(this.nlb=
r,this.N8b=w,this.gRb=!0)}static createInstance(r,w=""){return new l(r,w)}static c1e(r){window.clearTimeout(r)}}l.jwh=15E3;l.Yvh=5;Object(D.a)(l,"MaxOutstandingThrottler",M.a,[884,885])},1639:function(D,M,d){d.d(M,"a",function(){return f});D=d(0);var m=d(8);class f{constructor(a,l=""){this.amc=this.Zvc=0;this.rte=!1;this.YUb=this.Omd=null;this.gRb=!1;this.FYg=a;this.U9i=l;this.setTimeout=f.l1e;this.Ftb=this.Zvc=this.amc=0}bPf(){0<this.Ftb&&0<this.amc&&m.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",
this.U9i,this.amc,this.Ftb);0<this.Ftb&&0<this.Zvc&&m.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.U9i,this.Zvc,this.Ftb)}get p6b(){return this.rte}k6d(a,l){this.Zvc++;this.mAc(!0);this.rte=!0;this.Omd=a;this.YUb=l}mAc(a){this.rte=!1;this.YUb&&a&&(this.amc++,this.YUb.Fxf());this.YUb=this.Omd=null}static l1e(a,l){return window.setTimeout(a,l)}}Object(D.a)(f,"ThrottlerBase",null,[])},1640:function(D,M,d){d.r(M);d.d(M,"MaxRateThrottler",function(){return a});
D=d(0);var m=d(43);M=d(1639);var f=d(1594);class a extends M.a{constructor(l,r=""){super(l,r);this.V8b=0;this.Ypc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(l){this.gRb||(this.V8b=l,this.gRb=!0)}add(l){this.gRb||this.init(a.Mvh);this.Ftb++;const r=this.currentTime(),w=new f.a;this.Ypc>r&&(this.Ypc=r);this.p6b?(this.mAc(!0),this.k6d(l,w)):this.Ypc+this.V8b<=r?this.UYc(l,w):(this.k6d(l,w),this.setTimeout(Object(m.a)(this,this.RDn,"sendThrottledMessage"),this.Ypc+this.V8b-
r));return w}RDn(){if(this.p6b){const l=this.Omd,r=this.YUb;this.mAc(!1);this.UYc(l,r)}}UYc(l,r){this.Ypc=this.currentTime();l=this.FYg(l);l.BWd(w=>{r.OQc(w)});l.AWd(w=>{r.Ygb(w)})}static createInstance(l,r=""){return new a(l,r)}}a.Mvh=200;Object(D.a)(a,"MaxRateThrottler",M.a,[886,885])},1642:function(D,M,d){d.d(M,"a",function(){return m});D=d(0);class m{}m.$Tf="rr";m.lyn="rd";m.hyn="rbp";m.fVf="sa";Object(D.a)(m,"RtcReconnectParams",null,[])},1643:function(D,M,d){d.d(M,"a",function(){return m});
D=d(0);class m{constructor(f,a,l,r){this.iGm=f;this.nlb=a;this.hEm=l;this.COl=r}}Object(D.a)(m,"ThrottlerManagerSettings",null,[])},1683:function(D,M,d){d.r(M);D=d(0);var m=d(8),f=d(43),a=d(79),l=d(1637);class r{}r.V8b="throttling_messageDelay";r.$Nc="enabled";r.nlb="throttling_timeToWaitForResponse";r.N8b="throttling_maxNumberOfOutstandingMessages";r.g0h="throttling_globalMaxNumberOfOutstandingMessages";r.errorMessage="errorMessage";r.e4i="url";r.kDa="queryString";r.$V="connectionString";Object(D.a)(r,
"RtcFindSessionOutputFieldNameConstants",null,[]);var w=d(2),v=d(46),u=d(37),z=d(285),B=d(1351),G=d(81),F=d(16),K=d(121);class N{constructor(){this.h0h=this.Aoi=this.Boi=this.Goi=0;this.POd=!1;this.correlationId=this.$V=this.kDa=this.sXe=this.errorMessage=null}get Yzk(){return this.sXe+"?"+this.kDa}}Object(D.a)(N,"FindSessionResponse",null,[]);var H=d(582);class J{constructor(ca,fa,sa,ia,ea,da){this.qTa=null;const {FindSessionStrategy:ja}=d(1683);this.dQj=ca;ca=String.format("{0}={1}",H.a.clientId,
F.a.Ij(ia));ca=String.format("{0}&{1}={2}",ca,H.a.userSessionId,F.a.Ij(ea));ca=String.format("{0}&{1}={2}",ca,H.a.Yhj,F.a.Ij(sa.toString()));ca=String.format("{0}&{1}={2}",ca,H.a.userType,F.a.Ij("1"));ca=String.format("{0}&{1}={2}",ca,H.a.jij,F.a.Ij(fa));ca=String.format("{0}&{1}={2}",ca,H.a.Ulh,F.a.Ij(ja.Uvk));(fa=J.Z$e(sa,da))&&(ca=String.format("{0}&{1}",ca,fa));this.Qxj=ca}WJi(){this.qTa=this.dQj()}Ncl(){this.qTa&&""!==this.qTa||(this.WJi(),m.ULS.sendTraceTag(575784194,500,this.qTa&&""!==this.qTa?
50:15,"Query signature delegate called for refresh returned: {0} ",this.qTa));const ca=String.format("{0}={1}",H.a.nHb,F.a.Ij(this.qTa));return String.format("{0}&{1}",ca,this.Qxj)}static Z$e(ca,fa){return 4===ca?String.format("{0}={1}",H.a.bsi,"1"):fa?fa.h_h():null}}Object(D.a)(J,"FindSessionQueryStringGenerator",null,[]);var L=d(1488),I=d(1570),R=d(1469),C=d(1643);class P{}P.p8k="FSType";Object(D.a)(P,"RtcFindSessionRequestHeaders",null,[]);class W{}W.Wdn="polling";Object(D.a)(W,"RtcFindSessionTypes",
null,[]);var X=d(1642);class V{}V.Ano="RTC-TokenProofkey";V.Blm="RTC-IsWacJsBootFsRequest";Object(D.a)(V,"RtcRequestHeaders",null,[]);d.d(M,"FindSessionStrategy",function(){return Y});class Y{constructor(ca,fa,sa,ia,ea,da,ja,Ga,ya,ta,ua,Sa,ka=null){this.jMg=(new Date(0)).getTime();this.qOg=0;this.Ked=!1;this.SYg=null;this.tPf=36E5;this.qOb=Y.i6h;this.Amc=0;this.cIb=null;this.KOa=0;this.tcc=this.Eoh=null;this.gRj=[r.$Nc,r.errorMessage,r.e4i,r.$V,r.kDa,r.g0h,r.N8b,r.nlb,r.V8b];this.fRj=[r.$Nc,r.errorMessage];
this.$V=this.$Ma=null;this.ZCg=new J(ua?ua:()=>w.AFrameworkApplication.um,ea,da,ja,ca,fa);this.Kjc=Sa;this.le=ia;this.hg=fa;this.ioe=sa;this.Uv=Ga;this.rm=ya;this.Wmc=ka;this.$Cg=!1;this.JBd=9E4;ta&&ta.execute(ha=>{ha.j$a(()=>{m.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Uv);this.ZCg.WJi()})});2>=100*Math.random()&&(this.tPf=3E5);L.FrequentLoggingMetrics.instance&&(L.FrequentLoggingMetrics.instance.ZIh=this.tPf)}TLn(ca){this.tcc=ca}init(){this.rm.r7j(Object(f.a)(this,
this.kun,"resetGetMachineIdDelay"));this.rm.xya(Object(f.a)(this,this.zfa,"onConnectionStateChanged"))}zfa(ca,fa){this.KOa=fa.newState;2===fa.newState&&(this.Amc=0)}cPh(){let ca;ca=this.cIb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.cIb.kDa,Y.Oqh,F.a.Ij(ca)),correlationId:ca}}nFl(ca,fa,sa,ia,ea){this.XCn(()=>{ia(ea,"GetMachineIdSuccess")&&(m.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.$V,this.Uv),ca(this.SYg),sa(this.vKl()))},
da=>{ia(ea,"GetMachineIdFailure")&&(m.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Uv),fa(da))},ia,ea)}gWk(){this.ylh();this.HZl()}XCn(ca,fa,sa,ia){m.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.$V);if(this.$V)ca();else{var ea=this.Hnk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(ca,fa,sa,ia)},ea)}}sendFindSessionRequestToServerInternal(ca,fa,sa,ia){sa(ia,
"RequestMachineId")&&(this.jMg=(new Date).getTime(),sa=u.a.lf(),this.BEd(ea=>{const da=u.a.lf();this.UBi(ea);this.aXf();ca();ea=u.a.lf()-da;m.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ea)},ea=>{const da=u.a.lf();this.ylh();L.FrequentLoggingMetrics.instance&&L.FrequentLoggingMetrics.instance.UN(2,3);fa(ea);ea=u.a.lf()-da;m.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ea)},!1),sa=u.a.lf()-sa,m.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
sa))}HZl(){this.qOb+=Y.Bwl;this.qOb=Math.min(this.qOb,Y.RDm)}Hnk(){var ca=(new Date).getTime();ca=this.jMg+this.qOb-ca;0>ca&&(ca=0);return ca}UBi(ca){try{this.cIb=ca,this.$Ma=ca.Yzk,this.$V=ca.$V,this.Eoh=ca.kDa,this.SYg=ca.sXe}catch(fa){m.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",fa.toString())}}ylh(){this.$V=null;this.zlh()}aXf(){this.zlh();this.Ked=!0;this.qOg=window.setTimeout(Object(f.a)(this,this.Chn,"refreshMachineId"),this.tPf)}zlh(){this.Ked&&
(window.clearTimeout(this.qOg),this.Ked=!1)}Chn(){this.Ked=!1;this.BEd(ca=>{const fa=this.Eoh!==ca.kDa,sa=this.$V!==ca.$V,ia=this.$V;this.UBi(ca);0!==this.KOa&&(sa?(m.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ia||"null",ca.$V),this.rm.o1d()):(this.rm.Kcn(fa,sa),this.aXf()))},()=>{L.FrequentLoggingMetrics.instance&&L.FrequentLoggingMetrics.instance.UN(2,3);this.aXf()},!0)}kun(){this.qOb=Y.i6h}vKl(){return new C.a(this.cIb.Goi,this.cIb.Boi,
this.cIb.Aoi,this.cIb.h0h)}j9n(ca){if(Object.getType(ca)!==Object)return null;for(let fa in ca);return this.DHk(ca)}DHk(ca){if(!(r.$Nc in ca))return null;const fa=ca[r.$Nc];var sa=fa?this.gRj:this.fRj;for(const ia of sa)if(!(ia in ca))return null;sa=Object.assign(new N,{POd:ca[r.$Nc],errorMessage:ca[r.errorMessage],correlationId:K.a.create().toString()});fa&&(sa.sXe=ca[r.e4i],sa.kDa=ca[r.kDa],sa.$V=ca[r.$V],sa.h0h=ca[r.g0h],sa.Aoi=ca[r.N8b],sa.Boi=ca[r.nlb],sa.Goi=ca[r.V8b]);return sa}Ypl(ca,fa){m.ULS.sendTraceTag(50448152,
500,50,"Using FindSessionUtils find session response");this.Wmc.vGh.continueWith(()=>{this.Wmc.vGh.result?(m.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),ca(this.Wmc.wGh)):(m.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),fa(this.Wmc.wGh))})}CPi(ca,fa,sa,ia,ea=!1){return da=>{I.a.instance.kWc(0,1);ca&&ca.stop();this.Kjc=this.tcc=null;this.Nli(da.data,!0,fa);var ja=R.RtcUtils.deserialize(da.data.Ee,"FindSession",null);if(ja)if(ja=
this.j9n(ja)){if(ja.POd&&ja.kDa&&ja.$V){m.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Uv);this.Mum(da.data);sa(ja);return}fa.FindSessionFailureReason="FindSessionInvalidResponse";fa.IsRtcEnabled=ja.POd;fa.IsQueryStringEmpty=!ja.kDa;fa.IsConnectionStringEmpty=!ja.$V;m.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",
this.Uv,ja.POd,!ja.kDa,!ja.$V)}else fa.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",m.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Uv);else fa.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",m.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Uv);this.SHi(fa,ea);ia(null)}}vPi(ca,fa,sa,ia=!1){return ea=>{I.a.instance.kWc(0,1);ca&&ca.stop();this.Kjc=this.tcc=
null;this.Nli(ea.data,!1,fa);let da=null;var ja="unknown";let Ga="unknown";ea.data&&((ja=ea.data.qj)&&Y.rYc in ja&&(da=ja[Y.rYc].toString()),ja=B.a[ea.data.status],Ga=ea.data.mf.toString());fa.FindSessionFailureReason="FindSessionRequestFailed";fa.HttpErrorCode=Ga;fa.HttpErrorStatus=ja;fa[Y.rYc]=da;m.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",ja,Ga,this.Uv,da,ia);this.SHi(fa,ia);sa(Ga)}}BEd(ca,
fa,sa=!1){let ia=null;m.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Uv);const ea={};var da=this.ZCg.Ncl();ea[z.a.I5]=K.a.create().toString();this.tcc&&""!==this.tcc?da=String.format("{0}&{1}={2}",da,X.a.$Tf,this.tcc):this.Kjc&&""!==this.Kjc&&(da=String.format("{0}&{1}={2}",da,X.a.$Tf,this.Kjc),ea[V.Ano]="True",ea[V.Blm]="True");da=this.ioe+"?"+da;sa&&(ea[P.p8k]=W.Wdn);const ja={};ja.IsNetworkOfflineBeforeSendRequest=this.hg.hMa;ja.HasAvailableConnectionsBeforeSendRequest=
this.hg.AJd;ja.MaxConnectionsAllowed=this.hg.K8b;ja.IsRefreshMachineId=sa;this.Wmc&&!this.$Cg?(this.Ypl(this.CPi(null,ja,ca,fa,sa),this.vPi(null,ja,fa,sa)),this.$Cg=!0):(this.le&&(ia=this.le.fg("WebServiceCall","GetMachineIdFromTheServer")),L.FrequentLoggingMetrics.instance&&L.FrequentLoggingMetrics.instance.UN(2,0),0>this.hg.oWb(da,1,null,ea,[Y.Zvd,Y.rYc,Y.fSc,Y.ZTf,Y.Tqi,Y.zti,Y.yti],1,this.CPi(ia,ja,ca,fa,sa),this.vPi(ia,ja,fa,sa),null,!1,null,this.JBd,"3",null,!0)&&(5<this.Amc&&200>this.Amc&&
m.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Amc),window.setTimeout(()=>{this.Amc++;fa("-1")},1E3)))}Nli(ca,fa,sa){sa||(sa={});sa.IsNetworkOfflineAfterRequestComplete=this.hg.hMa;sa.IsRequestSucceeded=fa;ca&&(sa.EnqueueTime=ca.jKa,sa.InvokedTime=ca.TG,sa.CompletedTime=ca.uS,ca.qj&&(Y.Zvd in ca.qj&&(sa.CorrelationId=ca.qj[Y.Zvd]),Y.fSc in ca.qj&&(sa[Y.fSc]=ca.qj[Y.fSc])));m.ULS.sendTraceTag(38633565,
500,fa?50:15,R.RtcUtils.J9b(sa))}SHi(ca,fa){ca||(ca={});ca.ConnectionState=l.a[this.KOa];fa||this.rm.RHi(1,ca)}Mum(ca){try{var fa=!1,sa=!1,ia=ca.qj,ea=v.a.b2(ca.request.get_url());if(ia&&Y.ZTf in ia){const ta=ia[Y.ZTf].toString().toLocaleLowerCase();sa="true"===ta;fa="false"===ta}ia=!1;const ya=0<=ea.toLocaleLowerCase().indexOf("collab");sa&&!ya?ia=!0:fa&&ya&&(ia=!0);if(ia){fa={};fa.HostName=ea;fa.Status=B.a[ca.status];fa.HttpStatus=ca.mf.toString();var da=ca.request.get_headers();for(let ta in da){var ja=
da[ta];(ea=ta)&&0<ea.length&&(sa=0,ja&&(sa=ja.toString().length),fa["r_"+ea]=sa)}if(ca.qj){const ta=new a.a;ta.add(Y.Zvd);ta.add(Y.fSc);ta.add(Y.rYc);ta.add(Y.zti);ta.add(Y.yti);ta.add(Y.Tqi);Y.c3j(fa,ca.qj,ta)}Y.N2j(ca.request.get_url(),fa);var Ga=G.a.toJSON(fa);m.ULS.sendTraceTag(559437006,500,15,Ga)}}catch(ya){m.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",ya.toString())}}static createInstance(ca,fa,sa,ia,ea,da,ja,Ga,ya,ta,ua,Sa=null){return Y.CIk(ca,fa,sa,ia,ea,da,
ja,Ga,ya,ta,ua,Sa)}static CIk(ca,fa,sa,ia,ea,da,ja,Ga,ya,ta,ua,Sa=null){ca=ca||K.a.create().toString();ca=new Y(ca,fa,sa,ia,ea,da,ja,Ga,ya,ta,null,ua,Sa);ca.init();return ca}static c3j(ca,fa,sa){for(let ia of sa)ia in fa&&(ca[ia]=fa[ia])}static N2j(ca,fa){if(ca){var sa=ca.indexOf("?");if(-1!==sa)for(ca=ca.substr(sa+1).split("&"),sa=0;sa<ca.length;++sa){var ia=ca[sa].split("=");if(2===ia.length){const ea=ia[0];if(ea&&0<ea.length){let da=0;if(ia=ia[1])da=ia.length;fa["q_"+ea]=da}}}}}}Y.Bwl=3E3;Y.RDm=
3E5;Y.Uvk="1.0";Y.i6h=1E3;Y.Zvd="X-CorrelationId";Y.Oqh="corrid";Y.rYc="RtcErrorCode";Y.fSc="X-OfficeCluster";Y.ZTf="X-NewEnv";Y.Tqi="X-MSEdge-Ref";Y.yti="X-OFFICEFD";Y.zti="X-OfficeFE";Object(D.a)(Y,"FindSessionStrategy",null,[871])},1696:function(D,M,d){d.r(M);D=d(0);var m=d(8),f=d(43),a=d(430),l=d(59),r=d(79);class w{constructor(u){this.messageId=u;this.VDn=(new Date).getTime();this.luf=new r.a}}Object(D.a)(w,"MessageLatencyDetails",null,[]);d.d(M,"ClientToClientMessageTelemetry",function(){return v});
class v{constructor(u,z,B){this.sHa=null;this.fxe=this.iFe=0;this.Md=z;this.mPg=B;this.Ouc=!1;this.rm=u;this.rm.j1(Object(f.a)(this,this.ven,"receiveMessage"))}start(){if(this.mPg&&!this.Ouc){const u=this.Md.eSi;this.fxe=this.Md.$Ri;u<=this.fxe?(m.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Md.eSi,this.Md.$Ri),this.mPg=!1):
(this.Ouc=!0,this.iFe=window.setInterval(Object(f.a)(this,this.sendMessage,"sendMessage"),u))}}sendMessage(){if(this.Ouc){const u=l.a.create().toString();this.sHa=new w(u);this.rm.nOf(16,u,!1,new a.a);window.setTimeout(()=>{this.axm(u)},this.fxe)}}axm(u){this.sHa&&this.sHa.messageId===u&&(0<this.sHa.luf.count?(u=this.sHa.luf.toArray().join(","),m.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",u)):m.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.sHa=
null)}stop(){this.iFe&&(window.clearInterval(this.iFe),this.Ouc=!1)}ven(u,z){16===z.type?this.rm.nOf(17,z.WI,!1,new a.a):17===z.type&&this.Ouc&&z.WI&&this.e8m(z.WI)}e8m(u){u&&this.sHa&&u.toString()===this.sHa.messageId&&(u=(new Date).getTime()-this.sHa.VDn,this.sHa.luf.add(u))}static get instance(){return v._instance}static D2b(u,z,B){return v.instance||(v._instance=new v(u,z,B))}}v._instance=null;Object(D.a)(v,"ClientToClientMessageTelemetry",null,[])},1788:function(D,M,d){d.d(M,"a",function(){return m});
D=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.VEa=f;this.yyd=a}}Object(D.a)(m,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1789:function(D,M,d){d.r(M);d.d(M,"RealtimeChannelMetrics",function(){return r});D=d(0);var m=d(8),f=d(184),a=d(81),l=d(1469);class r{constructor(){this.WQg=this.XQg=this.YQg=this.TQg=this.SQg=this.UQg=this.Frc=this.Qye=0;this.w$c=this.Yve=this.$pc=this.Kve=this.Lve=this.yve=this.t7a=this.Mpc=this.qRb=this.xve=this.u$c=this.KPb=null;this.rxe=this.Sqc=this.QYg=
this.xwg=0;this.nPg=!1;this.PIi=this.NOf;this.SIi=this.QOf;this.RIi=this.POf;this.WIi=this.TOf;this.VIi=this.SOf;this.cPf=this.dPf;this.$Of=this.aPf;this.zHb=this.YOf;this.lWc=this.ZOf;this.QIi=this.OOf;this.mNa=this.XBf;this.mhb=this.YBf}NOf(){this.Qye++;this.xve=new Date;this.KPb||(this.KPb=new Date)}QOf(){this.Frc++;this.t7a=new Date;this.u$c||(this.u$c=this.t7a);this.$pc=this.t7a;this.oAk()}POf(){this.UQg++;this.yve=new Date}TOf(){this.SQg++;this.qRb=new Date}SOf(){this.TQg++;this.Mpc=new Date}aPf(){this.Lve=
new Date;this.YQg++}ZOf(){this.w$c||(this.w$c=new Date);this.XQg++}YOf(){this.Kve=new Date;this.WQg++}dPf(){!this.nPg&&this.Qye&&(m.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.Axk())),this.nPg=!0)}OOf(w){let v,u;({E4h:w,G4h:v,exception:u}=l.RtcUtils.n4k(w));w&&w!==f.a.qD&&(m.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:w,["HttpErrorStatus"]:v,["Exception"]:u})),f.a.bof(w)&&this.xwg++,f.a.Zrf(w)&&this.QYg++)}XBf(){this.Yve=new Date}YBf(){this.qRb=this.$pc=new Date}Axk(){return{["numberOfConnectionAttempts"]:this.Qye,
["numberOfSuccessfulConnections"]:this.Frc,["numberOfFailedConnections"]:this.UQg,["numberOfDisconnectedConnections"]:this.SQg,["numberOfExplicitDisconnectedConnections"]:this.TQg,["numberOfSentMessages"]:this.YQg,["numberOfReceivedMessages"]:this.XQg,["numberOfLostMessages"]:this.WQg,["firstConnectionAttempt"]:this.KPb?this.KPb:null,["firstMessageReceived"]:this.w$c?this.w$c:null,["firstConnectionSuccess"]:this.u$c?this.u$c:null,["lastConnectionAttempt"]:this.xve?this.xve:null,["lastConnectionSuccess"]:this.t7a?
this.t7a:null,["lastConnectionFailure"]:this.yve?this.yve:null,["lastMessageSent"]:this.Lve?this.Lve:null,["lastMessageLost"]:this.Kve?this.Kve:null,["lastDisconnect"]:this.qRb?this.qRb:null,["lastExplicitDisconnect"]:this.Mpc?this.Mpc:null,["lastTimeOnline"]:this.$pc?this.$pc:null,["lastTimeOffline"]:this.Yve?this.Yve:null,["maxDisconnectedTimeMs"]:this.Sqc,["maxExplicitDisconnectedTimeMs"]:this.rxe,["clientConnectionErrors"]:this.xwg,["serverConnectionErrors"]:this.QYg}}oAk(){this.KPb&&1===this.Frc&&
(this.Sqc=Math.max(this.Sqc,this.t7a.getTime()-this.KPb.getTime()));this.qRb&&1<this.Frc&&(this.Sqc=Math.max(this.Sqc,this.t7a.getTime()-this.qRb.getTime()));this.Mpc&&1<this.Frc&&(this.rxe=Math.max(this.rxe,this.t7a.getTime()-this.Mpc.getTime()))}static createInstance(w){r._instance||(r._instance=new r,m.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",w));return r._instance}}r._instance=null;Object(D.a)(r,"RealtimeChannelMetrics",null,[870,211])},1790:function(D,
M,d){d.d(M,"a",function(){return m});D=d(0);class m extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.VEa=a}}Object(D.a)(m,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1791:function(D,M,d){d.d(M,"a",function(){return m});D=d(0);class m extends Sys.EventArgs{constructor(f){super();this.$td=f}}Object(D.a)(m,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1916:function(D,M,d){d.r(M);var m=d(0),f=d(43);class a{constructor(za,rb){this.I8=null;this.Ssc=za;this.cPj=rb}init(){this.Ssc.continueWith(()=>
{this.I8=this.Ssc.result;this.I8.BWb(Object(f.a)(this,this.Q6,"onUsersUpdated"))})}Q6(){a.tQe(this.I8.wXa())&&(this.I8.C2d(Object(f.a)(this,this.Q6,"onUsersUpdated")),this.cPj.IsRealCoauthSession=!0)}get bhm(){return this.I8?a.tQe(this.I8.wXa()):!1}static tQe(za){let rb=null;for(const Zb of za)if(Zb)if(za=Zb.isAnonymous||!Zb.email?Zb.clientId:Zb.email.toUpperCase(),!rb)rb=za;else if(rb!==za)return!0;return!1}}Object(m.a)(a,"CoauthTelemetry",null,[703]);var l=d(8),r=d(430),w=d(72),v=d(2),u;(function(za){za[za.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";za[za.notImplemented=1]="notImplemented";za[za.renderHandled=2]="renderHandled";za[za.renderHandledWithVeto=3]="renderHandledWithVeto"})(u||(u={}));Object(m.b)("CoauthorGalleryTelemetryEndResult",u);var z=d(84),B=d(81),G=d(122);class F{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){this.dUg=this.Rwg=this.qC=null;this.R3=za;this.Eld=new r.a;this.Ma=Zb;this.jje=rb;this.W3=yc;this.Mg=Vc;this.nBe=Sd;this.t8a=de;this.puj=jf;this.OFg=this.GFg=!1;this.Tmd=0;this.Pwg=1;this.knb=Ke;
this.Jwc=this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");this.zoa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get t6i(){return this.Eld.task}init(){G.Task.WAA.call(null,this.t8a,this.jje,this.nBe).continueWith(()=>{this.qC=this.t8a.result;this.Rwg=this.jje.result;this.dUg=this.nBe.result;G.Task.WAA.call(null,this.jje.result.JYb,this.nBe.result.b$i).continueWith(()=>{this.Pwg=this.Rwg.JYb.result;this.Tmd=this.dUg.b$i.result;this.qC.BWb(Object(f.a)(this,this.EXd,
"onUsersUpdatedEventListener"));this.qC.wXa().length&&this.Q6()})})}EXd(){this.Q6()}Q6(){this.puj(this.qC.wXa())?(this.qC.C2d(Object(f.a)(this,this.EXd,"onUsersUpdatedEventListener")),this.pQm(this.GFg)):this.Eld.vU(1);this.GFg=!0}pQm(za){this.OFg?this.t6i.continueWith(()=>{l.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",u[this.t6i.result])}):(this.OFg=!0,this.U8m(0===this.Pwg&&!za))}U8m(za){za?this.W3.sl(4,Object(f.a)(this,this.AFf,"onInteractiveReady")):
this.Eld.vU(1)}AFf(){const za=this.Mg.OG("AppInitStatus_interactivityReady");l.ULS.shipAssertTag(42259235,325,!!this.Tmd);const rb=this.Tmd-za,Zb={};Zb.InteractiveTime=za;Zb.ReactRenderComplete=this.Tmd;Zb.HadTabSwitch=this.knb();Zb.IsModernGallery=this.Jwc;l.ULS.sendTraceTag(594883104,325,50,B.a.toJSON(Zb));this.Jwc?(l.ULS.sendTraceTag(42062997,325,15,rb.toString()),this.Eld.vU(this.Tno(rb)?3:2)):l.ULS.sendTraceTag(594883103,325,15,rb.toString())}Tno(za){const rb=za>this.Ma.rc("CoauthorGalleryTimeToRenderDurationMs",
1E4),Zb="Word"===this.zoa;if(this.knb())return l.ULS.sendTraceTag(50455714,325,50,rb.toString()),!1;Zb&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);rb&&(Zb&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),l.ULS.sendTraceTag(42062998,325,15,za.toString()));return rb}}Object(m.a)(F,"CoauthorGalleryTelemetry",null,[702]);class K{constructor(za){this.qC=null;this.f7c={};this.thd=
{};this.yoc=null;this.t8a=za}xGd(za){const rb=new r.a;this.init().continueWith(()=>{za in this.f7c?rb.vU(this.f7c[za]):this.thd[za]=rb});return rb.task}init(){if(this.yoc)return this.yoc.task;this.yoc=new r.a;this.t8a.continueWith(()=>{this.qC=this.t8a.result;this.qC.BWb(Object(f.a)(this,this.Q6,"onUsersUpdated"));this.xgj();this.yoc.Gg(null)});return this.yoc.task}xgj(){const za=this.qC.wXa();za.sort(Object(f.a)(this,this.Qzk,"comparePresenceUsers"));this.f7c={};for(let rb=0;rb<za.length&&za[rb]&&
za[rb].CMa;rb++)this.E2j(this.f7c,za[rb].clientId,rb)}E2j(za,rb,Zb){za[rb]=Zb;rb in this.thd&&(this.thd[rb].vU(Zb),delete this.thd[rb])}Q6(){this.xgj()}Qzk(za,rb){return za.CMa>rb.CMa?1:za.CMa<rb.CMa?-1:0}}Object(m.a)(K,"CoauthorPositionFinder",null,[704]);var N=d(79),H=d(195);class J{constructor(za,rb,Zb,yc){this.I8=null;this.Gme=this.iye=!1;this.Ssc=za;this.NHe=rb;this.Ma=Zb;this.$Rb=yc}get s0e(){return this.Ma.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Ssc.continueWith(()=>
{this.I8=this.Ssc.result;this.I8.BWb(Object(f.a)(this,this.Q6,"onUsersUpdated"))})}Q6(){this.yxk(this.I8.wXa());!this.iye||this.s0e&&!this.Gme||this.I8.C2d(Object(f.a)(this,this.Q6,"onUsersUpdated"))}yxk(za){const rb=new N.a;let Zb=0;for(const yc of za)if(yc&&yc.isAnonymous){v.AFrameworkApplication.Hf("70eb6120;2gfeb930");if(this.s0e&&!this.Gme)if(rb.contains(yc.userName)){const Vc=this.XKl(za);l.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected among {0} total guest coauthors",
Vc);this.Gme=!0}else rb.add(yc.userName);yc.clientId===this.$Rb||this.iye||(Zb++,2<=Zb&&this.jxm())}}jxm(){l.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.iye=!0;this.s0e&&this.NHe&&this.NHe.continueWith(()=>{window.setTimeout(()=>{this.NHe.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}XKl(za){return H.a.nf(za)?0:H.a.x9f(za,rb=>rb.isAnonymous).length}}Object(m.a)(J,"GuestCoauthTelemetry",null,[]);var L=d(244);class I{constructor(){this.id=null;
this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(m.a)(I,"PL",null,[]);var R=d(35);class C{constructor(){this.ct=this.vt=this.d=0}static BVi(za,rb,Zb){const yc=new C;yc.d=za;yc.vt=rb;yc.ct=Zb;return R.c(yc)}}Object(m.a)(C,"VD",null,[]);var P=d(166);class W{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){this.ZYg=!1;this._id=za;this.Fi=rb;this.Dr=Zb;this.jye=yc;this.BIe=Vc;this.Ztb=Sd;this.aob=de;this.Swj=jf;this.knb=Ke;this.zoa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||
""}qce(za){G.Task.WAA(this.jye,this.BIe).continueWith(()=>{if(this.jye.result<=this.BIe.result)za.vU(!1);else{var rb=this.Dr-this.Fi,Zb=new I;Zb.id=this._id;Zb.et=this.Dr;Zb.st=this.Fi;Zb.d=this.Dr-this.Fi;Zb.mp=this.jye.result;Zb.tp=this.BIe.result;Zb.ct=this.Cjl(this.Swj);Zb.vc=this.knb();var yc=R.c(Zb),Vc="Word"===this.zoa;l.ULS.sendTraceTag(42078597,302,15,yc);if(Vc){const Sd=new Map;Sd.set("data",yc);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Sd)}rb>this.Ztb.value&&
!this.ZYg&&!Zb.vc&&(this.ZYg=!0,za.vU(!0),Zb=Object.assign(new P.a,{inStaging:!0,extendedProperties:new Map}),Zb.extendedProperties.set("data",yc),Vc&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Zb),rb<this.aob.value&&l.ULS.sendTraceTag(42078598,302,15,C.BVi(rb,this.Ztb.value,this.aob.value)));za.task.isCompleted||za.vU(!1)}})}Cjl(za){switch(za){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(m.a)(W,
"PresenceLatencyActivityLogger",null,[]);class X{constructor(za,rb,Zb){this.Ivg=this.Nwg=this.N6c=this.e7c=this.YMb=0;this._id=za;this.Ztb=rb;this.aob=Zb;this.zoa=Object(w.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get d$g(){return this.YMb}set d$g(za){this.YMb=za;this.PUe()}get vmh(){return this.e7c}set vmh(za){this.e7c=za;this.PUe()}get Rih(){return this.N6c}set Rih(za){this.N6c=za;this.PUe()}get wmh(){return 0!==this.Nwg}get Sih(){return 0!==this.Ivg}PUe(){!this.wmh&&
this.YMb&&this.e7c&&(this.Nwg=this.qce(this.e7c,"CoauthGalleryLightupDurationTooLong"));!this.Sih&&this.YMb&&this.N6c&&(this.Ivg=this.qce(this.N6c,"CanvasPresenceLightupDurationTooLong"))}qce(za,rb){const Zb=za-this.YMb;var yc=new I;yc.id=this._id;yc.et=za;yc.st=this.YMb;yc.d=Zb;var Vc=R.c(yc);za="Word"===this.zoa;yc="CanvasPresenceLightupDurationTooLong"===rb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===rb?l.ULS.sendTraceTag(572289499,302,
15,Vc):l.ULS.sendTraceTag(571524118,302,15,Vc);if(za){var Sd=new Map;Sd.set("data",Vc);z.Health.instance.recordKpiUsage(yc,0,"wordcollabrel",Sd)}return Zb>this.Ztb.value?(Sd=Object.assign(new P.a,{inStaging:!0,extendedProperties:new Map}),Sd.extendedProperties.set("data",Vc),Vc=Zb<this.aob.value,Sd.extendedProperties.set("cash",Vc?"true":"false"),za&&z.Health.instance.recordKpiFailure(yc,rb,!1,!0,Sd),l.ULS.sendTraceTag(572289500,302,15,C.BVi(Zb,this.Ztb.value,this.aob.value)),Vc?2:1):3}}Object(m.a)(X,
"PresenceLightupLatencyLogger",null,[]);var V=d(39),Y=d(156);class ca{constructor(za,rb,Zb,yc,Vc,Sd,de=null,jf=null,Ke=null){this.gVg={};this.ije={};this.ELg=new N.a;this.zoc=this.qC=this.ij=null;this.O_g=this.N_g=0;this.Ztb=new L.a(()=>de.PP("PresenceBootLatencyThreshold",1E4));this.aob=new L.a(()=>de.PP("PresenceBootLatencyCutoffThreshold",6E4));this.nYj=new L.a(()=>de.PP("PresenceLightupLatencyThreshold",2E3));this.Ryj=new L.a(()=>de.PP("PresenceLightupLatencyCutoffThreshold",1E4));this.jPj=yc;
this.Qwg=za;this.JXg=rb;this.t8a=Zb;this.Mg=Vc;this.$Rb=jf;this.knb=Sd;this.yh=Ke;this.Cug=!1;this.init()}vEc(za,rb,Zb=null,yc=0){Zb&&(l.ULS.shipAssertTag(42274970,302,!this.$Rb||this.$Rb===Zb,"_myClientId is already set and you are trying to update it to something different"),this.$Rb=Zb);const Vc=new r.a;this.init().continueWith(()=>{this.JTm(za);this.T_k(Vc,za,rb,yc)})}get bri(){return this.$Rb||"{"+v.AFrameworkApplication.userSessionId+"}"}init(){if(this.zoc)return this.zoc.task;this.zoc=new r.a;
this.knb()&&l.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Qwg.continueWith(()=>{const za=this.Qwg.result,rb=za.JYb,Zb=za.wHm;Zb.continueWith(()=>{rb.continueWith(()=>{this.yh&&this.yh.addQosPillar("RealTimeCoauth");this.$0f(rb.result,Zb.result);this.zoc.Gg(null)})})});this.JXg.continueWith(()=>{this.ij=this.JXg.result;this.ij.xya(Object(f.a)(this,this.LUm,"onRtcConnection"));this.ij.j1(Object(f.a)(this,this.nOm,"onCoauthorBootReceived"))});this.t8a.continueWith(()=>{this.qC=this.t8a.result;
this.qC.BWb(Object(f.a)(this,this.EXd,"onUsersUpdatedEventListener"));0<this.qC.wXa().length&&this.Q6()});return this.zoc.task}jMh(){return this.Mg.Rja(V.a.Q3a)?this.Mg.OG(V.a.Q3a):Y.a.V$a?window.performance.timing.fetchStart:-1}LUm(za,rb){this.Cug||2!==rb.newState||(za=Date.now()-this.jMh(),rb={},rb.clientId=this.bri,rb.bootTime=za,this.Cug=!0,this.ij.kO(15,rb))}nOm(za,rb){if(15===rb.type){za=Date.now();rb=rb.WI;var Zb=rb.bootTime;this.Fdf(rb.clientId).d$g=za-Zb}}EXd(){this.Q6()}Q6(){const za=Date.now();
var rb=this.qC.wXa();const Zb=new N.a;for(const yc of rb)this.ELg.contains(yc.clientId)||(this.ELg.add(yc.clientId),Zb.add(yc.clientId));if(0<Zb.count)for(let yc of Zb)rb=this.Fdf(yc),rb.wmh||(rb.vmh=za)}JTm(za){za=this.Fdf(za);za.Sih||(za.Rih=Date.now())}Fdf(za){return za in this.ije?this.ije[za]:this.ije[za]=new X(za,this.nYj,this.Ryj)}$0f(za,rb=0){this.N_g=za;this.O_g=rb?rb:(new Date).getTime()}T_k(za,rb,Zb,yc){Zb=Zb?Zb.getTime():(new Date).getTime();rb in this.gVg?za.Yga():(yc=new W(rb,this.RHl(),
Zb,this.xGd(this.bri),this.xGd(rb),this.Ztb,this.aob,yc,this.knb),this.gVg[rb]=yc,yc.qce(za))}RHl(){return 1===this.N_g?this.O_g:this.jMh()}xGd(za){return this.jPj.xGd(za)}}Object(m.a)(ca,"PresenceBootTelemetry",null,[701]);var fa=d(124),sa=d(177),ia=d(198),ea=d(22),da=d(730);class ja{get name(){return"Common.App.CoauthTelemetry"}zc(za){za.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Xd(()=>new a(da.a.Iq(za.Za("Common.IPeopleInfoProvider")),
v.AFrameworkApplication.jh));za.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Xd(()=>new F(v.AFrameworkApplication.ya,da.a.Iq(za.Za("Common.ICoauthoringTelemeryInfoProvider")),v.AFrameworkApplication.K,fa.a.get_instance(),ia.a.instance,da.a.Iq(za.Za("Common.IPeoplesWell")),da.a.Iq(za.Za("Common.IPeopleInfoProvider")),a.tQe,()=>this.Efh()));za.register(ca,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Xd(()=>
new ca(da.a.Iq(za.Za("Common.ICoauthoringTelemeryInfoProvider")),da.a.Iq(za.Za("Common.IRealtimeChannelBasic")),da.a.Iq(za.Za("Common.IPeopleInfoProvider")),za.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),ia.a.instance,()=>this.Efh(),v.AFrameworkApplication.K,null,z.Health.instance));za.register(K,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Xd(()=>new K(da.a.Iq(za.Za("Common.IPeopleInfoProvider"))));
za.register(J,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Xd(()=>new J(da.a.Iq(za.Za("Common.IPeopleInfoProvider")),da.a.Iq(za.Za("Common.ISystemInitiatedFeedback")),v.AFrameworkApplication.K,"{"+v.AFrameworkApplication.userSessionId+"}"))}init(){v.AFrameworkApplication.K.yq(()=>{ea.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();ea.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&
ea.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();v.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(ea.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),ea.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}Efh(){return Y.a.V$a&&ia.a.instance.Rja(V.a.r3c)?0<ia.a.instance.OG(V.a.r3c)[V.a.kjj]:!1}static main(){sa.a.instance.Pc(new ja)}}Object(m.a)(ja,"CoauthTelemetryPackage",null,[1,2]);class Ga extends Sys.EventArgs{constructor(){super()}}
Object(m.a)(Ga,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ya;(function(za){za[za.notYetStarted=0]="notYetStarted";za[za.polling=1]="polling";za[za.subscribed=2]="subscribed";za[za.blocked=3]="blocked";za[za.permanentlyStopped=4]="permanentlyStopped"})(ya||(ya={}));Object(m.b)("RtcHostNotificationSubscriptionState",ya);var ta=d(80),ua=d(1385),Sa=d(67);class ka{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){this.qh=!1;this.Q8=this.mTb=this.Mca=this.BTa=null;this.zvc=ka.dfe;this.sa=new Sa.a;this.q9a=
new ua.a(0);this.q9a.hOe(Object(f.a)(this,this.PVm,"onStateMachineChanged"));this.QRj=za;this.Qjd=rb;this.PRj=Zb;this.iEe=yc;this.Hb=Vc;this.kf=Sd;de.execute(Je=>{this.qh||(this.mTb=Je,this.mTb.j1(Object(f.a)(this,this.taa,"onUpdateNotificationReceived")),this.start())});jf.execute(Je=>{this.qh||(this.Q8=Je,Je.j$a(Object(f.a)(this,this.OCa,"onTokenRefreshed")))});this.Smd=Ke}get Uec(){return this.q9a.currentState}get sfi(){return!this.kf||this.kf.Hta}get Pfi(){return 2===this.Uec&&this.Smd()<this.zvc}start(){0!==
this.Uec?l.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",ya[this.Uec]):(this.q9a.event(1),this.wVf(null))}wVf(){this.BTa=null;if(this.sfi){l.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ya[this.Uec]);let za=null;this.iEe&&this.iEe.length&&(za={},za.etts=this.iEe);this.mTb.kO(14,za,!0);this.xTi(this.QRj)}else this.q9a.event(3)}xTi(za){this.BTa=ta.a.F9(1E3*za,Object(f.a)(this,this.wVf,"sendSubscribeEvent"),
this.Qjd,192,"RtcHostNotificationSubscribe");this.Hb.$b(this.BTa)}GAn(za){za=1E3*(za+this.PRj);const rb=this.Smd().getTime()+za;this.zvc=new Date(rb);za-=this.Qjd;this.Mca?this.Hb.e3(this.Mca,za):(this.Mca=ta.a.F9(za,Object(f.a)(this,this.c9n,"transitionToPollingEvent"),this.Qjd/2,194,"RtcHostNotificationTransitionToPolling"),this.Hb.$b(this.Mca))}c9n(){this.Mca=null;2===this.Uec&&(this.q9a.event(1),l.ULS.shipAssertTag(573100185,502,!!this.BTa,"Missing task to ensure that we re-subscribe."))}OCa(){this.cQl()}cQl(){3===
this.Uec&&this.sfi&&(this.q9a.event(this.Pfi?2:1),this.wVf(null))}taa(za,rb){if(13===rb.type&&(za=rb.WI,l.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:za,["DurationBeforeExpirationToResubscribeInSec"]:this.Qjd}),rb=za.cts,!this.zao(rb))){if(za.sb){var Zb=2;this.GAn(za.cts)}else Zb=1,this.zvc=ka.dfe,this.Mca&&(this.Hb.ef(this.Mca),this.Mca=null);this.q9a.event(Zb);this.BTa?this.Hb.e3(this.BTa,1E3*rb):this.xTi(rb)}}zao(za){if(!isNaN(za)&&
isFinite(za)&&0<za)return!1;this.H6i(!1);return!0}H6i(za){this.BTa&&(this.Hb.ef(this.BTa),this.BTa=null);this.Mca&&(this.Hb.ef(this.Mca),this.Mca=null);this.mTb&&(this.mTb.RHb(Object(f.a)(this,this.taa,"onUpdateNotificationReceived")),this.mTb=null);this.Q8&&(this.Q8.Hbc(Object(f.a)(this,this.OCa,"onTokenRefreshed")),this.Q8=null);za||this.q9a.event(4)}PVm(za,rb){za=rb.newState;const Zb=rb.tLf,yc={};yc.NewState=ya[za];yc.PreviousState=ya[Zb];yc.PreviousStateHits=rb.uLf;yc.PreviousStateTransitionTime=
rb.vLf.toISOString();yc.IsSubscribed=this.Pfi;this.zvc!==ka.dfe&&(yc.SubscriptionExpiringTime=this.zvc.toISOString());l.ULS.sendTraceTag(572346515,502,4===za?15:50,"HostNotificationChanged: {0}",yc);this.sa.raiseEvent("HN",new Ga(Zb,za))}dispose(){this.qh||(this.qh=!0,this.H6i(!0),this.Mca&&(this.Hb.ef(this.Mca),this.Mca=null))}}ka.dfe=new Date(0);Object(m.a)(ka,"RtcHostNotificationSubscriptionManager",null,[700,10]);var ha=d(388);class Ca{constructor(){this.zh=this.qh=!1}get name(){return"RtcHostNotificationSubscription"}zc(za){za.register(ka,
"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Xd(()=>{const rb=v.AFrameworkApplication.K;return new ka(rb.rc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),rb.rc("RtcHostNotificationRetryIntervalBufferInSeconds",120),rb.rc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.FFl(rb),v.AFrameworkApplication.uc,ha.SessionStatusManager.instance,
za.Za("Common.IRealtimeChannelBasic"),za.Za("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.K.yq(()=>{!this.qh&&v.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&(this.zh=!0,ea.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.qh||(this.qh=!0,this.zh&&ea.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}FFl(za){return za.vu("RtcEventTypesToSubscribe")?
za.AB("RtcEventTypesToSubscribe"):null}static main(){sa.a.instance.Pc(new Ca)}}Object(m.a)(Ca,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Pa=d(490),Xa=d(642);class qa{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh){this.clientId=za;this.SkypeChatThreadId=Zb;this.chatThreadDiscoveryUri=yc;this.inChat=Vc;this.localColbaltSessionId=rb;this.capabilities=Sd;this.email=de;this.isReadOnly=jf;this.userName=Ke;this.isAnonymous=Je;this.presenceStatus=Sh}}Object(m.a)(qa,"SerializablePresenceUserData",
null,[]);class Ea extends Pa.a{constructor(za,rb,Zb,yc,Vc=null,Sd=null,de=null,jf=null,Ke=null,Je=!1,Sh=!1,sc=!1,mg=null){super(za,rb,Zb,yc,Sd,de,jf,Ke,Je,Sh,sc);this.pQ=Vc;this.presenceStatus=mg}getData(){return new qa(this.clientId,this.pQ,this.Ozc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}yGd(za){return(za=za.value)?za.user:null}clone(){return new Ea(this.clientId,this.userName,this.color,
this.capabilities.clone(),this.pQ,this.Ozc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static Rwb(za){return za.clientId?new Ea(za.clientId,za.userName,null,new Xa.a(void 0===za.capabilities?0:za.capabilities),za.localColbaltSessionId,za.SkypeChatThreadId,za.email,null,za.chatThreadDiscoveryUri,za.isAnonymous,za.inChat,za.isReadOnly,za.presenceStatus):null}static esh(za,rb,Zb,yc=null,Vc=null,Sd=null,de=null,jf=null,Ke=!1,Je=
!1,Sh=!1,sc=null){return za?new Ea(za,rb,null,new Xa.a(void 0===Zb?0:Zb),yc,Vc,Sd,de,jf,Sh,Ke,Je,sc):null}}Object(m.a)(Ea,"PresenceUser",Pa.a,[1176,1177,26]);class Ia extends Ea{constructor(){super();this.Aac=this.Hvf=null}Nxl(){const za=v.AFrameworkApplication.userName,rb=v.AFrameworkApplication.K.lb("UserPrincipalName"),Zb=this.Hvf?this.Hvf.pQ:null,yc=v.AFrameworkApplication.s3c||v.AFrameworkApplication.Kta,Vc=this.Aac?this.Aac.getStatus():null;return new Ea(this.clientId,za,this.color,this.capabilities,
Zb,this.Ozc,rb,this.client,this.chatThreadDiscoveryUri,yc,this.inChat,this.isReadOnly,Vc)}}Object(m.a)(Ia,"MyPresenceUser",Ea,[1229,26]);var na=d(221);class Na{constructor(za,rb,Zb,yc,Vc){this.Md=za;this._clientId=rb;this.Uzj=Vc;this.XDj=Zb||(()=>null);this.YDj=yc||(()=>null)}get id(){return this.Md.id}get Wod(){return this.Md.Wod}get $od(){return this.Md.$od}get Zod(){return this.Md.Zod}get Yod(){return this.Md.Yod}get Xod(){return this.Md.Xod}get bpd(){return this.Md.bpd}get WLe(){return this.Md.WLe}get vec(){return this.Md.vec}get X7d(){return this.Md.X7d}get lUd(){return this.Md.lUd}get clientId(){return this._clientId}get hJc(){return this.XDj}get Mdb(){return this.YDj}get RVk(){return this.Uzj}static createInstance(za,
rb,Zb,yc,Vc=!1){return new Na(za,rb,Zb,yc,Vc)}}Object(m.a)(Na,"PeoplesWellSettings",null,[]);var Oa=d(9),Ra=d(56),ab=d(160),zb=d(83),Qa=d(213),yb=d(236),lb=d(439),Eb=d(359);class bc extends Qa.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(m.a)(bc,"PeopleButtonProps",Qa.a,[]);var Pb=d(357),Va=d(348),oa=d(16),pa=d(121),Ya=d(373),Ja=d(82);class nb{constructor(za){this.t3c=new Ja.a;
this.q0e=null;this.clientId=za}LNn(za){this.ymn();this.wGn(za);for(const rb of za)rb.clientId!==this.clientId&&this.a8g(rb)}get p8f(){const za=[];for(let rb of this.t3c.values){const Zb=this.wUi(rb);Array.add(za,Zb)}return za}get whb(){return this.t3c.count}HNe(za,rb){za=za.toUpperCase();let Zb;({value:Zb}=this.t3c.Dc(za)).returnValue||(Zb=[],this.t3c.Z(za,Zb));Array.add(Zb,rb)}ymn(){this.t3c=new Ja.a}wGn(za){for(const rb of za)if(rb.clientId===this.clientId){this.q0e=rb;break}}}Object(m.a)(nb,"UserTracker",
null,[980]);class Bb extends nb{constructor(za,rb){super(za);this.ZDj=rb}a8g(za){za.isAnonymous||!za.email?this.HNe(za.clientId,za):this.q0e&&Ya.a.Pj().equals(this.q0e.email,za.email)||this.HNe(za.email,za)}wUi(za){let rb=new Date(0),Zb=0<za.length?za[0]:null;for(const yc of za)(za=this.ZDj(yc.clientId))&&rb.getTime()<za.U7b.getTime()&&(rb=za.U7b,Zb=yc);return Zb}}Object(m.a)(Bb,"UniqueUserTracker",nb,[]);class mb extends nb{constructor(za){super(za)}a8g(za){this.HNe(za.clientId,za)}wUi(za){return za[0]}}
Object(m.a)(mb,"UserInstanceTracker",nb,[]);const Qb=(za,rb,Zb)=>Zb?new Bb(za,rb):new mb(za);var Vb=d(60),mc=d(607),ob=d(13);class cb{constructor(za,rb=null,Zb=null){this.qC=null;this.KIe=new r.a;this.Md=za;this.jZd=rb;Zb&&Zb.continueWith(()=>{this.qC=Zb.result;this.qC.BWb(Object(f.a)(this,this.Q6,"onUsersUpdated"));this.L1d()});new Pa.a(this.settings.clientId,"Anonymous user","#cccccc",new Xa.a(7));this.yNd=this.xue=!0;this.fqe=this.mBe=!1;this.Sva=Qb(this.settings.clientId,this.settings.Mdb,za.RVk)}get settings(){return this.Md}get U8l(){return v.AFrameworkApplication.K?
v.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get l$h(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}yll(){let za;let rb,Zb,yc,Vc;var Sd=this.zll();this.Sva.whb?1===this.Sva.whb?(rb=!0,Zb=this.settings.vec.cluster,yc=this.settings.vec.$wd,Vc=this.Sva.p8f[0].color):(rb=!0,Zb=this.settings.lUd.cluster,yc=this.settings.lUd.$wd,Vc=""):(rb=!1,Vc=yc=Zb="");za=Sd[0];Sd=Sd.slice(1);return{JYm:za,KYm:Sd,EYm:rb,GFo:Zb,GYm:yc,FYm:Vc}}zll(){if(2<=
this.Sva.whb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.Sva.whb)];if(1===this.Sva.whb){const za=this.Sva.p8f[0],rb=this.settings.Mdb(za.clientId);return rb&&2===rb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,za.userName]:[za.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,za.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}xMl(za){return this.yMl(za)}oih(za,
rb,Zb){return rb?this.Bpk(rb)?(za=this.settings.Mdb(za))&&2===za.status?!1:!0:(Zb&&l.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Zb&&l.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}XHl(za){return za.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}yMl(za){if(!za.capabilities.ZAa(1))return this.XHl(za);const rb=za.isReadOnly,Zb=this.settings.Mdb(za.clientId);
za=this.settings.hJc(za.clientId);if(!Zb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Zb.status){case 1:return za?rb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.eEk(za)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}ptl(za){if(this.jZd.CPd)return this.jZd.QZb(za.email,
"O365",v.AFrameworkApplication.um,0)}kMl(za){za=this.settings.Mdb(za.clientId);return!za||za&&1===za.status?!0:!1}mMl(za){var rb=String.format("buttonPeoplesWellUser-{0}",za.clientId),Zb=za.clientId,yc=this.xMl(za);const Vc=za.userName,Sd=za.color;var de=Object,jf=de.assign,Ke=new bc,Je=this.settings.bpd.toString(),Sh=this.settings.X7d.cluster,sc=this.settings.X7d.$wd,mg=this.gOh(),Lc=za.isAnonymous,Pj;if(Pj=[Vc],Pj.length){var Vk=new Sys.StringBuilder("STRARRY@");for(const th of Pj)Vk.append(th?
th.length:0),Vk.append(","),Vk.append(th),Vk.append(",");Pj=Vk.toString().slice(0,-1)}else Pj=null;rb=jf.call(de,Ke,{Id:rb,Command:Je,LabelText:"{0}",Image32by32:Sh,Image32by32Class:sc,MenuItemId:Zb,CommandValueId:Zb,Alt:Vc,DisplayMode:mg,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:yc,ImageBackColor:Sd,IsAnonymous:Lc,LabelTextUserGeneratedPlaceholderReplacements:Pj,Upn:za.email});v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.jZd&&(Zb=this.ptl(za),yc=this.kMl(za),rb.ImageUrl=Zb,rb.ActiveStatus=yc,rb.JoinTimeInMS=za.CMa,za=this.oih(za.clientId,this.settings.hJc(za.clientId),!1),rb.CanJump=za,""===Zb&&l.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return rb}Frl(){return Object.assign(new Qa.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}gOh(){return this.U8l?"Initials":
"Menu32"}nMl(za){const rb=[];for(const Zb of za)za=this.mMl(Zb),Array.add(rb,za);return rb}ZMd(){return 0<this.Sva.whb}ebn(za){if(!this.xue)return!0;this.yNd||(za[mc.a.Visible]=!0);let rb,Zb,yc,Vc,Sd;({JYm:rb,KYm:Zb,EYm:yc,GYm:Vc,FYm:Sd}=this.yll());za[mc.a.LabelText]=rb;Zb&&Zb.length&&(za[mc.a.LabelTextUserGeneratedPlaceholderReplacements]=Zb);za[mc.a.ImageIsVisible]=yc;za[mc.a.Image16by16Class]=Vc;za[mc.a.ImageBackColor]=Sd;this.xue=!1;return!0}Q3m(za){if(0>=this.Sva.whb)return!1;var rb=this.uYn(this.Sva.p8f),
Zb=this.nMl(rb);rb=Object.assign(new lb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Zb=Object.assign(new Eb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.gOh(),ControlList:Zb});v.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.jZd&&(Zb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Zb.TitleId="menuCoauthorsTitle",Zb.Theme="Light");Array.add(rb.MenuSectionList,Zb);v.AFrameworkApplication.K.$("DocChatIsEnabled")&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
v.AFrameworkApplication.ua&&v.AFrameworkApplication.ua.Sb.aq&&(Zb=[],Array.add(Zb,this.Frl()),Zb=Object.assign(new Eb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Zb}),Array.add(rb.MenuSectionList,Zb));v.AFrameworkApplication.ua&&v.AFrameworkApplication.ua.Sb.aq?za.MenuItems=rb:za.PopulationXML=yb.q(rb);return!0}n8f(za){l.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");za=za.MenuItemId;if(!za)return!1;const rb=this.settings.hJc(za);if(!this.oih(za,rb,
!0))return!1;this.Fmm(rb);return!0}uhn(){const za=this.Pfl();this.Sva.LNn(za);this.yNd&&1<=this.Sva.whb&&(l.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.yNd=!1);this.xue=!0}Q6(){this.fqe||(window.setTimeout(()=>{this.L1d();this.fqe=!1},3E3),this.fqe=!0)}Pfl(){let za;za=this.Ofl()||[];for(const rb of za)this.izn(rb);return za}izn(za){za.clientId||(za.clientId=pa.a.create().toString());za.userName||(za.userName="Anonymous user");za.capabilities||(za.capabilities=
new Xa.a);za.color||(za.color="#cccccc");za.CMa||(za.CMa=0)}uYn(za){const rb=[];Array.addRange(rb,za);rb.sort(cb.sYm);return rb}Fkn(){v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.mBe&&(v.AFrameworkApplication.ya.V5(ob.a.Hmh)&&Pb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||v.AFrameworkApplication.ya.gb(ob.a.Hmh,Vb.a.frame,Object(f.a)(this,this.oOm,"onCoauthorGalleryFirstRender"),96));this.Gkn();this.mBe=
!0;this.L1d()}oOm(za,rb,Zb,yc,Vc){this.KIe.vU(Vc.RenderTime);return 32}get b$i(){return this.KIe.task}L1d(){if(!this.mBe&&(this.KIe.vU((new Date).getTime()),l.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.l$h))return;this.uhn();this.l$h&&this.yNd?v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Va.a.z9b("ribbon","coauthorGallery"):
(v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Va.a.dua("ribbon","coauthorGallery"),Va.a.e0a("ribbon","coauthorGallery")),this.vhn())}dispose(){this.qC&&(this.qC.C2d(Object(f.a)(this,this.Q6,"onUsersUpdated")),this.qC=null)}static sYm(za,rb){return za.capabilities.ZAa(1)&&rb.capabilities.ZAa(1)||!za.capabilities.ZAa(1)&&!rb.capabilities.ZAa(1)?oa.a.localeCompare(za.userName,rb.userName):za.capabilities.ZAa(1)?
-1:1}}Object(m.a)(cb,"APeoplesWell",null,[907,10]);var db=d(14);class kb extends cb{constructor(za,rb,Zb=null,yc=null){super(za,Zb,yc);this.CRa=()=>!0;this.ga=rb}gbn(za){return this.ebn(za)}S3m(za){return this.Q3m(za)}$lo(za){return this.n8f(za)}wYa(za,rb,Zb,yc,Vc,Sd){za=!1;switch(Zb){case 1:za=Vc(yc);break;case 2:za=Sd(yc)}return kb.Ehk(za)}I9l(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,()=>this.ZMd(),this.CRa)}fbn(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,Object(f.a)(this,this.gbn,"queryUsersProxy"),
this.CRa)}R3m(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,this.CRa,Object(f.a)(this,this.S3m,"populateFlyoutContentsProxy"))}ryk(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,this.CRa,this.CRa)}qyk(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,this.CRa,this.CRa)}Zlo(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,this.CRa,Object(f.a)(this,this.$lo,"userButtonClickProxy"))}S1m(za,rb,Zb,yc,Vc){return this.wYa(za,rb,Zb,Vc,this.CRa,()=>{this.L1d();return!0})}Gkn(){this.ga.pa(this.settings.Wod,db.a.application,
Object(f.a)(this,this.I9l,"isControlEnabledHandler"));this.ga.gb(this.settings.$od,db.a.application,Object(f.a)(this,this.fbn,"queryUsersHandler"),96);this.ga.gb(this.settings.Yod,db.a.application,Object(f.a)(this,this.ryk,"commandMenuOpenHandler"),96);this.ga.gb(this.settings.Xod,db.a.application,Object(f.a)(this,this.qyk,"commandMenuCloseHandler"),96);this.ga.gb(this.settings.Zod,db.a.application,Object(f.a)(this,this.R3m,"populateFlyoutContentsHandler"),96);this.ga.pa(this.settings.bpd,db.a.application,
Object(f.a)(this,this.Zlo,"userButtonClickHandler"));this.ga.gb(this.settings.WLe,db.a.application,Object(f.a)(this,this.S1m,"peoplesWellRefreshControlHandler"),96)}static Ehk(za){return za?32:8}}Object(m.a)(kb,"ABox4PeoplesWell",cb,[]);var Wb=d(3),Fb=d(54),nc=d(11),gc=d(33),Jc=d(183);class tb{static isSupported(za){for(let rb=0;rb<tb.K7i.length;rb++)if(za===tb.K7i[rb])return!0;return!1}}tb.K7i=[1];Object(m.a)(tb,"RTTDataVersion",null,[]);var dc=d(1571);const Yb=za=>{if("number"!==typeof za.RK||"number"!==
typeof za.DK)return!1;let rb,Zb=!1,yc=!1,Vc=!1;switch(za.RK){case 0:yc=rb=!0;break;case 1:Vc=Zb=yc=rb=!0;break;case 2:if(null!=za.PE&&"number"!==typeof za.PE)return!1;rb=!0;break;case 4:rb=!0;break;case 3:yc=rb=!0;break;case 5:Zb=rb=!0;break;default:return!1}return rb&&("number"!==typeof za.PS||"number"!==typeof za.TS)||yc&&("object"!==typeof za.OS||!za.OS||!dc.validateVersionedCpData(za.OS))||Zb&&("number"!==typeof za.PE||"number"!==typeof za.TE)||Vc&&("object"!==typeof za.OE||!za.OE||!dc.validateVersionedCpData(za.OE))?
!1:!0},pb=za=>{let rb="";if("number"!==typeof za.I)return{returnValue:!1,Lea:"Invalid PacketId Type"};if("number"!==typeof za.O)return{returnValue:!1,Lea:"Invalid Operation Type"};if("string"!==typeof za.A)return{returnValue:!1,Lea:"Invalid ClientId Type"};if("object"!==typeof za.AN)return{returnValue:!1,Lea:"Invalid Anchor Object Type"};if(!za.AN)return{returnValue:!1,Lea:"Null AnchorObject"};if(!Yb(za.AN)){let Zb;try{Zb=R.c(za.AN)}catch(yc){Zb=String.format("Failed to JSON-serialize payload : {0}",
yc)}8E3<Zb.length&&(Zb=String.format("Payload exceeds maximum length: {0} > {1}, not logging",Zb.length,8E3));rb="Invalid AnchorObject: "+Zb+", Client: "+za.C;return{returnValue:!1,Lea:rb}}return!za.O&&za.AN.RK?(rb="Invalid RangeKind:"+za.AN.RK+" for Caret",{returnValue:!1,Lea:rb}):2===za.O&&("number"!==typeof za.TF||"undefined"!==typeof za.TX&&"string"!==typeof za.TX||1!==za.AN.RK&&za.AN.RK)?{returnValue:!1,Lea:"Invalid TypingData"}:3!==za.O||"object"===typeof za.AP&&za.AP&&"number"===typeof za.AP.TFA&&
"number"===typeof za.AP.PN&&"number"===typeof za.AP.TN&&2===za.AN.RK?6!==za.O||"object"===typeof za.MP&&za.MP&&"number"===typeof za.MP.PM&&"number"===typeof za.MP.TM&&5===za.AN.RK?4!==za.O||"object"===typeof za.SP&&za.SP&&"number"===typeof za.SP.PA&&"number"===typeof za.SP.TA&&"number"===typeof za.SP.PB&&"number"===typeof za.SP.TBS&&3===za.AN.RK&&(za.AN.PS===za.SP.PA||za.AN.PS===za.SP.PB)?7!==za.O||"object"===typeof za.SPS&&za.SPS&&"string"===typeof za.SPS.SF&&"boolean"===typeof za.SPS.SL?null!=za.ISS&&
"number"!==typeof za.ISS?{returnValue:!1,Lea:"invalid StrictlySequentialId"}:{returnValue:!0,Lea:rb}:{returnValue:!1,Lea:"Invalid SymbolData"}:{returnValue:!1,Lea:"Invalid SplitParaData"}:{returnValue:!1,Lea:"Invalid RemoveParaData"}:{returnValue:!1,Lea:"Invalid AddParaData"}};var Gb=d(1546);class hb{constructor(za,rb=null,Zb=null){this.y_=this.IIf=this.J3f=null;null!=za&&(this.J3f=za);null!=rb&&(this.IIf=rb);null!=Zb&&(this.y_=Zb)}}Object(m.a)(hb,"AddParaData",null,[]);class Ib{constructor(za=null,
rb=null){this.Bfc=this.HIf=null;null!=za&&(this.HIf=za);null!=rb&&(this.Bfc=rb)}}Object(m.a)(Ib,"MergeRemoveParaData",null,[]);class Ob{constructor(za,rb,Zb,yc,Vc,Sd,de=null,jf=null,Ke=null,Je=null,Sh=null,sc=null,mg=0,Lc=null){this.M0c=this.text=this.JKb=this.gKb=this.iRc=this.lWb=this.jha=null;this.packetId=za;this.client=Zb;this.iu=yc;this.clientId=rb.toLowerCase();this.lS=Vc;this.version=mg;Sd&&(this.jha=Sd);null!=de&&(this.JKb=de);void 0!==jf&&null!==jf&&(this.text=jf);Ke&&(this.lWb=Ke);Je&&
(this.iRc=Je);Sh&&(this.gKb=Sh);sc&&(this.M0c=sc);this.strictlySequentialId=Lc}}Object(m.a)(Ob,"RTTData",null,[]);class kc{constructor(za=null,rb=null,Zb=null,yc=null){this.I3f=this.GIf=this.F3f=this.FIf=null;null!=za&&(this.FIf=za);null!=rb&&(this.F3f=rb);null!=Zb&&(this.GIf=Zb);null!=yc&&(this.I3f=yc)}}Object(m.a)(kc,"SplitParaData",null,[]);class Ac{constructor(za=null,rb=null){this.m2f=this.l2f=null;za&&(this.l2f=za);null!=rb&&(this.m2f=rb)}}Object(m.a)(Ac,"SymbolData",null,[]);class Nc{constructor(za,
rb=null,Zb=null){null!=za&&(this.TFA=za);null!=rb&&(this.PN=rb);null!=Zb&&(this.TN=Zb)}}Object(m.a)(Nc,"SerializableAddParaDataV1",null,[]);class kd{constructor(za=null,rb=null){null!=za&&(this.PM=za);null!=rb&&(this.TM=rb)}}Object(m.a)(kd,"SerializableMergeRemoveParaDataV1",null,[]);class Jd{}Object(m.a)(Jd,"SerializableRTTDataV1",null,[]);class ge{constructor(za=null,rb=null,Zb=null,yc=null){null!=za&&(this.PA=za);null!=rb&&(this.TA=rb);null!=Zb&&(this.PB=Zb);null!=yc&&(this.TBS=yc)}}Object(m.a)(ge,
"SerializableSplitParaDataV1",null,[]);class Oc{constructor(za=null,rb=null){za&&(this.SF=za);null!=rb&&(this.SL=rb)}}Object(m.a)(Oc,"SerializableSymbolDataV1",null,[]);const qc=za=>{var rb;if(!({Lea:rb}=pb(za)).returnValue)return l.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",rb),null;let Zb=rb=null,yc=null,Vc=null,Sd=null,de=null,jf=null,Ke=null;za.WD&&(rb=za.WD);null!=za.TF&&(Zb=za.TF);void 0!==za.TX&&null!==za.TX&&(yc=za.TX);za.AP&&(Vc=new hb(za.AP.TFA,za.AP.PN,
za.AP.TN));za.MP&&(Sd=new Ib(za.MP.PM,za.MP.TM));za.SP&&(de=new kc(za.SP.PA,za.SP.TA,za.SP.PB,za.SP.TBS));za.SPS&&(jf=new Ac(za.SPS.SF,za.SPS.SL));null!=za.ISS&&(Ke=za.ISS);return new Ob(za.I,za.A,za.C,za.O,Gb.a(za.AN),rb,Zb,yc,Vc,Sd,de,jf,1,Ke)},Xc=za=>{let rb=za;if("number"===typeof rb.V){if(1===rb.V)return qc(za);l.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let Zb=0,yc=null;for(let Vc=0;Vc<za.length;Vc++)rb=za[Vc],tb.isSupported(rb.V)&&rb.V>Zb&&(Zb=rb.V,yc=za[Vc]);return 1===
Zb?qc(yc):null},xe=za=>{if(za){const rb=new Jd;rb.I=za.packetId;rb.V=1;rb.A=za.clientId;rb.C=za.client;rb.O=za.iu;rb.AN=Gb.c(za.lS);za.jha&&(rb.WD=za.jha);null!=za.JKb&&(rb.TF=za.JKb);void 0!==za.text&&null!==za.text&&0<za.text.length&&(rb.TX=za.text);za.lWb&&(rb.AP=new Nc(za.lWb.J3f,za.lWb.IIf,za.lWb.y_));za.iRc&&(rb.MP=new kd(za.iRc.HIf,za.iRc.Bfc));za.gKb&&(rb.SP=new ge(za.gKb.FIf,za.gKb.F3f,za.gKb.GIf,za.gKb.I3f));za.M0c&&(rb.SPS=new Oc(za.M0c.l2f,za.M0c.m2f));rb.ISS=za.strictlySequentialId;za=
rb}else za=null;return za};var Ge=d(59);class bf{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){this.LocalCobaltSessionId=za;this.SkypeChatThreadId=rb;this.ChatThreadDiscoveryUri=Zb;this.InChat=yc;this.Capabilities=Vc;this.Email=Sd;this.UserName=de;this.IsAnonymous=jf;this.PresenceStatus=Ke}}Object(m.a)(bf,"SerializableWacData",null,[]);class xd{constructor(){this.wld=this.vld=0}wyl(){this.wld===Number.MAX_VALUE&&(this.wld=0);this.wld++;return this.wld}vyl(){this.vld===Number.MAX_VALUE&&(this.vld=0);this.vld++;
return this.vld}static get instance(){return xd.zUj}}xd.zUj=new xd;Object(m.a)(xd,"StrictlySequentialIdGenerator",null,[710]);var ke=d(1486);class Rf{constructor(za,rb,Zb,yc,Vc,Sd,de,jf=0){this.Wpa=null;this.dryDeletion=0;this.DH=za;this.EHa=Sd;this.qd=Vc;this.kub=de;this.Mc=rb;this.shapeId=jf;this.aDa=Zb;this.X6=de.create(this,yc,Vc,Sd)}clone(){return new Rf(this.DH,this.Mc,this.aDa,this.X6.kMb,this.qd,this.EHa,this.kub,this.shapeId)}get paragraphId(){return this.Wpa?this.Wpa:this.DH.udb(this.Mc)}vGf(){this.Wpa||
(this.Wpa=this.paragraphId,this.X6.vGf())}Qd(){return 0<=this.X6.cp}getData(){const za=this.X6.kMb;return za?new ke.a(0,this.Mc,this.aDa,za,null,null,null,0,this.shapeId):null}static Rwb(za,rb,Zb,yc,Vc){return rb?new Rf(rb,parseInt(za.LNa),za.g3a,za.yQ,Zb,yc,Vc,za.shapeId):null}}Object(m.a)(Rf,"WordPresenceIp",null,[688,71,689]);class pd{constructor(za,rb,Zb){this.oPa=this.S$=this.Nqc=!1;this.h8a=za;this.iSa=Zb;this.user=rb}get ip(){return this.iSa}get J8b(){return this.Nqc}set J8b(za){(this.Nqc=
za)&&this.ip.vGf()}fgf(){const za=xd.instance.vyl();return new Ob(this.h8a,this.user.clientId,1,0,this.ip?this.ip.getData():null,new bf(this.user.pQ,this.user.Ozc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,za)}gQh(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Ge.a.nil.toString())}Qd(){const za=!!this.user&&
this.user.Qd(),rb=!this.ip||this.ip.Qd();return za&&rb}clone(){const za=new pd;za.h8a=this.h8a;za.Nqc=this.Nqc;za.user=this.user?this.user.clone():null;za.iSa=this.ip?this.ip.clone():null;za.S$=this.S$;za.oPa=this.oPa;return za}static tZe(za,rb,Zb,yc,Vc){if(!za||!rb)return null;if(za.iu)return l.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",za.iu),null;let Sd;Sd=void 0!==za.jha&&null!==za.jha?Ea.esh(za.clientId,za.jha.UserName,za.jha.Capabilities,za.jha.LocalCobaltSessionId,
za.jha.SkypeChatThreadId,za.jha.Email,za.client,za.jha.ChatThreadDiscoveryUri,za.jha.InChat,!1,za.jha.IsAnonymous,za.jha.PresenceStatus):Ea.esh(za.clientId,null,0,void 0,void 0,void 0,za.client);return new pd(za.packetId,Sd,Rf.Rwb(za.lS,rb,Zb,yc,Vc))}}Object(m.a)(pd,"WordPresenceInfo",null,[709,71]);class fe extends kb{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,sc,mg,Lc){super(za,Sd,Lc,rb);this.uwj=Zb;this.$Rj=yc;this.zQj=Vc;this.hb=de;fe.mt=jf;this.DH=Ke;this.qd=Je;this.EHa=Sh;this.xLe=sc;this.MFa=
mg}n8f(za){this.MFa.Ihi(za.CommandValueId);return super.n8f(za)}Fmm(za){let rb;({kLf:rb}=this.rrf(za)).returnValue&&(this.$Rj(rb.ip.paragraphId,rb.ip.X6.cp),v.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(za=fe.HGl(rb),void 0!==za&&null!==za?(l.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.hb.setSelection(za),Ra.FocusManager.YI()&&Ra.FocusManager.instance().Jg(ab.AFrame.Xp)):l.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),
za=new ta.a(2,1,0,()=>{this.ga.Xb(Wb.a.y7d,2,rb)}),zb.a.instance.$b(za))}pVh(za){return za?(za=pd.tZe(Xc(za),this.DH,this.qd,this.EHa,this.xLe.instance))&&za.Qd()&&za.ip?za:null:null}Bpk(za){return this.xgm(za)?this.Rpk(za)?!0:(l.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(l.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}xgm(za){return!!this.pVh(za)}rrf(za){za=this.pVh(za);return{returnValue:!!za,
kLf:za}}Rpk(za){let rb;return({kLf:rb}=this.rrf(za)).returnValue?this.uwj(rb.ip.paragraphId,rb.ip.X6.cp):!1}Ofl(){if(!this.qC)return[];const za=[];for(let rb of this.qC.wXa())rb.userName?za.push(rb):l.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return za}eEk(za){let rb;return({kLf:rb}=this.rrf(za)).returnValue&&rb.user&&rb.user.presenceStatus&&"0"!==rb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,rb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}vhn(){this.zQj(this.settings.id)}static createInstance(za,
rb,Zb,yc,Vc,Sd,de){const jf=Oa.App.xa.jb,Ke=v.AFrameworkApplication.ya,Je=Fb.a.instance,Sh=ea.a.instance.resolve("Box4.ICoauthCashTelemetry");return new fe(za,rb,sc=>jf.Jc.Ji?jf.Jc.XTe(sc,!0):!1,(sc,mg)=>{jf.Jc.Ji&&jf.Jc.Ecc(sc,mg,!0,!0)},()=>{Oa.App.Av.PH.M2c()},Ke,Je,jf,Zb,yc,Vc,Sd,Sh,de)}static HGl(za){const rb=fe.mt.Zc.Ad.Eb(za.ip.paragraphId);if(void 0===rb||null===rb)return l.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!nc.ParagraphReader.oc(rb))return l.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;za=gc.a.Uc(rb,za.ip.X6.cp);return new Jc.Selection([za],!0)}}fe.mt=null;Object(m.a)(fe,"WordEditorPeoplesWell",kb,[]);class Ec{constructor(){this.Ww=()=>{v.AFrameworkApplication.ECi?Ec.LOa.iI().continueWith(this.aTc):l.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.aTc=()=>{Ec.ij=Ec.LOa.iI().result;if(Ec.ij){var za=()=>{const rb=Oa.App.xa.jb;return rb?rb.Zc?rb.Zc.Ad:(l.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(l.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Oa.App.jla().continueWith(()=>{const rb=Oa.App.jla().result.pj,Zb=na.CuiHelper.VBl(v.AFrameworkApplication.mr,v.AFrameworkApplication.mr,v.AFrameworkApplication.mr,v.AFrameworkApplication.mr),yc=Na.createInstance(Zb,rb,Object(f.a)(Ec.ij.P3d,Ec.ij.P3d.hJc,"getUserPresence"),Object(f.a)(Ec.ij.P3d,Ec.ij.P3d.Mdb,"getUserStatusInfo"),v.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
ea.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>fe.createInstance(yc,da.a.Iq(Ec.W.Za("Common.IPeopleInfoProvider")),Ec.W.Pa("WordEditor.ParagraphWordIdMapping"),Ec.W.Pa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),za,Ec.W.Za("WordEditor.Presence.IWordPresenceCpFactory"),Ec.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();Ec._instance=ea.a.instance.resolve("Common.IPeoplesWell");Ec._instance.Fkn();l.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else l.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}zc(za){Ec.W=za}init(){v.AFrameworkApplication.K.yq(this.Ww)}dispose(){Ec._instance&&(Ec._instance.dispose(),Ec._instance=null)}static get LOa(){return null!=Ec.sog?Ec.sog:Ec.sog=ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Ec._instance=null;Ec.W=null;Ec.ij=null;Object(m.a)(Ec,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var rd=d(78),Ld=d(144);class Gf{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke=!1){this.B4a=null;this.noe=!0;this.MBe=this.Mq=this.che=null;this.sa=new Sa.a;this.zHa=za;this.Dca=rb;this.LUg=Zb;this.ctc=yc;this.hug=Sd;Gf.Hb=Vc;this.BPj=de;this.BY=jf;this.GQj=Ke;G.Task.WAA(rb,Zb).continueWith(Object(f.a)(this,this.O_l,"initOnTaskReady"))}P7j(za){this.sa.addHandler("u",za)}aIi(){this.sa.raiseEvent("u",null,this)}O_l(){this.Dca.result&&this.LUg.result&&(this.Mq=
this.Dca.result,this.MBe=this.LUg.result,this.Mq.UUa(Object(f.a)(this,this.R2,"onPresenceUpdated")),this.che=new ta.a(2,2,this.hug,Object(f.a)(this,this.keo,"updateAwayClientsTask"),88),Gf.Hb.$b(this.che))}R2(za,rb){(this.noe||this.zen(rb.VEa))&&Gf.Hb.e3(this.che,0)}zen(za){for(let Zb in za){var rb=this.ctc.yGd({key:Zb,value:za[Zb]});if(rb&&rb.clientId&&(rb=rb.clientId.toLowerCase(),(rb=this.B4a[rb]||this.B4a[rb.toUpperCase()])&&2===rb.status))return!0}return!1}keo(za){var rb=this.Mq.wGc();if(rb){var Zb=
new Date,yc=!1;if(this.noe){this.B4a=rb;this.noe=!1;var Vc=this.B4a;for(var Sd in Vc){rb=Sd;var de=Vc[Sd];de.U7b<Zb&&(Zb=de.U7b);2===de.status&&(yc=!0,this.MBe.cXc(rb))}yc&&this.aIi();Gf.Hb.e3(za,this.iTh(Zb))}else{de=new N.a;Sd=!1;var jf=this.B4a;for(Vc in jf){jf=Vc;if(!(jf in this.B4a)||this.zHa.clientId===jf)continue;var Ke=this.B4a[jf];const Je=rb[jf];if(Ke&&Je){Ke=Ke.status;const Sh=Je.status;2===Ke&&1===Sh?(de.add(jf),l.ULS.sendTraceTag(38052609,392,50,jf+" returned from away")):1===Ke&&2===
Sh&&(Sd=yc=!0,this.MBe.cXc(jf),l.ULS.sendTraceTag(38052610,392,50,jf+" went away"));1===Sh&&Je.U7b<Zb&&(Zb=Je.U7b)}}this.B4a=rb;Gf.Hb.e3(za,this.iTh(Zb));(0<de.count||yc)&&this.aIi();0<de.count&&!this.GQj?(za=this.Ljl(de),this.b7n(za)):za=new N.a;(Sd||0<za.count)&&this.BPj(ob.a.qud,2)}}}b7n(za){if(za.count)for(let rb of za)za=this.BY.qza(String.format(CommonUIStrings.l_EditorsToastArriving,rb),!1),za.image=5,za.ula="CoAuth_AuthorStatus_16x16x32",this.BY.eB(za)}Ljl(za){const rb=this.Mq.gzb(),Zb=new N.a;
for(let yc in rb){const Vc={key:yc,value:rb[yc]};if(za.contains(Vc.key)){const Sd=this.ctc.yGd(Vc);Sd&&(Zb.add(Sd.userName),za.remove(Vc.key))}}Zb.count||l.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Zb}iTh(za){const rb=new Date;return Math.max(za.getTime()+this.hug-rb.getTime(),0)}}Gf.Hb=null;Object(m.a)(Gf,"AwayManager",null,[]);var ld=d(772);class Pc{constructor(za=0){this.updates=za}get Cjf(){return 0!==this.updates}ZAa(za){return!!(this.updates&za)}a2a(za){this.updates|=
za}toString(){if(this.ZAa(0))return"none";const za=new N.a;this.ZAa(1)&&za.add("user(s) joined");this.ZAa(2)&&za.add("user(s) disconnected");this.ZAa(4)&&za.add("user(s) updated");return za.toArray().join(", ")}}Object(m.a)(Pc,"UserUpdateEvent",null,[]);var cd=d(31);class Aa{constructor(za,rb,Zb,yc,Vc=null){this.sa=new Sa.a;this.kJ=this.ij=null;this.$Pg=this.vQg=this.Bl=!1;this.Tp=new Ja.a;za.continueWith(()=>{this.ij=za.result;this.ij.UUa(Object(f.a)(this,this.nyi,"onRtcPresenceUpdate"));this.ij.xya(Object(f.a)(this,
this.myi,"onRtcConnectionChange"));this.M7f(null,null)});rb.continueWith(()=>{this.kJ=rb.result;this.kJ.QUa(Object(f.a)(this,this.GSc,"onEditorsTableUpdated"))});Vc&&Vc.continueWith(()=>{Vc.result.P7j(Object(f.a)(this,this.M7f,"updateUserStatus"));this.M7f(null,null)});this.s8a=Zb;this.ctc=yc}get users(){return this.Tp}BWb(za){this.sa.addHandler("UU",za)}C2d(za){this.sa.removeHandler("UU",za)}M7f(){if(this.ij){var za=!1,rb=this.ij.wGc();for(let yc in rb){var Zb=rb[yc];const Vc=yc;this.users.xb(Vc)&&
(Zb=this.Kaj(Zb),za=this.users.J(Vc).owb!==Zb||za,this.users.J(Vc).owb=Zb)}za&&(za=new Pc(4),this.K4d(za))}}Kaj(za){return 1===za.status?0:1}wXa(){this.users.count||(this.vQg||(cd.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.vQg=!0),this.k4m());const za=[];for(let rb of this.users)Array.add(za,rb.value);return za}k4m(){if(this.ij){var za=this.ij.gzb();this.yyf(za)}if(this.kJ){za=this.kJ.pGc();for(const rb of za)rb.Id&&(za=this.muh(rb.Id),this.L7f(new Pc,za))}}vmi(za){({value:za}=
this.users.Dc(za));return za}dispose(){this.Bl||(this.ij&&(this.ij.QHb(Object(f.a)(this,this.nyi,"onRtcPresenceUpdate")),this.ij.gXc(Object(f.a)(this,this.myi,"onRtcConnectionChange"))),this.kJ&&this.kJ.gNi(Object(f.a)(this,this.GSc,"onEditorsTableUpdated")),this.Bl=!0)}myi(za,rb){2===rb.newState&&(za=this.yyf(this.ij.gzb()),za.Cjf&&this.K4d(za))}GSc(za,rb){za=new Pc;var Zb=this.kJ.pGc();l.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
Zb.length,rb.lMm,rb.Hri);const yc=new Ja.a;for(var Vc of Zb){Zb=Vc.Id;const Sd=this.muh(Zb);this.L7f(za,Sd);yc.Z(Zb,Sd)}if((rb=rb.leaving)&&0<rb.length)for(Vc=0;Vc<rb.length;Vc++)l.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,rb.J(Vc).Id),({value:Zb}=this.users.Dc(rb.J(Vc).Id)).returnValue?Zb?(this.users.remove(rb.J(Vc).Id),za.a2a(2),yc.Z(rb.J(Vc).Id,Zb)):l.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",rb.J(Vc).Id):
l.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",rb.J(Vc).Id);rb=this.ij.gzb();for(let Sd in rb)Vc=this.ctc.yGd({key:Sd,value:rb[Sd]}),yc.Z(Vc.clientId,Vc);for(let Sd of this.users)yc.xb(Sd.value.clientId)||(l.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Sd.key),this.users.remove(Sd.key),za.a2a(2));za.Cjf&&this.K4d(za)}nyi(za,rb){za=this.yyf(rb.VEa);for(const Zb of rb.yyd)this.users.xb(Zb)&&(za.a2a(2),this.users.J(Zb).owb=
2);za.Cjf&&this.K4d(za)}yyf(za){const rb=new Pc;if(!za)return rb;for(let yc in za){var Zb=this.ctc.yGd({key:yc,value:za[yc]});Zb&&(Zb=Zb.clone(),this.L7f(rb,Zb))}return rb}L7f(za,rb){if(rb){var Zb=rb.clientId;var yc=this.Bvn(rb);({value:rb}=this.users.Dc(Zb)).returnValue?rb.equals(yc)||(za.a2a(4),this.users.Z(Zb,yc)):(l.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,Zb),za.a2a(1),this.users.Z(Zb,yc))}}muh(za){return this.users.xb(za)?this.users.J(za):
Pa.a.PHk(za)}Bvn(za){if(!za||!za.clientId||!this.kJ)return za;const rb=za.clone();rb.owb=this.Kjl(za);if(za=this.kJ.L1b(rb.clientId))rb.isReadOnly=rb.isReadOnly||za.IsReadOnly?!0:!1,rb.userName=this.Avn(rb,za),rb.capabilities=this.WFm(rb.capabilities,za.Capabilities),rb.email=rb.email||za.SIPAddress||za.EmailAddress,za.JoinCoauthTime&&(rb.CMa=za.JoinCoauthTime);rb.color=this.s8a.gJc(new ld.a(rb.email,void 0,rb.userName,void 0,rb.isAnonymous,rb.clientId),3);return rb}Kjl(za){if(!this.ij)return 2;if(za&&
za.clientId){const rb=this.ij.wGc();if(za.clientId in rb)return this.Kaj(rb[za.clientId])}return 2}Izk(za,rb){rb.Name&&za.userName&&rb.Name!==za.userName&&!this.$Pg&&(this.$Pg=!0,cd.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}WFm(za,rb){za=za||new Xa.a;rb&&(rb.SupportsRealtimeChannel&&za.a2a(1),rb.SupportsRename&&za.a2a(2),rb.SupportsChat&&za.a2a(4));return za}Avn(za,rb){this.Izk(za,rb);return rb.Name||za.userName||(za.isAnonymous||rb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}K4d(za){l.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",za.toString());this.sa.raiseEvent("UU")}}Object(m.a)(Aa,"PeopleInfoProvider",null,[925,10]);var Wa;(function(za){za[za.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";za[za.peopleImageClassName=1]="peopleImageClassName";za[za.peopleImageClusterPath=4]="peopleImageClusterPath";za[za.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";za[za.imageDimension=6]="imageDimension";
za[za.rtl=8]="rtl";za[za.pointerInputManager=9]="pointerInputManager";za[za.clickInputManager=10]="clickInputManager";za[za.vertical=11]="vertical";za[za.zIndex=12]="zIndex";za[za.contextMenuInputManager=13]="contextMenuInputManager";za[za.imageDomElement=14]="imageDomElement";za[za.useIdleTooltip=15]="useIdleTooltip";za[za.viewportBoundsCallback=16]="viewportBoundsCallback";za[za.flipHorizontalDirection=17]="flipHorizontalDirection";za[za.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
za[za.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";za[za.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Wa||(Wa={}));Object(m.b)("PresenceTooltipSettingKeys",Wa);class $b{constructor(){this.mq={}}get(za,rb=null){za=Wa[za];return"number"===typeof rb?(rb=this.mq[za])?Number.parseInvariant(rb.toString()):0:this.mq[za]}add(za,rb){this.mq[Wa[za]]=rb}RIa(za,rb){Wa[za]in this.mq||(this.mq[Wa[za]]=rb)}remove(za){delete this.mq[Wa[za]]}}Object(m.a)($b,"PresenceTooltipSettings",null,
[]);class xc extends Sa.a{constructor(za){super();this._element=null;this.element=za}get element(){return this._element}set element(za){this._element=za}get visible(){return"visible"===this.element.style.visibility}set visible(za){this.element.style.visibility=za?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(za){this.element.dir=za?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(za){this.element.style.zIndex=String(za)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(za){return this.element.ownerDocument.createElement(za)}Fga(){return!0}static yth(za){return"prControl"+(za?"Rtl":"")}}Object(m.a)(xc,"BasePresenceControl",Sa.a,[10,933]);class bd extends Sys.EventArgs{constructor(za,rb){super();this.type=za;this.An=rb}}bd.sT="InteractivityChanged";Object(m.a)(bd,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Wd{static Wml(za){return Wd.Yml(za)}static Yml(za){const rb=
document.createElementNS(Wd.p$f,"svg");rb.setAttribute("viewBox",String.format(Wd.iOk,Wd.cjj,Wd.bjj));rb.appendChild(Wd.MIl(za));return rb}static MIl(za){const rb=Wd.cjj/za,Zb=2*rb,yc=Wd.bjj/2;za=(za-12-8)*rb/2;const Vc=document.createElementNS(Wd.p$f,"g");Sys.UI.DomElement.addCssClass(Vc,Wd.hOk);for(let Sd=1;3>=Sd;Sd++)Vc.appendChild(Wd.wjl(Sd,Zb,za+(6*Sd-2)*rb,yc));return Vc}static wjl(za,rb,Zb,yc){const Vc=document.createElementNS(Wd.p$f,"circle");Sys.UI.DomElement.addCssClass(Vc,String.format("{0}-{1}",
Wd.Otk,za));Vc.setAttribute("cx",String.format("{0}",Zb));Vc.setAttribute("cy",String.format("{0}",yc));Vc.setAttribute("r",String.format("{0}",rb));return Vc}}Wd.p$f="http://www.w3.org/2000/svg";Wd.hOk="prDancingDots";Wd.Otk="prAnimateCircle";Wd.iOk="0 0 {0} {1}";Wd.bjj=40;Wd.cjj=120;Object(m.a)(Wd,"ModernPresenceTooltipDancingDots",null,[]);var vf=d(90),uf=d(98),oe=d(7),Pe=d(29),We=d(113),Xi=d(51);class zf extends xc{constructor(za,rb){super(za);this.t3g=this.n6a=this.Pie=this._img=this.xD=this.Er=
this.gg=null;this.gIa=rb.get(8,!1);this.W5a=rb.get(6,0);this.KXj=rb.get(15,!1);this.Md=rb;this.nCg=0;this.element=za;this.element.className=zf.E8e;this._span=document.createElement("span");this.element.appendChild(this._span);this.rAj=Wd.Wml(rb.get(6,0));this.HA(rb);this._state=5}Oub(za){this.addHandler(bd.sT,za)}OHb(za){this.removeHandler(bd.sT,za)}get user(){return this.t3g}get state(){return this._state}dispose(){this.element&&(this.gg.sc(oe.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),
this.gg.sc(oe.a.KC,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.Er.sc(oe.a.pointerDown,this.element,Object(f.a)(this,this.NB,"onPointerDown")),this.Er.sc(oe.a.pointerOut,this.element,Object(f.a)(this,this.cO,"onPointerOut")),this.Er.sc(oe.a.pointerOver,this.element,Object(f.a)(this,this.mX,"onPointerOver")),this.xD.sc(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}HA(za){this.gg=za.get(10);this.gg.mb(oe.a.click,
this.element,Object(f.a)(this,this.onClick,"onClick"));this.gg.mb(oe.a.KC,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior"));this.Er=za.get(9);this.Er.mb(oe.a.pointerOver,this.element,Object(f.a)(this,this.mX,"onPointerOver"));this.Er.mb(oe.a.pointerOut,this.element,Object(f.a)(this,this.cO,"onPointerOut"));this.Er.mb(oe.a.pointerDown,this.element,Object(f.a)(this,this.NB,"onPointerDown"));this.xD=za.get(13);this.xD.mb(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior"))}hide(za=
null,rb=0,Zb=0){this.KXj&&za?this.qVn(za,rb,Zb):(3===this.state&&this.RLi(),this.visible=!1,this._state=5)}qVn(za,rb,Zb=0){this.show(za,rb,15,4,void 0,Zb)}B2i(za,rb,Zb=!1,yc=!1,Vc=!1,Sd=0){this.show(za,rb,20,Zb?2:yc?1:0,Vc,Sd)}PUn(za,rb,Zb,yc=!1,Vc=0){this.show(za,rb,Zb+20,3,yc,Vc)}show(za,rb,Zb,yc=3,Vc=!1,Sd=0){!za||yc===this.state&&this.UUl(rb,Zb)||(this.V_j(yc,Vc,Sd),this.Yca(za,yc,Sd),this._state=yc,4===Sd||0===Sd&&!this.gIa?this.element.style.left=rb+"px":this.element.style.right=rb+"px",this.element.style.top=
Zb+"px",this.visible=!0)}Yca(za,rb,Zb){this.t3g=za;Xi.a.jA(this._span);We.a.vvk(this._span);this._span.id="fly_"+za.clientId;this._span.style.backgroundColor=za.color;4!==rb?(this._span.style.height=this.W5a+"px",this._span.style.lineHeight=this.W5a+"px",We.a.ydc(this._span,"border-radius",this.W5a+"px")):4===Zb||0===Zb&&!this.gIa?this._span.style.left="0px":this._span.style.right="0px";2!==rb&&(4===rb?Xi.a.ey(this._span,""):1===rb?this._span.appendChild(this.rAj):(this._span.setAttribute("dir","auto"),
Zb=oa.a.Ntl(za.userName),(!za.isAnonymous||v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&Zb||0!==rb?(za=za.userName,0===rb&&(za=Zb,We.a.ydc(this._span,"text-align","center")),Xi.a.ey(this._span,za)):(this._img||(this._img=this.LFk()),this._span.appendChild(this._img),We.a.ydc(this._span,"text-align","start"))))}onClick(za){if(0===this.state)return this.raiseEvent(bd.sT,new bd(1,za)),!0;3===this.state&&l.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}cO(za){3===this.state&&this.raiseEvent(bd.sT,new bd(3,za));return!1}mX(za){3!==za.eg&&this.raiseEvent(bd.sT,new bd(2,za));return!1}NB(za){if(3!==za.eg)return!0;this.raiseEvent(bd.sT,new bd(4,za));return!1}LFk(){const za=document.createElement("img");za.src=vf.a.y9("doughperson_white_glyph.svg");za.setAttribute("Unselectable","on");Pe.a.Gq(za,Pe.a.Ah,Pe.a.xz);return uf.createClusteredImageFromClusterWithImageClass(this.W5a,this.W5a,null,null,zf.T$k,
"",!1,"",this.element.ownerDocument,za)}V_j(za,rb=!1,Zb=0){if(!this.yMc(this.state)||!this.yMc(za))switch(Sys.UI.DomElement.removeCssClass(this.element,this.Pie),this.state){case 4:3===za?this.NUa(zf.F8e,zf.DHh):this.yMc(za)&&this.NUa(zf.D8e,zf.DHh);break;case 3:4===za?this.NUa(zf.I8e,zf.CHh):this.yMc(za)&&(rb&&this.RLi(),this.NUa(zf.D8e,zf.CHh,rb?zf.S$k:""));break;case 0:case 1:case 2:4===za?this.NUa(zf.I8e,zf.G8e):3===za&&(rb&&this.b1j(),this.NUa(zf.F8e,zf.G8e,rb?zf.EHh:"",3===Zb?zf.W$k:zf.U$k));
break;default:4===za?this.NUa(zf.I8e):3===za?this.NUa(zf.F8e):this.yMc(za)&&this.NUa(zf.D8e)}}NUa(...za){this.Pie=za.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.Pie)}b1j(){this.nCg=window.setTimeout(()=>{this.element&&(this.n6a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.n6a),this.element.style.zIndex="2",this.n6a.style.zIndex="1")},300)}RLi(){window.clearTimeout(this.nCg);this.n6a&&(Sys.UI.DomElement.removeCssClass(this.n6a,zf.G8e+" "+zf.EHh),Sys.UI.DomElement.addCssClass(this.n6a,
zf.R$k),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.n6a.parentNode&&this.element.parentNode.removeChild(this.n6a)}),We.a.Dbc(this.element,"z-index"))}yMc(za){return 0===za||1===za||2===za}UUl(za,rb){const Zb=We.a.rX(this.element.style.top);return We.a.rX(this.element.style.left)===za&&Zb===rb}CSf(za){3===za&&We.a.u9(this.element,"left")?(za=We.a.rX(this.element.style.left),We.a.Dbc(this.element,"left"),this.element.style.right=-1*za+"px"):4===za&&We.a.u9(this.element,
"right")&&(za=We.a.rX(this.element.style.right),We.a.Dbc(this.element,"right"),this.element.style.left=-1*za+"px")}}zf.E8e="prModernFlyout UIFont";zf.I8e="flyoutIdle";zf.F8e="flyoutExpanded";zf.D8e="flyoutCollapsed";zf.DHh="flyoutFromIdle";zf.CHh="flyoutFromExpanded";zf.G8e="flyoutFromCollapsed";zf.EHh="flyoutStacked";zf.S$k="flyoutFromStacked";zf.R$k="flyoutFadeOut";zf.T$k="cui-img-cont-float cui-img-20by20";zf.U$k="flyoutLtrDir";zf.W$k="flyoutRtlDir";Object(m.a)(zf,"ModernPresenceTooltipFlyoutControl",
xc,[]);class sf{constructor(za,rb,Zb=2,yc=4){this.offsetTop=za;this.offsetLeft=rb;this.$ij=Zb;this.h4h=yc}}Object(m.a)(sf,"FlyoutsPositioningInfo",null,[]);var Ye=d(37);class Bh{constructor(za=!1,rb=!1){this.Ql=za;this.woe=rb}avl(za,rb,Zb,yc,Vc){const Sd=Vc.y,de=Vc.height;var jf=this.Rhl(yc);const Ke=jf+rb,Je=za*Zb+2*(za-1);Zb=null;1===za||this.rpk(jf,Je,Sd,de)?za=new sf(0,0,2):(za=this.o8e(Ke,Je,Sd,de),za.offsetTop-=jf);this.woe?Zb=new sf(0,0,void 0,this.Ql?4:3):(yc=this.Qhl(yc,Vc),jf=Math.max(0,
Vc.x),Vc=Vc.width,rb=yc+rb,this.spk(yc,jf,Vc)?Zb=new sf(0,0,void 0,this.Ql?3:4):this.tpk(rb,jf)&&(Zb=new sf(0,0,void 0,this.Ql?4:3)),Zb||(Zb=this.F9k(yc,rb,jf,Vc)));return new sf(za.offsetTop,Zb.offsetLeft,za.$ij,Zb.h4h)}Rhl(za){return Ye.a.KKa(za)}Qhl(za,rb){return this.Ql?rb.width-Ye.a.mLh(za):Ye.a.raf(za)}rpk(za,rb,Zb,yc){return za+rb<=Zb+yc}o8e(za,rb,Zb,yc){let Vc=1,Sd=Math.max(Zb,za-rb);rb>za-Zb&&(Vc=2,Sd=rb<yc?yc-rb:Zb);return new sf(Sd,0,Vc)}spk(za,rb,Zb){return za+150<=rb+Zb}tpk(za,rb){return 150<=
za-rb}F9k(za,rb,Zb,yc){yc-rb>=za-Zb?za=4:(rb=za,za=3);return new sf(0,rb,void 0,za)}}Object(m.a)(Bh,"ModernPresenceTooltipPositioner",null,[]);class Sg{constructor(za,rb,Zb,yc,Vc,Sd,de){this.g8=za;this._parent=rb;this.Swg=Zb;this.kxj=yc;this.nFj=Vc;this.RUb=Sd;this.gIa=de;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(za,rb){if(3!==za)if(5!==za&&this.g8&&this.g8.length){if(4===za){var Zb=this.nFj;var yc=(this.RUb-Zb)/2;
this.element.style.height=this.RUb+"px";this.element.style.width=this.RUb+"px";za=We.a.rX(this.g8[0].element.style.top);rb=We.a.rX(this.gIa?this.g8[0].element.style.right:this.g8[0].element.style.left)}else Zb=this.Swg,yc=(this.RUb-Zb)/2,this.element.style.height=this.RUb+"px",this.element.style.width=this.Ojl()+2*yc+"px",za=We.a.rX(this.g8[this.g8.length-1].element.style.top),rb=this.vok(this.g8[this.g8.length-1].element,Zb,rb);We.a.ydc(this.element,"border-radius",this.RUb+"px");this.element.style.top=
za-yc-Zb+"px";this.gIa?this.element.style.right=rb-yc+"px":this.element.style.left=rb-yc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}vok(za,rb,Zb){return this.gIa&&!Zb?We.a.rX(za.style.right):this.gIa||Zb?this.gIa&&Zb?-We.a.rX(za.style.left)-rb:-We.a.rX(za.style.right)-rb:We.a.rX(za.style.left)}Ojl(){return this.g8&&this.g8.length?this.Swg+Math.min(this.g8.length-1,2)*
this.kxj:0}}Object(m.a)(Sg,"ModernPresenceTooltipTarget",null,[]);var Ti=d(159);class ig extends xc{constructor(za,rb,Zb){super(za);this.qTb=this.WGa=this.cHg=this.Yob=!1;this.Tp=[];this.ibd={};this.Md=Zb;this.Ql=Zb.get(8,!1);this.aGg=Zb.get(15,!1);this.lzj=Zb.get(12,0);this.W$a=Zb.get(6,0);this.n9a=rb;this.L3g=Zb.get(16);this.woe=Zb.get(17,!1);this.qFj=Zb.get(19,!1);this.rPj=Zb.get(20,!1);this.Zdd=0;this.kPj=new Bh(this.Ql,this.woe);this.vic=this.ONh();this.Rrb=!1;this.SMb=[];this.loc=[];this.element.id=
ig.Ccb();this.element.className=xc.yth(this.Ql);this.wWa&&(this.zIndex=this.wWa);this.rtl=this.Ql;this.lWf(rb);this.y4=this.createElement("div");this.y4.className="prFlyoutContainer";this.element.appendChild(this.y4);this.g8=[];this.O6a=new Sg(this.T1,this.element,this.W$a,4,6,32,this.Ql);this.Er=Zb.get(9);this.Er.mb(oe.a.pointerDown,this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"));this.Er.mb(oe.a.pointerOver,this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"));this.Er.mb(oe.a.pointerOut,
this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"))}get b_d(){return H.a.clone(this.Tp)}get T1(){return this.g8}get wWa(){return this.lzj}get mXa(){return this.T1?this.T1.length:0}get UKb(){return 0<this.mXa?this.T1[0].state:5}get fpf(){return 3===this.UKb&&!this.Yob}Oub(za){this.addHandler(bd.sT,za)}OHb(za){this.removeHandler(bd.sT,za)}dispose(){if(this.fpf)this.Rrb=!0;else{if(this.T1)for(const za of this.T1)za.OHb(Object(f.a)(this,this.xNa,"onInteractivityChanged")),rd.a.LA(za);this.g8=null;
this.Er.sc(oe.a.pointerDown,this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"));this.Er.sc(oe.a.pointerOver,this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"));this.Er.sc(oe.a.pointerOut,this.O6a.element,Object(f.a)(this,this.X9b,"onHitTarget"));super.dispose()}}hec(){this.MYb();this.visible=!0}H_c(){this.visible=!0;this.iEh();this.Yob=!0}JZf(){this.H_c()}hide(){this.vMi();this.JYa();this.O6a.update(this.UKb,this.qTb)}Yca(za){const rb=this.UKb,Zb=this.Yob;za.clientId||(za.clientId=(ig.Goc++).toString());
if(za.clientId in this.ibd){var yc=this.Myb(za.clientId);if(0<=yc){yc=this.Tp[yc];if(yc.color===za.color&&yc.userName===za.userName)return;this.w1a(za.clientId)}}this.hide();yc=new zf(this.createElement("div"),this.Md);yc.Oub(Object(f.a)(this,this.xNa,"onInteractivityChanged"));this.y4.insertBefore(yc.element,this.y4.firstChild);this.ibd[za.clientId]=yc;Array.add(this.Tp,za);Array.add(this.T1,yc);this.nhj(rb,Zb);this.visible=!0}w1a(za){if(this.fpf)Array.add(this.loc,za);else{var rb=this.UKb,Zb=this.Yob;
this.hide();this.bXc(za);this.nhj(rb,Zb)}}Nqi(za){const rb=this.Myb(za);if(!(0>=rb)){var Zb=this.Tp[rb];za=this.ibd[za];Array.removeAt(this.Tp,rb);Array.insert(this.Tp,0,Zb);Array.removeAt(this.T1,rb);Array.insert(this.T1,0,za);this.y4.removeChild(za.element);this.y4.appendChild(za.element);this.MYb()}}nhj(za,rb){0>=this.Tp.length?this.hide():3===za&&rb?this.H_c():this.hec()}m6e(za){if(this.fpf&&this.qFj)return!1;za=ig.Gff(za);if(this.y4!==za&&Xi.a.YLa(this.y4,za))return!0;for(const rb of this.T1)if(Xi.a.YLa(rb.element,
za))return!0;return!1}position(za,rb){this.element.style.top=rb+"px";this.element.style.left=za+"px"}MYb(za=!1){if(!za||this.WGa){this.cHg&&this.pZi(!0);var rb=Math.min(3,this.mXa)-1;za=0;var Zb=1,yc=0;this.qTb&&(za=this.vic,Zb=-1,yc=-this.W$a);for(let Vc=this.mXa-1;Vc>rb;Vc--)this.T1[Vc].B2i(this.Tp[Vc],-4*rb*Zb+yc,!0,!1,!0,za);for(;0<=rb;rb--)this.T1[rb].B2i(this.Tp[rb],-4*rb*Zb+yc,0<rb,Array.contains(this.SMb,this.Tp[rb].clientId),rb!==this.Zdd,za);this.Zdd=0;this.O6a.update(0,this.qTb);this.zIndex=
this.wWa;this.Yob=!1;this.vMi(0);this.Rrb&&this.dispose()}}iEh(){this.cHg&&this.pZi(!1);this.zIndex=this.wWa+1;let za,rb,Zb;({offsetX:rb,offsetY:za,g4h:Zb}=this.jJn());for(let yc=0;yc<this.mXa;yc++)this.T1[yc].PUn(this.Tp[yc],rb,za+(this.W$a+2)*yc,yc!==this.Zdd,Zb)}JYa(){let za=0,rb=0;this.qTb&&(za=this.vic,rb=-6);for(let Zb=0;Zb<this.mXa;Zb++)this.T1[Zb].hide(this.Tp[Zb],rb,za);this.zIndex=this.wWa;this.visible=this.Yob=!1;this.Rrb&&this.dispose()}mWe(za=0){za?(this.WGa=!0,G.Task.delay(za).continueWith(()=>
{this.aGg?this.vWl():this.MYb(!0);this.WGa=!1})):this.aGg?this.hide():this.MYb()}vWl(){this.WGa&&this.hide()}Sgk(){if(v.AFrameworkApplication.ua&&v.AFrameworkApplication.ua.Sb.Wla&&Ti.c()){const za=appChrome.selectors.getShyState();return za.isActive&&0!==za.state}return!1}xNa(za,rb){za=this.UKb;this.Sgk()||2!==rb.type&&(4!==rb.type||3===za)?4===rb.type&&3===za?(this.WGa&&(this.WGa=!1),this.mWe()):3!==rb.type||3!==za||this.Yob||(1<this.mXa?(this.WGa=!0,G.Task.delay(250).continueWith(()=>{this.MYb(!0);
this.WGa=!1})):this.mWe()):(this.WGa&&(this.WGa=!1),3!==za&&(this.iEh(),3===rb.An.eg&&this.mWe(2E3)));this.raiseEvent(bd.sT,rb)}X9b(za){3===za.eg?this.xNa(this,new bd(4,za)):za.eventName===oe.a.pointerOver?this.xNa(this,new bd(2,za)):za.eventName===oe.a.pointerOut&&this.xNa(this,new bd(3,za));return!1}lWf(za){this.element.style.width=za+"px";this.element.style.height=this.W$a+"px"}bXc(za){this.omn(za);za=this.Myb(za);if(!(0>za)){var rb=this.Tp[za];Array.removeAt(this.Tp,za);delete this.ibd[rb.clientId];
rb=this.T1[za];this.y4.removeChild(rb.element);this.Md.get(18,!1)&&rb.OHb(Object(f.a)(this,this.xNa,"onInteractivityChanged"));Array.removeAt(this.T1,za);rb.dispose()}}vMi(za=5){if(this.loc.length){this.visible&&this.JYa();for(let rb=0;rb<this.loc.length;rb++)this.bXc(this.loc[rb]);Array.clear(this.loc);0>=this.Tp.length||5===za?this.hide():0===za&&this.hec()}}Myb(za){for(let rb=0;rb<this.Tp.length;rb++)if(this.Tp[rb].clientId===za)return rb;return-1}omn(za){-1===this.Myb(za)?l.ULS.sendTraceTag(41706452,
302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.SMb,za)&&(Array.remove(this.SMb,za),this.Tp[0].clientId===za&&0<this.SMb.length&&this.Nqi(this.SMb[this.SMb.length-1]),this.Tp[0].clientId===za&&1===this.UKb&&this.MYb())}pZi(za){za?Sys.UI.DomElement.addCssClass(this.y4,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.y4,"prBackgroundSelection")}jJn(){let za,rb;rb=za=0;var Zb=this.vic;if(this.L3g){const yc=this.L3g(this);if(!yc)return{offsetX:za,offsetY:rb,
g4h:Zb};const Vc=4===this.UKb;Zb=this.kPj.avl(this.mXa,Vc?6:this.W$a,this.W$a,this.element,yc);rb=Zb.offsetTop;this.Zdd=this.Etl(Zb.$ij,Zb.offsetTop);Zb=Zb.h4h;Zb!==this.vic&&(this.CSf(Zb),this.element.dir=3===Zb?"rtl":"ltr",this.vic=Zb);Zb!==this.ONh()?(za=this.rPj?-2:Vc?-6:-this.W$a,this.qTb=!0):this.qTb=!1}return{offsetX:za,offsetY:rb,g4h:Zb}}Etl(za,rb){if(1===za)return this.mXa-1;za=Math.abs(rb);return 0<za?za/(this.W$a+2):0}CSf(za){for(let rb=0;rb<this.mXa;rb++)this.T1[rb].CSf(za)}ONh(){return this.Ql?
3:4}static Ccb(){return String.format("{0}-{1}","presencetooltip",ig.Goc++)}static Gff(za){return za.Ib.rawEvent.relatedTarget}}ig.Goc=0;Object(m.a)(ig,"ModernPresenceTooltipControl",xc,[1054,10]);var Tg=d(204),af=d(233);class qf{constructor(za){this.Md=za;this.Md.RIa(10,Tg.a.instance);this.Md.RIa(9,Ld.a.instance);this.Md.RIa(6,20);this.Md.RIa(13,af.a.instance);this.Md.RIa(17,!1)}aZe(za,rb=!1){this.Md.RIa(15,rb);return new ig(za,20,this.Md)}}Object(m.a)(qf,"ModernPresenceTooltipFactory",null,[1053]);
class gj extends xc{constructor(za,rb){super(za);this.Tp=null;this.gIa=rb.get(8,!1);this.W5a=rb.get(6,0);this.element=za;this.element.className=gj.E8e;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.gg=rb.get(10);this.gg.mb(oe.a.click,this.element,Object(f.a)(this,this.onClick,"onClick"));this.Er=rb.get(9);this.Er.mb(oe.a.pointerOut,this.element,Object(f.a)(this,this.cO,"onPointerOut"));this.Er.mb(oe.a.pointerDown,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior"));
this.xD=rb.get(13);this.xD.mb(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior"))}Oub(za){this.addHandler(bd.sT,za)}OHb(za){this.removeHandler(bd.sT,za)}get users(){return this.Tp}dispose(){this.element&&(this.gg.sc(oe.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.Er.sc(oe.a.pointerDown,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.Er.sc(oe.a.pointerOut,this.element,Object(f.a)(this,this.cO,"onPointerOut")),
this.xD.sc(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(za,rb,Zb){this.hide();!za||0>=za.length||(this.gIa?this.element.style.right=rb+"px":this.element.style.left=rb+"px",this.element.style.top=Zb+"px",this.w4j(za),this.visible=!0)}w4j(za){this.Tp=za;Xi.a.jA(this._ul);for(let rb=za.length-1;0<=rb;rb--)this.Yca(za[rb])}Yca(za){const rb=document.createElement("li");rb.style.backgroundColor=za.color;rb.style.height=
this.W5a+"px";rb.id="fly_"+za.clientId;rb.style.lineHeight=this.W5a+"px";Xi.a.ey(rb,za.userName);rb.setAttribute("dir","auto");this._ul.appendChild(rb)}onClick(){this.hide();return!1}cO(za){this.raiseEvent(bd.sT,new bd(3,za));return!1}}gj.E8e="prFlyout UIFont";Object(m.a)(gj,"PresenceTooltipFlyoutControl",xc,[]);class Fe extends xc{constructor(za,rb,Zb){super(za);this._img=null;this.Tp=[];this.element.className="prGlyph";this.Md=rb;this.USb=this.Md.get(9);this.lq=this.Md.get(10);this.xD=this.Md.get(13);
this.SWl();this.Yca(Zb);this.Sse=!1}get h0a(){return this.Tp.length}get users(){return this.Tp}Oub(za){this.addHandler(bd.sT,za)}OHb(za){this.removeHandler(bd.sT,za)}dispose(){this.Zbo();super.dispose()}Yca(za){Array.add(this.Tp,za);2===this.h0a?this.dha(!0):1===this.h0a?this.dha(!1):this.dha(this.Sse)}w1a(za){this.N6k(za)&&(1<this.h0a&&this.dha(!0),1===this.h0a?this.dha(!1):1>this.h0a&&this.hide())}show(){this.dha(2<=this.h0a);this.visible=!0}hide(){this.visible=!1}ntl(za){return za?this.sMh(0,5):
this.sMh(1,4)}N6k(za){for(let rb=0;rb<this.h0a;rb++)if(this.Tp[rb].clientId===za)return za=this.Tp[rb],Array.removeAt(this.Tp,rb),za;return null}dha(za){this.Sse!==za&&(this._img&&this.element.removeChild(this._img),this._img=this.ntl(za),this.element.appendChild(this._img),this.Sse=za);this._img.childNodes[0].style.backgroundColor=this.Tp[this.Tp.length-1].color}sMh(za,rb){const Zb=this.Md.get(6,0),yc=this.Md.get(14);return uf.createClusteredImageFromClusterWithImageClass(Zb,Zb,this.Md.get(za),this.Md.get(rb),
"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,yc?yc.cloneNode(!0):null)}mX(za){3!==za.eg&&this.raiseEvent(bd.sT,new bd(2,za));return!1}onClick(za){this.raiseEvent(bd.sT,new bd(1,za));return!0}cO(za){3!==za.eg&&this.raiseEvent(bd.sT,new bd(3,za));return!1}Zbo(){this.element&&(this.USb.sc(oe.a.pointerDown,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.USb.sc(oe.a.pointerOver,this.element,Object(f.a)(this,this.mX,"onPointerOver")),this.USb.sc(oe.a.pointerOut,
this.element,Object(f.a)(this,this.cO,"onPointerOut")),this.lq.sc(oe.a.KC,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.lq.sc(oe.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.xD.sc(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")))}SWl(){this.element&&(this.USb.mb(oe.a.pointerDown,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.USb.mb(oe.a.pointerOver,this.element,
Object(f.a)(this,this.mX,"onPointerOver")),this.USb.mb(oe.a.pointerOut,this.element,Object(f.a)(this,this.cO,"onPointerOut")),this.lq.mb(oe.a.KC,this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")),this.lq.mb(oe.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.xD.mb(this.element,Object(f.a)(this,this.Fga,"stopPropagationAndPreventDefaultBehavior")))}}Object(m.a)(Fe,"PresenceTooltipGlyph",xc,[]);class $e extends xc{constructor(za,rb,Zb){super(za);this.Tp=
[];this.zJ=[];this.BHa=0;this.fvc=this.UPb=!1;this.ysg=null;this.jbd={};this.Md=Zb;this.Ql=Zb.get(8,!1);this.lia=Zb.get(11,!1);za=Zb.get(12,0);this.imageDimension=Zb.get(6,0);this.n9a=rb;this.element.id=$e.Ccb();this.element.className=xc.yth(this.Ql);za&&(this.zIndex=za);this.rtl=this.Ql;this.lWf(rb);this.Ywa=this.createElement("div");this.Ywa.className=this.lia?"prContainerV":"prContainerHr";this.element.appendChild(this.Ywa);this.wDg=Array(this.BHa);for(rb=0;rb<this.BHa;rb++)this.U9[rb]=new gj(this.createElement("div"),
this.Md),this.U9[rb].Oub(Object(f.a)(this,this.xNa,"onInteractivityChanged")),this.element.appendChild(this.U9[rb].element)}get b_d(){return H.a.clone(this.Tp)}get U9(){return this.wDg}get y5g(){return this.ysg}get d8d(){return this.imageDimension+2}get width(){return this.lia?this.d8d:this.n9a}get height(){return this.lia?this.n9a:this.d8d}Oub(za){this.addHandler(bd.sT,za)}OHb(za){this.removeHandler(bd.sT,za)}dispose(){if(this.U9)for(const za of this.U9)za.OHb(Object(f.a)(this,this.xNa,"onInteractivityChanged")),
rd.a.LA(za);rd.a.iUf(this.zJ);this.zJ=this.wDg=null;super.dispose()}hec(){this.JYa();this.YZf();this.visible=!0;this.UPb=!1}H_c(){!this.zJ||1>this.zJ.length||(this.JYa(),this.visible=!0,this.YZf(),this.SZd(this.zJ[this.zJ.length-1]),this.UPb=!0)}JZf(){if(this.zJ&&!(1>this.zJ.length)){this.visible=!0;this.YZf();var za=0;for(const rb of this.zJ)this.SZd(rb,za++);this.UPb=!1;this.fvc=!0}}hide(){this.visible=!1;this.JYa();for(let za=0;za<this.zJ.length;za++)this.zJ[za].hide();this.UPb=!1}mkh(){if(!this.fvc)return!1;
let za=0;for(const rb of this.U9)rb.visible&&za++;return this.fvc=0<za&&(this.Tp.length<=this.BHa?za===this.Tp.length:za===this.BHa)}Yca(za){if(!(0>=this.BHa)){za.clientId||(za.clientId=($e.Goc++).toString());if(za.clientId in this.jbd){var rb=this.Myb(za.clientId);if(0<=rb){rb=this.Tp[rb];if(rb.color===za.color&&rb.userName===za.userName)return;this.w1a(za.clientId)}}rb=this.mkh();var Zb=0;if(this.Tp.length<this.BHa){var yc=new Fe(this.createElement("div"),this.Md,za);yc.Oub(Object(f.a)(this,this.xNa,
"onInteractivityChanged"));this.Ql&&!this.lia&&0<this.Tp.length?this.Ywa.insertBefore(yc.element,this.Ywa.firstChild):(this.Ywa.appendChild(yc.element),Zb=this.zJ.length);Array.add(this.zJ,yc)}else this.Ql&&!this.lia?yc=this.zJ[0]:(Zb=this.zJ.length-1,yc=this.zJ[Zb]),yc.Yca(za);yc.show();this.jbd[za.clientId]=yc;Array.add(this.Tp,za);this.kfj(yc,Zb);rb&&this.JZf()}}w1a(za){const rb=this.mkh();rb&&this.JYa();this.bXc(za);this.Tp.length>=this.BHa&&this.zJ.length<this.BHa&&this.Een();0>=this.Tp.length?
this.hide():rb&&this.JZf()}Nqi(){}bXc(za){var rb=this.Myb(za);0>rb||(za=this.Tp[rb],Array.removeAt(this.Tp,rb),rb=this.jbd[za.clientId],delete this.jbd[za.clientId],rb.w1a(za.clientId),this.kfj(rb),0>=rb.h0a&&(this.Ywa.removeChild(rb.element),Array.remove(this.zJ,rb),rb.dispose()))}Een(){var za=this.cAl();!za||1>=za.users.length||(za=Array.clone(this.Tp),za.forEach(rb=>{this.bXc(rb.clientId)}),za.forEach(rb=>{this.Yca(rb)}))}Myb(za){for(let rb=0;rb<this.Tp.length;rb++)if(this.Tp[rb].clientId===za)return rb;
return-1}cAl(){return this.Ql&&!this.lia?this.zJ[0]:this.zJ[this.zJ.length-1]}position(za,rb){this.element.style.top=rb+"px";this.element.style.left=za+"px"}YZf(){for(let za=0;za<this.zJ.length;za++)this.zJ[za].show()}JYa(){for(let za=0;za<this.BHa;za++)this.U9[za].hide();this.fvc=!1}SZd(za,rb=0){if(za)if(this.ysg=za,this.lia){const Zb=this.imageDimension;if(1<za.users.length)this.U9[rb].show(za.users,Zb,this.height-this.imageDimension);else{const yc=this.Ywa.children.length;for(let Vc=0;Vc<this.Ywa.children.length;Vc++)za.element===
this.Ywa.children[Vc]&&this.U9[rb].show(za.users,Zb,this.height-(yc-Vc)*this.d8d+2)}}else this.U9[rb].show(za.users,this.width,0)}xNa(za,rb){var Zb=Object(w.a)(Fe,za);Zb=Zb?this.ZFh(Zb):-1;if(2===rb.type||1===rb.type&&-1!==Zb&&!this.U9[Zb].visible)this.SZd(za);else if(1===rb.type)this.JYa(),this.UPb=!1;else if(3===rb.type){if(this.m6e(rb.An))return;this.UPb||this.JYa()}this.raiseEvent(bd.sT,rb)}m6e(za){za=$e.Gff(za);let rb=!1;for(const Zb of this.U9)if(Xi.a.YLa(Zb.element,za)){rb=!0;break}return this.Ywa!==
za&&Xi.a.YLa(this.Ywa,za)||rb}kfj(za,rb=0){const Zb=this.U6l(za);Zb&&0>=za.h0a?this.U9[rb].hide():Zb?this.SZd(za):this.U9[rb].hide()}ZFh(za){let rb=0;for(const Zb of this.zJ){if(za===Zb)return rb;rb++}return-1}U6l(za){const rb=this.ZFh(za);return!!this.y5g&&za===this.y5g&&-1!==rb&&this.U9[rb].visible}lWf(za){this.BHa=za===this.imageDimension?1:Math.floor(za/this.d8d);this.lia?(this.element.style.height=za+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=za+"px",this.element.style.height=
this.imageDimension+"px")}static Ccb(){return String.format("{0}-{1}","presencetooltip",$e.Goc++)}static Gff(za){za=za.Ib.rawEvent;return za.relatedTarget||za.toElement}}$e.Goc=0;Object(m.a)($e,"PresenceTooltipControl",xc,[1054,10]);class Ff{constructor(za){this.Md=za;this.Md.RIa(10,Tg.a.instance);this.Md.RIa(9,Ld.a.instance);this.Md.RIa(6,16);this.Md.RIa(13,af.a.instance)}aZe(za){return new $e(za,16,this.Md)}}Object(m.a)(Ff,"PresenceTooltipFactory",null,[1053]);var ye=d(263),Sf=d(103),vg=d(58),Tf=
d(5),wg=d(6),rf=d(21),sh=d(89),si=d(560),Dg=d(307),ai=d(120);class Ue extends Sys.EventArgs{constructor(za,rb){super();this.paragraphId=za;this.fpm=rb}}Object(m.a)(Ue,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class ed extends xc{constructor(za,rb,Zb,yc,Vc,Sd=null,de=null){super(null);this.$ad=this.Gm=null;this.OPc=!1;this.$na=0;this.Xo=za;this.cwc=rb;this.Er=Zb;this.Ki=yc;this.MFa=Vc;ed.spb=0;this.M$g=new Ja.a;this.sQi=new Ja.a;this.qV=Sd;this.Ma=de;this.gCj=this.Ma.rc("PresenceIpRenderedFloodgateTimeLapseSec",
30);this.WWj=this.Ma.rc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Loa=0}get X_a(){return v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}d5j(za){this.addHandler("CR",za)}eNi(za){this.removeHandler("CR",za)}n1d(){this.raiseEvent("CR",new Ue(this.Xo.ip.paragraphId,this.OPc))}nzf(){if(Object(ai.a)(ig,this.Gm)){const za=Object(w.a)(ig,this.Gm);ed.spb=0<ed.spb?ed.spb+1:za.wWa+1;za.zIndex=ed.spb;this.element.style.zIndex=String(ed.spb)}}Gun(){if(Object(ai.a)(ig,this.Gm)){const za=
Object(w.a)(ig,this.Gm);ed.spb=za.wWa;za.zIndex=za.wWa;this.element.style.zIndex=String(za.wWa)}}Gli(){this.qV&&!this.E9n()&&this.qV.continueWith(()=>{this.qV.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.gCj)&&this.Loa++})}E9n(){return this.Loa>=this.WWj}static Uki(){ed.iDg||(ed.iDg=!0,l.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Ccb(za){return ed.eYl+za.gQh()}}ed.BEi="data-presence-control";ed.FAi="OverlayControlElementOwner";
ed.eYl="ipId_";ed.CEi="WacPresence";ed.zZm="PresenceIpPaddingDiv";ed.iDg=!1;ed.spb=0;Object(m.a)(ed,"APresenceControl",xc,[1235,10]);class Dl{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.o2a=!1}}Object(m.a)(Dl,"PresenceImageControlStyle",null,[1234]);class Hi extends ed{constructor(za,rb,Zb,yc,Vc,Sd=null,de=null){super(za,rb,Zb,yc,Vc,Sd,de);this.cO=()=>{this.Vpi();return!1};this.yXd=jf=>{this.Gm&&3===jf.eg&&(2!==this.$na?(this.nzf(),this.ZJb()):this.Vpi());return!1}}w1a(za){this.Gm&&
this.Gm.w1a(za)}fce(){return this.Gm?this.Gm.b_d.length:0}updatePosition(za){if(this.element&&this.element.parentNode){var rb=this.JQh(za);if(rb){var Zb=Sys.UI.DomElement.getBounds(this.element.parentNode),yc,Vc;({left:Zb,top:yc,height:Vc,width:rb}=this.BCl(rb,Zb,this.element.parentNode,this.Ki.instance));this.element.style.top=yc+"px";this.element.style.left=Zb+"px";this.element.style.height=Vc+"px";this.element.style.width=rb+"px";Zb=this.PQh(za);We.a.BX(this.element,Zb);za=this.ldf(za,this.Xo.ip.shapeId);
this.UZi(Zb,rb,this.isSelected(za),v.AFrameworkApplication.isRtl);this.ZJb()}}}IA(){this.element&&(Xi.a.dv(this.element),this.Gm.w1a(this.Xo.user.clientId),this.n1d())}ooh(za,rb,Zb,yc){rb=new Dl;if(!yc||!Zb)return rb;Zb=this.JQh(za);if(!Zb)return rb;rb.top=Zb.y;rb.left=Zb.x;rb.height=Zb.height;rb.width=Zb.width;rb.rotation=this.eFl(za);rb.o2a=!0;return rb}UNi(za,rb,Zb,yc){ed.Uki();this.$ad=za;if(yc){const Vc=this.ldf(za,this.Xo.ip.shapeId);if(!Vc)return;const Sd=!this.element;Sd&&this.dZe(rb.ownerDocument,
za);Sd||!this.element.parentNode?Vc.appendChild(this.element):this.element.parentNode!==Vc&&(this.element.parentNode.removeChild(this.element),Vc.appendChild(this.element));this.Gm.Yca(this.Xo.user);this.element.style.borderColor=this.Xo.user.color;this.element.id=ed.Ccb(this.Xo);Zb.o2a&&(this.element.style.height=Zb.height+"px",this.element.style.top=Zb.top+"px",this.element.style.left=Zb.left+"px",this.element.style.width=Zb.width+"px",We.a.BX(this.element,Zb.rotation),We.a.BX(this.Gm.element,-1*
Zb.rotation),this.UZi(Zb.rotation,Zb.width,this.isSelected(Vc),v.AFrameworkApplication.isRtl),this.ZJb())}this.OPc=!yc;this.n1d()}eFl(za){return this.element&&this.element.parentNode&&this.JWh(We.a.getTransform(this.element.parentNode))?this.JWh(We.a.getTransform(this.element)):this.PQh(za)}JWh(za){return za&&-1<za.indexOf("deg")&&(za=parseInt(za.substring(za.indexOf("(")+1,za.indexOf("deg"))),!isNaN(za))?za:0}Lej(za){this.element.style.borderColor=this.Xo.user.color;this.element.id=ed.Ccb(this.Xo);
this.updatePosition(za)}dZe(za,rb){this.element=za.createElement("div");this.element.setAttribute(ed.BEi,!0);Sf.a.Hl(this.element,ed.FAi,this);this.element.className=Hi.Z5m;v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",!1)&&(za=rb.zb)&&za.rP&&(this.element.style.pointerEvents="none");this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.Gm=this.cwc.aZe(this.createElement("div"),!0);this.Gm.Yca(this.Xo.user);
this.Gm.hide();this.Er.mb(oe.a.pointerOut,this.Gm.element,this.cO);this.Er.mb(oe.a.pointerDown,this.Gm.element,this.yXd);this.Gm.element.classList.add(ed.CEi);this.element.appendChild(this.Gm.element)}BCl(za,rb,Zb,yc){let Vc=za.y,Sd=za.x,de=za.height;za=za.width;(1<Math.abs(rb.width-Zb.offsetWidth)||1<Math.abs(rb.height-Zb.offsetHeight))&&yc&&(Vc=Math.round(Vc/yc.vj),Sd=Math.round(Sd/yc.vj),de=Math.round(de/yc.vj),za=Math.round(za/yc.vj));return{left:Sd,top:Vc,height:de,width:za}}isSelected(za){return za.classList.contains(Dg.a.n_b)}UZi(za,
rb,Zb,yc){this.Gm.element.style.left="auto";this.Gm.element.style.top="auto";this.Gm.element.style.right="auto";this.Gm.element.style.bottom="auto";Zb=Zb?Math.round(.5*Hi.Zna)+Hi.K7n:0;0<=za&&90>za||360===za?(this.Gm.element.style.top=-.5*Hi.Zna-Zb+"px",yc?this.Gm.element.style.right=rb-.5*Hi.Zna+"px":this.Gm.element.style.left=rb-.5*Hi.Zna+"px"):90<=za&&180>za?(this.Gm.element.style.left=-.5*Hi.Zna-Zb+"px",yc?this.Gm.element.style.bottom=-.5*Hi.Zna+"px":this.Gm.element.style.top=-.5*Hi.Zna+"px"):
180<=za&&270>za?(this.Gm.element.style.bottom=-.5*Hi.Zna-Zb+"px",yc?this.Gm.element.style.left=rb-.5*Hi.Zna+"px":this.Gm.element.style.right=rb-.5*Hi.Zna+"px"):(this.Gm.element.style.right=-.5*Hi.Zna-Zb+"px",yc?this.Gm.element.style.top=-.5*Hi.Zna+"px":this.Gm.element.style.bottom=-.5*Hi.Zna+"px")}Yh(za,rb){const Zb=this.XEd(za,rb);return Zb?Zb.properties:(za=this.OQh(za,rb))?za.properties:null}ldf(za,rb){var Zb=this.XEd(za,rb);return Zb&&(Zb=Zb.dYa(za.Ig))?Zb.element:(rb=this.OQh(za,rb))?Object(w.a)(si.a,
rb).De(za.Tb).htmlElement:null}XEd(za,rb){za=sh.i(za.zb,5);for(const Zb of za)if(Zb.properties.getValue(Tf.a.dyb)===rb)return Zb;return null}OQh(za,rb){za=wg.GraphIterator.$a(za.zb);let Zb=za.Rb(6);for(;Zb;){const yc=Zb.properties.getValue(Tf.a.dyb);if(rf.ImageReader.qw(Zb)&&yc===rb)return Zb;Zb=za.wf(6)}return null}ctl(za){const rb=vg.a.yf(rf.ImageReader.nA(za),0);za=vg.a.yf(rf.ImageReader.zB(za),1);return{kha:rb,OVl:za}}PQh(za){za=this.Yh(za,this.Xo.ip.shapeId);return rf.ImageReader.oZ(za)}JQh(za){var rb=
this.Xo.ip;if(!rb||!rb.shapeId)return null;var Zb=this.Yh(za,rb.shapeId);const yc=this.ldf(za,rb.shapeId);if(!Zb||!yc)return null;const Vc=rf.ImageReader.tl(Zb);let Sd=za=1,de;({kha:rb,OVl:de}=this.ctl(Zb));Oa.App.instance&&Oa.App.instance.nta(Vc)?(Zb=rf.ImageReader.Rka(Zb),za=vg.a.yf(Zb[0],0),Sd=vg.a.yf(Zb[2],1)):Zb.hasProperty(Tf.a.X2)?(Zb=Zb.getValue(Tf.a.X2),za+=vg.a.yf(Zb[0],0),Sd+=vg.a.yf(Zb[2],1)):(za+=0<yc.offsetWidth?(yc.offsetWidth-rb)/2:2,Sd+=0<yc.offsetHeight?(yc.offsetHeight-de)/2:2);
return new Sys.UI.Bounds(Math.round(za),Math.round(Sd),Math.round(rb),Math.round(de))}Vpi(){this.Gm&&(this.Gm.hec(),this.$na=1)}ZJb(){for(const za of this.Gm.b_d)if(za.clientId===this.Xo.user.clientId&&!za.equals(this.Xo.user)){this.Gm.Yca(this.Xo.user);break}if(this.Xo.oPa||2===this.$na)this.Gm.H_c(),this.Xo.oPa=!1,this.Xo.S$=!0,this.$na=2;this.Xo.S$&&1!==this.$na||(this.Gm.hec(),this.Xo.S$=!0,this.$na=1)}}Hi.Z5m="WACImgPresenceHighlight";Hi.Zna=20;Hi.K7n=6;Object(m.a)(Hi,"PresenceImageControl",
ed,[]);var tk=d(293);class ok{constructor(){this.height=this.top=this.left=this.c9h=0;this.o2a=!1;this.EA=this.xh=null}}Object(m.a)(ok,"PresenceIpControlStyle",null,[1234]);var se=d(76);class bi extends ed{constructor(za,rb,Zb,yc,Vc,Sd=null,de=null,jf=null){super(za,rb,Zb,yc,Vc,Sd,de);this.mvc=this.jSa=this.sUb=null;this.mX=Ke=>{!this.Gm||this.X_a&&!this.Gm.m6e(Ke)||(this.nzf(),this.j4d(Ke));this.Lej(this.$ad);return!1};this.cO=()=>{this.Gm&&this.$P();return!1};this.yXd=Ke=>{this.Gm&&3===Ke.eg&&(2!==
this.$na?(this.nzf(),this.j4d(Ke)):this.$P());return!1};this.qC=jf}dZe(za){this.element=za.createElement("div");this.element.setAttribute(ed.BEi,!0);Sf.a.Hl(this.element,ed.FAi,this);this.element.className=ed.zZm;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.Er.mb(oe.a.pointerOver,this.element,this.mX);this.X_a&&(this.Er.mb(oe.a.pointerOut,this.element,this.cO),this.Er.mb(oe.a.pointerDown,this.element,this.yXd));this.jSa=this.createElement("div");this.jSa.className=bi.$5m;this.X_a||
(this.mvc=this.createElement("div"),this.mvc.className=bi.c6m,this.jSa.appendChild(this.mvc));this.Gm=this.cwc.aZe(this.createElement("div"),this.X_a);za=this.Ma.$("NoPresenceUserLookUpBeforeRender");this.qC&&!za&&(this.Xo.user=this.qC.vmi(this.Xo.user.clientId)||this.Xo.user);this.Gm.Yca(this.Xo.user);this.Gm.hide();this.Gm.element.classList.add(this.X_a?ed.CEi:bi.K1m);this.jSa.appendChild(this.Gm.element);this.element.appendChild(this.jSa)}NQk(){this.sUb&&(zb.a.instance.ef(this.sUb),this.sUb=null)}ZJb(za){for(var rb of this.Gm.b_d)if(rb.clientId===
this.Xo.user.clientId&&!rb.equals(this.Xo.user)){this.Gm.Yca(this.Xo.user);break}rb=!1;bi.ROk===this.Xo.user.color?({value:rb}=this.M$g.Dc(this.Xo.user.clientId,!1),rb||(this.M$g.Z(this.Xo.user.clientId,!0),l.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Xo.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:rb}=this.sQi.Dc(this.Xo.user.clientId,!1),rb||(this.sQi.Z(this.Xo.user.clientId,!0),l.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Xo.user.clientId+'" , "Event" : "RenderColoredPawn"}')));
return za||this.Xo.oPa||2===this.$na?(this.Gli(),this.Gm.H_c(),this.Xo.oPa=!1,this.Xo.S$=!0,this.$na=2,bi.x6n):this.Xo.S$&&1!==this.$na?0:(this.Gli(),this.Gm.hec(),this.Xo.S$=!0,this.$na=1,bi.w6n)}j4d(za=null){this.NQk();const rb=this.ZJb(!!za);this.X_a&&za&&za.eventName===oe.a.pointerOver||this.wAn(rb)}$P(){this.Gm&&this.$na&&(this.Gun(),this.Gm.hide(),this.$na=0)}wAn(za){this.sUb=new ta.a(2,1,za,()=>{this.sUb=null;this.$P()},56);zb.a.instance.$b(this.sUb)}updatePosition(za){if(this.element&&this.element.parentNode){var rb=
this.tRh(za);if(rb){za=Sys.UI.DomElement.getBounds(this.element.parentNode);rb=new Sys.UI.Bounds(rb.x-za.x,rb.y-za.y,bi.f9h,rb.height);var Zb;({left:za,top:rb,height:Zb}=this.ECl(rb,za,this.element.parentNode,this.Ki.instance));this.element.style.height=2*bi.J$b+Zb+"px";this.element.style.top=rb-bi.J$b+"px";this.element.style.left=za-bi.J$b+"px";this.jSa.style.height=Math.max(bi.Jpi,Zb)+"px";this.j4d()}}}IA(){this.element&&(Xi.a.dv(this.element),this.n1d())}ooh(za,rb,Zb,yc,Vc){const Sd=new ok;if(!yc||
!Zb)return Sd;yc=this.tRh(za);if(!yc)return Sd;var de=Zb;Zb=za;if(za.Tj){var jf=za.ic;de=za.Ag.a3b(this.Xo.ip.X6.cp);0>de&&0==de;za.ic.jta?Xi.a.YLa(jf.editingElement,za.Ag.Hi.J(de))||(Zb=za.source.Ui(se.InteractiveViewManager.instance.xd.Tb),rb=Zb.Ag.Hi.J(de)):rb=Zb.Ag.Hi.J(de);de=rb.getBoundingClientRect()}de=new Sys.UI.Bounds(yc.x-de.x,yc.y-de.y,bi.f9h,yc.height);za=de.y;yc=de.x;de=de.height;jf=this.Ki.instance;Vc&&jf&&(Vc=jf.vj,za=Math.round(za/Vc),yc=Math.round(yc/Vc),de=Math.round(de/Vc));Sd.top=
za-bi.J$b;Sd.left=yc-bi.J$b;Sd.height=2*bi.J$b+de;Sd.c9h=Math.max(bi.Jpi,de);Sd.o2a=!0;Sd.xh=rb;Sd.EA=Zb;return Sd}UNi(za,rb,Zb,yc){ed.Uki();this.$ad=za;za=Zb.xh;rb=Zb.EA;if(za&&rb){if(yc){const Vc=!this.element;Vc&&this.dZe(za.ownerDocument);Vc||!this.element.parentNode?za.appendChild(this.element):this.element.parentNode!==za&&(this.element.parentNode.removeChild(this.element),za.appendChild(this.element));this.$ad=rb;za=this.Xo.user.color;this.jSa.style.borderColor=za;this.X_a||(this.mvc.style.borderColor=
za);this.element.id=ed.Ccb(this.Xo);Zb.o2a&&(this.element.style.height=Zb.height+"px",this.element.style.top=Zb.top+"px",this.element.style.left=Zb.left+"px",this.jSa.style.height=Zb.c9h+"px",this.j4d())}this.OPc=!yc;this.n1d()}else l.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!za} or paragraphViewElement is null:${!rb}`)}dispose(){this.element&&(this.IA(),this.Er.sc(oe.a.pointerOver,this.element,this.mX),this.X_a&&(this.Er.sc(oe.a.pointerOut,this.element,
this.cO),this.Er.sc(oe.a.pointerDown,this.element,this.yXd)),rd.a.LA(this.Gm),this.element=this.Gm=null);super.dispose()}Lej(za){const rb=this.Xo.user.color;this.jSa.style.borderColor=rb;this.X_a||(this.mvc.style.borderColor=rb);this.element.id=ed.Ccb(this.Xo);this.updatePosition(za)}ECl(za,rb,Zb,yc){let Vc=za.y,Sd=za.x;za=za.height;(1<Math.abs(rb.width-Zb.offsetWidth)||1<Math.abs(rb.height-Zb.offsetHeight))&&yc&&(Vc=Math.round(Vc/yc.vj),Sd=Math.round(Sd/yc.vj),za=Math.round(za/yc.vj));return{left:Sd,
top:Vc,height:za}}tRh(za){const rb=this.Xo.ip;if(!rb)return null;let Zb;try{const yc=rb.X6.cp;Zb=tk.a.UY(yc,za,0<yc,!1,!1,!1)}catch(yc){l.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",zb.a.instance.Iv,yc.message,yc.stack),Zb=null}return Zb}}bi.K1m="WacPawn";bi.f9h=2;bi.w6n=7E3;bi.x6n=2E3;bi.J$b=5;bi.$5m="presenceIp";bi.c6m="PresenceSmallBox";bi.Jpi=10;bi.ROk="0xcccccc";Object(m.a)(bi,"PresenceIpControl",ed,[]);class sl{constructor(za,
rb,Zb,yc,Vc=null,Sd=null,de=null){this.Rkc={};this.Pkc={};this.Awg={};this.cwc=za;this.Er=rb;this.Hm=Zb;this.MFa=yc;this.qV=Vc;this.Ma=Sd;this.qC=de}get yNk(){return this.Rkc}get Ouh(){return this.Pkc}ACl(za){const rb=!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled");return za.ip.shapeId&&rb?this.FCl(za):this.GCl(za)}FCl(za){const rb=za.ip.shapeId.toString();this.Awg[za.user.clientId]=rb;const Zb=this.Pkc[rb];return Zb?(Zb.Xo=za,{returnValue:Zb,dce:!0}):{returnValue:this.Pkc[rb]=new Hi(za,
this.cwc,this.Er,this.Hm,this.MFa,this.qV,this.Ma),dce:!1}}GCl(za){const rb=za.user.clientId,Zb=this.Rkc[rb];return Zb&&Zb.Xo.user.equals(za.user)?(Zb.Xo=za,{returnValue:Zb,dce:!0}):{returnValue:this.Rkc[rb]=new bi(za,this.cwc,this.Er,this.Hm,this.MFa,this.qV,this.Ma,this.qC),dce:!1}}uRh(za){return this.Rkc[za]}Ysl(za){return(za=this.Pkc[this.Awg[za]])&&!za.fce()?za:null}YVk(){var za=this.Rkc;for(const rb in za)za[rb].dispose();za=this.Pkc;for(const rb in za)za[rb].dispose()}}Object(m.a)(sl,"PresenceControlProvider",
null,[]);var El=d(158);class ci{constructor(){this.h8a=0}mTh(){this.h8a++;this.h8a===Number.MAX_VALUE&&(this.h8a=1);return this.h8a}static get instance(){return ci.qsc}}ci.qsc=new ci;Object(m.a)(ci,"PacketIdGenerator",null,[707]);var Kk=d(1055);class pf{constructor(za,rb,Zb){this.KAn=za;this.xZl=rb;this.pii=Zb}}Object(m.a)(pf,"SuccessfulInboundReplicationCallbackData",null,[]);class $l{constructor(za,rb,Zb,yc,Vc,Sd,de){this.oyn=(jf,Ke)=>{Ke.type||(jf=this.Yj.TAh>=this.wAj,this.oWj&&jf?(jf=this.tpe())?
jf.LCh():l.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.bE())};this.TVm=jf=>{if(jf=Object(w.a)(pf,jf)){var Ke=jf.xZl.ni.toString(),Je=this.tpe(),Sh=Je.$t,sc="";Sh!==jf.pii&&(l.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",jf.KAn.toString()),sc=this.gyl(Je,Sh,jf.pii));l.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",sc,Ke)}else l.ULS.sendTraceTag(19964235,
500,10,"The callback data was null")};this.gyn=za;this.tpe=rb;this.Yj=Zb;this.oWj=Vc;this.wAj=Sd;this.cRb=yc;this.hq=de;this.gyn.j1(this.oyn)}bE(){const za=this.tpe();if(!za)l.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.cRb()&&za.KMa){let rb=-1;Object(ai.a)(Kk.a,za)&&(rb=za.Vj.xDa());const Zb=this.hq.fg("Task","ShoulderTapInboundReplicationTimer");za.bE(this.TVm,null,new pf(rb,Zb,za.$t))}}gyl(za,rb,Zb){const yc=new Sys.StringBuilder;
za=za.node.Ad.store.getRevision(rb);if(!za)return l.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:rb}),"";for(yc.append(za.id.guid);rb!==Zb;){yc.append(", ");yc.append(rb.guid);za=za.hl;if(!za)break;rb=za.id}return yc.toString()}}Object(m.a)($l,"ContentNotificationManager",null,[]);class qd extends $l{constructor(za,rb,Zb,yc,Vc,Sd,de){super(za,rb,Zb,yc,Vc,Sd,de)}static get LOa(){return null!=qd.uog?qd.uog:qd.uog=ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Oa.App.xa){var za=
Oa.App.xa.jb;za&&(za.Zca(qd.pSc),za=za.Zc)&&(qd.Pu=za.contentReplicator,qd.Pu&&Oa.App.jla().continueWith(qd.tEf))}}static tEf(){qd.g7c=Oa.App.jla().result;qd.g7c&&qd.g7c.Kp&&qd.LOa.iI().continueWith(qd.aTc)}static aTc(){qd.ij=qd.LOa.iI().result;if(qd.ij){var za=v.AFrameworkApplication.K,rb=za.$("Box4ThrottleInboundRequests");za=za.rc("Box4ThrottleInboundsAtUserCount",20);qd.Pu.SGd=()=>qd.ij.$Ma;qd.d7c=qd.d7c||new qd(qd.ij,()=>qd.Pu,qd.g7c,()=>v.AFrameworkApplication.Dk,rb,za,Oa.App.xa.iq);qd.d7c.bE()}}static pSc(za){qd.d7c||
(za.fjb(qd.pSc),qd.init())}}qd.d7c=null;qd.ij=null;qd.Pu=null;qd.g7c=null;Object(m.a)(qd,"WordContentNotificationManager",$l,[]);class Ak{constructor(za,rb,Zb,yc,Vc,Sd){this.Y7c=null;this.JUg=za;this.qd=Zb;this.EHa=yc;this.Yz=Vc;this.Fh=Sd;this.kMb=rb}clone(){return new Ak(this.JUg,this.kMb.clone(),this.qd,this.EHa,this.Yz,this.Fh)}get cp(){if(null!=this.Y7c)return this.Y7c;var za=this.JUg.paragraphId;if(za.equals(Ge.a.nil))return 0;var rb=this.EHa();if(!rb)return 0;za=rb.Eb(za);if(!za)return l.ULS.sendTraceTag(7685326,
302,15,"Paragraph Node is null so returning a CP with value 0"),0;rb=this.qd.Owb(this.qd.NNa(za.characterData,za.qa),this.kMb);if(this.Yz&&this.Fh&&za.ow){const Zb=gc.a.Uc(za,rb);Zb.Fb=this.Fh.nef(za,rb,this.kMb.hza);rb=this.Yz.Ada(Zb,!0)}return rb}vGf(){null==this.Y7c&&(this.Y7c=this.cp)}equals(za){return za?this.kMb.isEqual(za.kMb,!1):!1}}Object(m.a)(Ak,"WordPresenceCp",null,[718,71,719]);class tl{constructor(za,rb){this.Yz=za;this.Fh=rb}create(za,rb,Zb,yc){return new Ak(za,rb,Zb,yc,this.Yz,this.Fh)}}
Object(m.a)(tl,"Factory",null,[706]);var Ek=d(514);class Fl extends Sys.EventArgs{constructor(za,rb,Zb){super();this.paragraphId=za;this.presence=rb;this.Dnf=Zb}}Object(m.a)(Fl,"ParagraphChangedEventArg",Sys.EventArgs,[]);class Sn{constructor(za){this.cp=za}equals(za){return za?this.cp===za.cp:!1}clone(){return new Sn(this.cp)}}Object(m.a)(Sn,"PresenceCp",null,[718,71]);class hm{constructor(za,rb,Zb,yc,Vc){this.paragraphId=za;this.cp=rb;this.length=Zb;this.shapeId=yc;this.dryDeletion=Vc}}Object(m.a)(hm,
"SerializablePresenceIpData",null,[]);class Mg{constructor(za,rb,Zb,yc=0,Vc=0){this.Wpa=null;za&&(this.Wpa=Ge.a.Of(za));this.IUg=new Sn(rb);this.aDa=Zb;this.nZg=yc;this.VAg=Vc}get paragraphId(){return this.Wpa}get X6(){return this.IUg}get shapeId(){return this.nZg}get dryDeletion(){return this.VAg}Qd(){return 0<=this.X6.cp&&!!this.paragraphId&&!this.paragraphId.equals(Ge.a.nil)}getData(){return new hm(this.paragraphId.toString(),this.X6.cp,this.aDa,this.shapeId,this.dryDeletion)}clone(){const za=
new Mg;za.Wpa=this.paragraphId;za.IUg=this.X6?this.X6.clone():null;za.aDa=this.aDa;za.nZg=this.shapeId;za.VAg=this.dryDeletion;return za}static Rwb(za){return za.paragraphId&&void 0!==za.cp&&null!==za.cp&&void 0!==za.length&&null!==za.length?new Mg(za.paragraphId,za.cp,za.length,void 0,za.dryDeletion):null}}Object(m.a)(Mg,"PresenceIp",null,[688,71]);class Xo{constructor(za,rb){this.ip=za;this.user=rb}}Object(m.a)(Xo,"SerializablePresenceData",null,[]);class vj{constructor(za,rb){this.oPa=this.S$=
this.J8b=!1;this.iSa=rb;this.user=za}get ip(){return this.iSa}fgf(){return new Xo(this.ip?this.ip.getData():null,this.user.getData())}gQh(){return this.user.clientId+(this.iSa?this.iSa.paragraphId.toString():Ge.a.nil.toString())}Qd(){const za=!!this.user&&this.user.Qd(),rb=!this.ip||this.ip.Qd();return za&&rb}clone(){const za=new vj;za.user=this.user?this.user.clone():null;za.iSa=this.iSa?this.iSa.clone():null;za.S$=this.S$;za.J8b=this.J8b;za.oPa=this.oPa;return za}static Rwb(za){return za?new vj(Ea.Rwb(za.user),
za.ip?Mg.Rwb(za.ip):null):null}}Object(m.a)(vj,"PresenceInfo",null,[709,71]);class Zf extends Sa.a{constructor(){super();this.Csc={};this.QQa={};this.cDg=!1}get B_m(){return this.Csc}get Bdi(){return!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}o9g(za){this.addHandler("PPC",za)}INi(za){this.removeHandler("PPC",za)}oIc(za){return za.ip.paragraphId.toString()}jNe(za,rb=!1){this.cDg||(this.cDg=!0,l.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));
var Zb=({a6m:yc}=this.Nkm(za)).returnValue;if(yc&&!rb)(Zb=this.QQa[za.user.clientId])&&0<=Zb.length&&(Zb[Zb.length-1].ip.aDa=za.ip.aDa);else{Zb||this.AMi(za.user.clientId);this.Bdi&&Zb&&this.Zgo(za);rb=this.oIc(za);var yc=za.user.clientId;var Vc=this.Csc[rb]||[],Sd=this.QQa[yc]||[];Sd.length>=Zf.zoi&&(Sd=Sd.splice(-Zf.BLm,Zf.zoi));Zb||Vc.push(yc);Sd.push(za);this.Csc[rb]=Vc;this.QQa[yc]=Sd;za.ip.paragraphId.equals(Ge.a.nil)||this.kOf(za.ip.paragraphId,za,!0)}}Nkm(za){var rb=this.QQa[za.user.clientId];
const Zb=!rb||0>=rb.length?null:rb[rb.length-1],yc=!!Zb&&this.oIc(Zb)===this.oIc(za);rb=yc&&Zb.ip.X6.equals(za.ip.X6)&&Zb.user.equals(za.user);this.Bdi&&rb&&Zb.ip.shapeId&&za.ip.shapeId&&Zb.ip.shapeId!==za.ip.shapeId&&(rb=!1);return{returnValue:yc,a6m:rb}}Zgo(za){const rb=this.KNk(za);rb&&rb.ip.shapeId&&(za.ip.shapeId&&za.ip.shapeId===rb.ip.shapeId||this.kOf(rb.ip.paragraphId,rb,!1))}KNk(za){za=this.QQa[za.user.clientId];return!za||0>=za.length?null:za[za.length-1]}AMi(za){const rb=this.QQa[za];if(rb&&
0<rb.length){const Zb=rb[0].ip.paragraphId,yc=this.oIc(rb[0]);delete this.QQa[za];this.Vnn(yc,za);Zb.equals(Ge.a.nil)||this.kOf(Zb,rb[0],!1)}}lMh(za){return this.Csc[za]}uGc(za,rb,Zb,yc=!1){const Vc=[],Sd=this.lMh(za);if(!Sd)return Vc;for(let de=0;de<Sd.length;de++){const jf=Sd[de],Ke=this.QQa[jf];let Je=!1;for(let Sh=Ke.length-1;0<=Sh;Sh--){const sc=Ke[Sh];if(yc){if(sc.S$&&sc.ip.paragraphId.equals(Ge.a.Of(za))){Je=!0;Vc.push(sc);break}}else if(Object(ai.a)(vj,sc)?sc.ip.aDa===rb:sc.ip.aDa===Zb){Je=
!0;sc.J8b=!0;Vc.push(sc);this.QQa[jf]=Ke.splice(Sh,Ke.length);break}}!Je&&0<Ke.length&&Ke[0].J8b&&Ke[0].ip.paragraphId.equals(Ge.a.Of(za))&&Vc.push(Ke[0])}return Vc}Ffl(za){if(!za||!za.Qa||!za.Qa.node)return null;za=this.uGc(za.Qa.node.id.toString(),0,0,!0);za=this.BMl(za);za.sort((rb,Zb)=>{if(!(rb&&rb.userName&&Zb&&Zb.userName))return l.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return za}BMl(za){if(!za||!za.length)return[];const rb=[],Zb=new Ek.a(Ya.a.Pj());
for(let yc=0;yc<za.length;yc++){const Vc=za[yc].user;Vc.isAnonymous&&Zb.contains(Vc.clientId)||!Vc.isAnonymous&&Vc.email&&Zb.contains(Vc.email)||(rb.push(Vc),Zb.add(Vc.isAnonymous?Vc.clientId:Vc.email))}return rb}kOf(za,rb,Zb){this.raiseEvent("PPC",new Fl(za,rb,Zb))}Vnn(za,rb){Array.remove(this.Csc[za],rb)}}Zf.zoi=10;Zf.BLm=2;Object(m.a)(Zf,"PresenceDataManager",Sa.a,[1183]);class bl extends Zf{constructor(za){super();this.GD=za}jNe(za,rb=!1){super.jNe(za,rb)}oIc(za){return za.ip.Mc.toString()}lMh(za){za=
this.GD.Eb(Ge.a.Of(za));if(!za)return null;za=za.ia(Tf.a.Mc,0);return this.B_m[za.toString()]}}Object(m.a)(bl,"WordPresenceDataManager",Zf,[]);var gn=d(1446),Vl=d(1017),Zg=d(1788),ni=d(19);class pk{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,sc,mg,Lc,Pj,Vk,th,Wh,jg,Ui,Wl,ef,Wg,uh){this.DIa=Array(5);this.mKe=this._started=this.kFe=!1;this.JBe=null;this.hVg=new Ek.a(Ya.a.Pj());this.fhd={};this.Yte=!1;this.j_m=()=>{if(!this.mKe&&!this.qk.Rx){var Qj=new ta.a(0,1,20,()=>{const zg=new N.a;var qk=this.w8a.yNk;
for(var md in qk){const Pd=qk[md];Pd.OPc&&zg.add(Pd.Xo.ip.paragraphId)}if(this.eVd){qk=this.w8a.Ouh;for(const Pd in qk)md=qk[Pd],md.OPc&&!zg.contains(md.Xo.ip.paragraphId)&&zg.add(md.Xo.ip.paragraphId)}this.xKh(zg);this.mKe=!1},72);this.Hb.$b(Qj);this.mKe=!0}};this.Wvi=()=>{this.kFe&&(this.iVf(),this.kFe=!1)};this.S2=(Qj,zg)=>{this.tVi(zg.kl.kb)};this.R2=(Qj,zg)=>{Qj=zg.VEa;for(var qk in Qj){const md=Qj[qk];this.Ma.$("CashTelemetryIsEnabled")&&this.vEc(md,new Date,null);md.ip?this.bNe(md):this.cXc(md.user.clientId)}zg=
zg.yyd;for(qk=0;qk<zg.length;++qk)this.yRk(zg[qk]);this.F2d()};this.wGf=(Qj,zg)=>{zg.paragraphId?this.Wio(zg.paragraphId.toString(),zg.fpm,this.fhd):l.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.DEi=(Qj,zg)=>{zg.paragraphId&&(Qj=this.fC.Eb(zg.paragraphId))&&((Object(ai.a)(vj,zg.presence)?this.kpe(Qj):this.lpe(Qj))===zg.presence.ip.aDa&&this.DAn(zg.paragraphId),this.eVd&&this.b6m(zg))};this.rv=za;this.hb=yc;this.qC=Vc;this.Xrb=Sd;this.qk=Ke;this.tAj=Je;this.w8a=Sh;this.fC=Zb;this.YEg=sc;
this.kpe=mg;this.lpe=Lc;this.Psj=de;this.xAj=jf;this.zHa=Pj;this.Dm=Vk;this.Hc=th;this.Hb=Wh;this.x1g=ef;this.tQj=uh;this.KBe=Ui;this.Ma=Wl;this.Mgd=rb;pk.Lhd=new Ja.a;for(za=0;za<this.Mgd.length;za++)this.Mgd[za].wkn(this);this.Xrb.o9g(this.DEi);this.rv.UUa(this.R2);Wg&&this.qk.jja(this.j_m);this.rv.R1d(this)}get eVd(){return!!this.Ma&&this.Ma.$("PeoplesWellExtraButtonInfoIsEnabled")}F2d(za=!1){this.x1g&&!za||this.QNi()}QNi(){const za=new N.a,rb=this.fhd;for(const Zb in rb)za.add(Ge.a.Of(Zb));this.xKh(za);
this.fhd={}}iVf(){this.hb.ib&&this.tVi(this.hb.ib.kb,!0)}tVi(za,rb=!1){this.tQj||(this.fC.Im.Bta||rb?za?(rb=this.BKk(za))?this.rv.qVf(rb):(this.rv.qVf(null),l.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",za.Qa.contextId)):this.rv.qVf(null):this.kFe=!0)}BKk(za){if(!this.eVd||!za.igb)if(za=ni.SelectionEditor.ak(za,!0,!1),!ni.SelectionEditor.Km(za))return null;return this.bgh(za)}bgh(za){const rb=za.Qa.cpBegin,Zb=za.Qa.node.id;za=this.kpe(za.Qa.node);return new Mg(Zb.toString(),
rb,za)}vEc(za,rb,Zb){if(this.KBe)if(za&&za.user&&za.user.clientId){var yc=za.user.clientId;this.hVg.contains(yc)||(this.JBe?(this.JBe.vEc(yc,rb,null,pk.mFl(Zb||za.user.client)),this.hVg.add(yc)):this.KBe.continueWith(()=>{this.JBe=this.KBe.result;this.vEc(za,rb,Zb)}))}else l.ULS.sendTraceTag(42262876,302,15,"invalid presence")}CCl(za){const rb=new N.a;for(let Zb=0;Zb<za.length;Zb++)rb.add(this.sMl(za[Zb]));return rb}bNe(za){var rb=null;za&&za.user&&(rb=za.user.client);za=za.clone();za.user=this.qC.vmi(za.user.clientId)||
za.user;this.Ma.$("CashTelemetryIsEnabled")&&this.vEc(za,new Date,rb);za.Qd()&&!za.user.LW()&&(rb=za.user.clientId,pk.Lhd.xb(rb)||this.X0h(rb),this.Jio(rb),za.user.userName=CommonUIStrings.l_AnonymousUserName);this.Xrb.jNe(za,!1)}Jio(za){const {value:rb}=pk.Lhd.Dc(za,!1);rb||(pk.Lhd.Z(za,!0),l.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+za+'" , "Event" : "CreateAnonymousGrayPawn"}'))}X0h(){}cXc(za){this.Xrb.AMi(za)}yRk(za){this.cXc(za);const rb=this.w8a.uRh(za);rb&&(rb.eNi(this.wGf),rb.dispose());
this.eVd&&(za=this.w8a.Ysl(za))&&(za.eNi(this.wGf),za.dispose())}E2b(za){if(12!==za.type)return new N.a;za=this.Xrb.uGc(za.id.toString(),this.kpe(za),this.lpe(za));return 0>=za.length?new N.a:this.CCl(za)}Wio(za,rb,Zb){!rb&&za in Zb&&delete Zb[za]}dispose(){this.stop();this.Xrb.INi(this.DEi);this.rv.QHb(this.R2);this.rv.j6f(this);for(let za=0;za<this.Mgd.length;za++)this.Mgd[za].Rco(this);rd.a.iUf([this.Psj,this.xAj,this.rv]);this.w8a.YVk()}sMl(za){let rb=!1;za=({dce:rb}=this.w8a.ACl(za)).returnValue;
rb||za.d5j(this.wGf);return za}k_h(za){za=this.fC.Eb(za);if(!za)return this.DIa[0]||(l.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.DIa[0]=!0),null;if(!nc.ParagraphReader.oc(za))return this.DIa[1]||(l.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.DIa[1]=!0),null;if(!za.De(this.qk.Tb))return this.DIa[2]||(l.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.DIa[2]=!0),null;if(!za.anchor)return this.DIa[3]||(l.ULS.sendTraceTag(4281423,
302,50,"node is not anchored"),this.DIa[3]=!0),null;this.DIa[4]||(l.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.DIa[4]=!0);return za}eMi(za){za=this.Xrb.uGc(za.toString(),-1,-1,!0);if(!H.a.nf(za))for(const rb of za)(za=this.w8a.uRh(rb.user.clientId))&&za.element&&za.IA()}xKh(za){if(za.count){var rb=new N.a;for(var Zb of za)(za=this.k_h(Zb))?rb.add(za):this.eMi(Zb);if(rb.count){Zb=this.Hc.Rc(2);try{Zb.set(this.Dm);for(const yc of rb)this.jzh(yc)}finally{Zb&&
Zb.dispose()}}}}jzh(za){za.oI(this.qk.Tb,32,!0);za.oI(this.tAj,32,!0)}DAn(za){this.fhd[za.toString()]=null;this.x1g&&!this.Yte&&(za=new ta.a(0,1,200,()=>{this.Yte=!1;this.QNi()},70),this.Hb.$b(za),this.Yte=!0)}b6m(za){if(za.presence.ip.shapeId&&!za.Dnf){var rb=this.w8a.Ouh[za.presence.ip.shapeId.toString()];rb&&rb.w1a(za.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.hb.ega(this.S2),this.YEg.BNi(this.Wvi))}start(){if(!this._started){this._started=!0;this.hb.OD(this.S2);this.YEg.ZNe(this.Wvi);
var za=this.rv.gzb();delete za[this.zHa.clientId];this.R2(null,new Zg.a(za,[]));this.iVf()}}y7d(za){if(za&&za.Qd()&&za.ip){var rb=this.Xrb.uGc(za.ip.paragraphId.toString(),-1,-1),Zb=!1,yc=null;for(let Vc=0;Vc<rb.length;Vc++)if(yc=rb[Vc],yc.user.clientId===za.user.clientId){Zb=yc.oPa=!0;break}if(Zb)if(rb=yc.ip.paragraphId,za=this.k_h(rb)){rb=this.Hc.Rc(2);try{rb.Db(za),this.jzh(za)}finally{rb&&rb.dispose()}}else this.eMi(rb)}}static mFl(za){return za?za?1===za?1:2===za?2:0:2:0}}pk.Lhd=null;Object(m.a)(pk,
"PresenceManager",null,[1178,10,663,1179,1180,1181]);class Nj{constructor(za,rb,Zb,yc){this.vOb=null;this._started=this.vse=!1;this.Wtb=null;this.Cma=(Vc,Sd)=>{if(!v.AFrameworkApplication.Dk&&(Vc=this.Ffj(Sd.kl),this.vOb&&Vc)){Vc=this.cle.uGc(this.vOb.toString(),-1,-1,!0);for(Sd=0;Sd<Vc.length;Sd++)this.Wtb[Vc[Sd].user.clientId]=Vc[Sd];0>=Vc.length||(Vc=this.qHk(Vc),this.xp.sendNotification(Vc,!0))}};this.Gxi=(Vc,Sd)=>{this.hb.ib&&!v.AFrameworkApplication.Dk&&this.vse&&this.vOb&&this.vOb.equals(Sd.paragraphId)&&
(Vc=null,!Sd.Dnf||Sd.presence.user.clientId in this.Wtb?Sd.Dnf||(Vc=this.kth(Sd.presence.user.userName,!1),delete this.Wtb[Sd.presence.user.clientId]):(Vc=this.kth(Sd.presence.user.userName,!0),this.Wtb[Sd.presence.user.clientId]=Sd.presence),Vc&&this.xp.sendNotification(Vc,!0))};this.ij=yc;this.hb=rb;this.cle=za;this.xp=Zb;this.ij.R1d(this)}start(){this._started||(this._started=!0,this.Wtb={},this.cle.o9g(this.Gxi),this.hb.OD(this.Cma),this.Ffj(this.hb.ib))}stop(){this._started&&(this._started=!1,
this.Wtb=null,this.cle.INi(this.Gxi),this.hb.ega(this.Cma))}qHk(za){if(1===za.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,za[0].user.userName);const rb=[],Zb=za.length;for(let yc=0;yc<Zb;yc++)rb.push(za[yc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,rb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}kth(za,rb){return String.format(rb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,
za)}dispose(){this.ij.j6f(this);this.stop()}Ffj(za){if(!za)return!1;za=za.kb;if(!za)return!1;za=za.Qa;if(!za)return!1;this.vse=ni.SelectionEditor.xf(za);za=za.node.id;if(za.equals(this.vOb)||!this.vse)return!1;this.vOb=za;this.Wtb={};return!0}}Object(m.a)(Nj,"PresenceAccessibilityManager",null,[10,663]);class Uk{constructor(za,rb){this._started=!1;this.kJ=null;this.icd=!1;this.GSc=()=>{this._started&&this.eVi()};this.ij=za;rb&&(this.kJ=rb,this.kJ.QUa(this.GSc));this.ij.R1d(this)}start(){this._started||
(this._started=!0,this.kJ?this.eVi():this.ij.kO(1,this.Vrh()))}eVi(){const za=this.icd;(this.icd=!!this.kJ.Ly)&&!za&&this.ij.kO(1,this.Vrh())}Vrh(){const za={};za.Id="{"+v.AFrameworkApplication.userSessionId.toUpperCase()+"}";za.HQ=!1;za.NT=1;za.WEB=!0;return za}stop(){this._started&&(this._started=this.icd=!1)}dispose(){this.ij.j6f(this);this.kJ&&this.kJ.gNi(this.GSc)}}Object(m.a)(Uk,"EditorsTableNotifier",null,[10,663]);var gg=d(389),le=d(18);class Od extends pk{constructor(za,rb,Zb,yc,Vc,Sd,de,
jf,Ke,Je,Sh,sc,mg,Lc,Pj,Vk,th,Wh,jg,Ui,Wl,ef,Wg,uh,Qj,zg,qk,md,Pd,Kd){super(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,mg,Lc,Pj,Vk,jg,Ui,Wl,ef,Wg,uh,Qj,zg,Pd);this.Yj=null;this.sZk=Cd=>{const hn=!!this.Yj.OA.L1b(Cd);l.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Cd,hn)};this.rZk=(Cd,hn)=>{l.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",hn,Cd)};sc.gb(le.a.ZVn,db.a.application,Od.G2j,64);sc.gb(le.a.OQf,db.a.application,Od.OQf,64);
sc.gb(le.a.JNf,db.a.application,Od.JNf,96);sc.gb(Wb.a.y7d,db.a.application,Od.YVn,64);this.DH=th;this.qd=Wh;this.kub=qk;this.zHa.Aac=md;this.zHa.Aac.i7j(Od.Hxi);Kd.continueWith(()=>{this.Yj=Kd.result});l.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}KAa(za){if(!za||!za.anchor)return null;for(za=za.anchor.Gp;za;za=za.Oz)if(za.QBa)return za.vr.node;return null}bgh(za){var rb=null;rb=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var Zb=za.Qa.cpBegin,yc=za.Qa.node;
rb&&rf.ImageReader.qw(yc)&&(yc=this.KAa(yc));if(!yc)return l.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;yc=this.lpe(yc);const Vc=za.Qa.node.ia(Tf.a.Mc,0);if(!this.DH)return l.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Sd=this.DH.value.udb(Vc);const de=Od.GD.Eb(Sd);if(!de)return l.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Sd),null;Zb=this.qd.yhc(this.qd.NNa(de.characterData,de.qa),Zb);Zb.hza=-1===za.Qa.Fb?0:za.Qa.Fb;Sd=0;rb&&za.igb&&(Sd=
this.WGl(za));return rb=new Rf(this.DH.value,Vc,yc,Zb,this.qd,()=>Od.GD,this.kub,Sd)}WGl(za){const rb=rf.ImageReader.DAa(za.Qa);return rb?rb.properties.ia(Tf.a.dyb,0):za.Qa.node.properties.ia(Tf.a.dyb,0)}X0h(za){this.Yj&&this.Yj.nka&&this.Yj.nka.bE(this.sZk,this.rZk,za)}static get fw(){return ea.a.instance.resolve("Common.Utils.IAriaNotifier")}static iI(){return Od.Hoc.task}static get_instance(){return Od.Khd.task}static HCl(){return Od.KUg.task}static get LOa(){return null!=Od.tog?Od.tog:Od.tog=
ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Od.Khd||(Od.Khd=new r.a);Od.pDg&&(l.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Od.pDg=!1);if(Oa.App.xa){var za=Oa.App.xa.jb;za?(za.Zca(Od.pSc),Od.Hrb=za.Jc,Od.Hrb&&Od.Hrb.Ji?(Od.OM=za.Zc.contentReplicator,Od.OM?(Od.GD=za.Zc.Ad,Od.GD?Od.LOa.iI().continueWith(Od.MUm):l.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):l.ULS.sendTraceTag(4252228,
302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):l.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):l.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else l.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static MUm(){Od.ij=
Od.LOa.iI().result;if(Od.ij){var za=[Od.Hrb.rTc,Od.Hrb.editingView.rTc],rb=Fb.a.instance,Zb=ea.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),yc=new Nj(Zb,rb,Od.fw,Od.ij),Vc=v.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Oa.App.rd.OA:null;Vc=new Uk(Od.ij,Vc);var Sd=ea.a.instance.Ye("WordEditor.IParagraphWordIdMapping"),de=ea.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),jf=ea.a.instance.resolve("Common.IPeopleInfoProvider");
Od._instance=new Od(Od.ij,za,Od.GD,rb,jf,Zb,yc,Vc,Od.Hrb,Od.Hrb.editingView.Tb,ea.a.instance.resolve("Box4.Presence.PresenceControlProvider"),v.AFrameworkApplication.ya,Od.OM,nc.ParagraphReader.textLength,nc.ParagraphReader.oka,ea.a.instance.resolve("Box4.Presence.MyPresenceUser"),Sd,de,Oa.App.Wj.al,new gg.a,zb.a.instance,gn.a.get_instance(),da.a.Iq(ea.a.instance.Za("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),v.AFrameworkApplication.K,v.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
v.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),ea.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),ea.a.instance.resolve("Common.IPresenceStatusProvider"),!Oa.App.vs&&!Oa.App.fn,Oa.App.jla());l.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Od.Khd.Gg(Od._instance);Od.Hoc.Gg(Od._instance);Od.KUg.Gg(Od._instance);za=ea.a.instance;za.ha("WordEditor.Presence.WordPresenceManager",()=>Od._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
za.resolve("WordEditor.Presence.WordPresenceManager")}else l.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static pSc(za){Od._instance||(l.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(za=Object(w.a)(11,za))&&za.fjb(Od.pSc),Od.init())}static Hxi(){Od._instance.iVf()}static G2j(za,rb,Zb,yc,Vc){Zb=Vc.split(",");if(!Zb||3!==Zb.length)return 8;za=Zb[0].trim();rb=Zb[1].trim();Zb=
Number.parseInvariant(Zb[2].trim());za=new vj(new Ea(za),new Mg(rb,Zb,-1));if(!Od.Hoc.task.isCompleted)return 8;rb=Od.iI().result;rb.bNe(za);rb.F2d();return 32}static OQf(za,rb,Zb,yc,Vc){if(!Od.Hoc.task.isCompleted)return 8;za=Od.iI().result;za.cXc(Vc);za.F2d();return 32}static YVn(za,rb,Zb,yc,Vc){if(!Od.Hoc.task.isCompleted)return 8;za=Od.iI().result;if(!za)return 8;za.y7d(Vc);return 32}static JNf(za,rb,Zb,yc,Vc){if(1===Zb)return 32;if(!Od.LOa.iI().isCompleted)return 8;za=Od.LOa.iI().result;if(!za)return l.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;Vc[Vl.a.Value]=2===za.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===za.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}Od._instance=null;Od.pDg=!0;Od.Khd=new r.a;Od.Hoc=new r.a;Od.KUg=new r.a;Od.GD=null;Od.Hrb=null;Od.OM=null;Od.ij=null;Object(m.a)(Od,"WordPresenceManager",pk,[]);class pg{constructor(za){this.sa=new Sa.a;this.hY=za;this.hY.CWR(()=>this.hY.result.f5j(()=>{this.sa.raiseEvent("X")}))}i7j(za){this.sa.addHandler("X",
za)}fqn(za){this.sa.removeHandler("X",za)}getStatus(){return this.hY.isCompleted&&this.hY.result?this.hY.result.xCc.toString():"0"}}Object(m.a)(pg,"WordPresenceStatusProvider",null,[705]);class Oi{constructor(za,rb,Zb,yc){this.ij=null;this.hDg=this.$we=!1;this.NUm=()=>{this.Dca.isCompleted&&this.Dca.result?(this.ij=this.Dca.result,this.ij.UUa(this.R2),l.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):l.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.R2=(Vc,Sd)=>{Vc=Sd.VEa;for(const de in Vc)if(Sd=Vc[de],!this.$we&&Sd.user.pQ&&Sd.user.pQ!==this.t8.pQ){l.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.t8.pQ,Sd.user.pQ);this.$we=!0;break}this.$we&&this.ij.QHb(this.R2);this.hDg||(l.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.hDg=!0)};this.Yj=za;this.t8=rb;this.Dca=Zb;Zb.continueWith(this.NUm);this.qLj=yc;this.qLj.Hvf=this.t8}}Object(m.a)(Oi,"WordPresenceUpdateMonitor",
null,[]);var aj=d(444),Lj=d(1498),yd=d(216),dg=d(1790),Nb=d(1791);class Ii{constructor(za,rb,Zb,yc,Vc,Sd,de){this.sa=new Sa.a;this.yJg=this.tLg=this.cve=this.ZNg=!1;this.rKe=this.Snd=0;this.wVb=null;this.zHa=Sd;this.zHa.clientId=za.clientId;this.Mq=za;this.W7=rb;this.MO=yc;this.tCj=Vc;this.Hb=Zb;this.Q5a=new yd.a;this.Pm=de;this.W7&&this.W7.continueWith(()=>{this.W7.ho||this.W7.Ii||this.W7.result.i8g(Object(f.a)(this,this.eui,"onAmIAloneChanged"))})}get connectionState(){return this.Mq.connectionState}UUa(za){this.sa.addHandler("PU",
za)}QHb(za){this.sa.removeHandler("PU",za)}xya(za){this.sa.addHandler("CSC",za)}gXc(za){this.sa.removeHandler("CSC",za)}lqd(za){this.sa.addHandler("PSU",za)}A2d(za){this.sa.removeHandler("PSU",za)}kqd(za){this.sa.addHandler("PSC",za)}z2d(za){this.sa.removeHandler("PSC",za)}pVi(){}get clientId(){return this.Mq.clientId}j1(za){this.sa.addHandler("UN",za)}RHb(za){this.sa.removeHandler("UN",za)}g0l(){this.wVb=Array(12);for(let za=0;12>za;za++)this.wVb[za]=0;this.tLg=this.Pm?this.Pm.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;v.AFrameworkApplication.rK(()=>{this.kAm()})}init(){this.Mq.xya(Object(f.a)(this,this.zfa,"onConnectionStateChanged"));this.Mq.UUa(Object(f.a)(this,this.R2,"onPresenceUpdated"));this.Mq.lqd(Object(f.a)(this,this.TFb,"onPersistentStateUpdated"));this.Mq.kqd(Object(f.a)(this,this.h$b,"onPersistentStateCleared"));this.Mq.j1(Object(f.a)(this,this.taa,"onUpdateNotificationReceived"));this.Boh();this.g0l()}R1d(za){this.Q5a.contains(za,(rb,Zb)=>rb===Zb)||(this.Q5a.add(za),2===this.connectionState&&za.start())}j6f(za){for(let rb=
0;rb<this.Q5a.length;rb++)if(this.Q5a.J(rb)===za){this.Q5a.eF(rb);break}}connect(){this.cve||this.Mq.connect()}disconnect(){this.Mq.disconnect()}get P3d(){return this.Mq}ixh(za){return vj.Rwb(za)}EVf(za,rb){return(new vj(za,rb)).fgf()}qVf(za){za&&za.Qd()&&!this.MO()?this.Mq.pVi(this.EVf(this.zHa.Nxl(),za)):G.Task.W9(null)}VYc(za,rb){return this.Mq.VYc(za,rb)}I$e(za){return this.Mq.I$e(za)}wGc(){return this.Mq.wGc()}kO(za,rb,Zb=!1){return this.Mq.kO(za,rb,Zb)}gzb(){return this.Mrh(this.Mq.gzb())}vLb(){return G.Task.W9(null)}get $Ma(){return this.Mq.$Ma}zfa(za,
rb){2===rb.newState&&this.Q5a.forEach(Zb=>{Zb.start();return!0});rb.newState||this.Pm.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.cve||this.Q5a.forEach(Zb=>{Zb.stop();return!0});this.sa.raiseEvent("CSC",rb)}q8e(za){return za.toLowerCase()}R2(za,rb){if(!this.MO()){za=this.Mrh(rb.VEa);rb=this.Orh(rb.yyd);var Zb=new Zg.a(za,rb);rb=new ta.a(0,1,0,()=>{this.sa.raiseEvent("PU",Zb)},57);this.Hb.$b(rb)}}Mrh(za){const rb={};for(const yc in za){var Zb=yc;const Vc=this.ixh(za[yc]);Vc&&Vc.Qd()?rb[this.q8e(Zb)]=
Vc:l.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Zb)}return rb}Orh(za){const rb=Array(za.length);for(let Zb=0;Zb<za.length;Zb++)rb[Zb]=this.q8e(za[Zb]);return rb}TFb(za,rb){if(!this.MO()){var Zb={};za=rb.VEa;for(var yc in za)Zb[this.q8e(yc)]=za[yc];yc=new ta.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new dg.a(rb.type,Zb))},80);this.Hb.$b(yc)}}h$b(za,rb){if(!this.MO()){za=this.Orh(rb.$td);var Zb=new Nb.a(za);za=new ta.a(0,1,0,()=>{this.sa.raiseEvent("PSC",Zb)},81);this.Hb.$b(za)}}taa(za,rb){this.tLg?
this.xzi(rb):(za=new ta.a(0,1,0,()=>{this.xzi(rb)},58),this.Hb.$b(za))}xzi(za){var rb=Date.now();this.sa.raiseEvent("UN",za);rb=Date.now()-rb;500<=rb&&(this.Snd++,l.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",za.type,rb),this.E8k(za));this.rKe++}E8k(za){0>za.type||21<=za.type?l.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",za.type):this.wVb[za.type]++}kAm(){if(!this.yJg){var za=
{};za.TC=this.rKe;za.HRC=this.Snd;this.wVb&&0<this.Snd&&(za.TBC=this.wVb);this.Snd=this.rKe=0;this.wVb=null;l.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",za);this.yJg=!0}}dispose(){this.Q5a=new yd.a;this.Mq.gXc(Object(f.a)(this,this.zfa,"onConnectionStateChanged"));this.Mq.QHb(Object(f.a)(this,this.R2,"onPresenceUpdated"));this.Mq.A2d(Object(f.a)(this,this.TFb,"onPersistentStateUpdated"));this.Mq.z2d(Object(f.a)(this,this.h$b,"onPersistentStateCleared"));this.Mq.RHb(Object(f.a)(this,
this.taa,"onUpdateNotificationReceived"));this.W7&&this.W7.continueWith(()=>{this.W7.ho||this.W7.Ii||this.W7.result.cpn(Object(f.a)(this,this.eui,"onAmIAloneChanged"))});this.Mq.disconnect();l.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}eui(){this.Boh()}Boh(){let za=!1;this.W7?this.W7.continueWith(()=>{this.W7.ho||this.W7.Ii||(za=!this.W7.result.amIAlone);this.Mq.connectionState||!za&&!this.tCj()?2!==this.Mq.connectionState||za||(this.disconnect(),l.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),l.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.ZNg&&za&&(l.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.ZNg=!0)}):(this.connect(),l.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}uDc(){this.cve=!0;this.disconnect();l.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(m.a)(Ii,
"RtcProxy",null,[1165,10,850,1166]);class Ie extends Ii{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,sc,mg){super(za,rb,Zb,yc,Vc,Sd,mg);this.U8=null;this.DH=de;this.qd=jf;this.EHa=Ke;this.qsc=Je;this.aHe=Sh;this.kub=sc}get MI(){return this.U8||(this.U8=this.aHe())}zfa(za,rb){2===rb.newState&&l.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.kjo();super.zfa(za,rb)}kjo(){this.MI&&this.MI.FQ("RtcConnectionStatusLabel")}ixh(za){return pd.tZe(Xc(za),this.DH,this.qd,this.EHa,this.kub)}EVf(za,rb){return Object(ai.a)(Rf,
rb)?(za=new pd(this.qsc.mTh(),za,rb),xe(za.fgf())):super.EVf(za,rb)}}Object(m.a)(Ie,"WordRtcProxy",Ii,[]);class $g{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,sc,mg){this.er=new r.a;this.XZg=!0;this.le=rb;this.Hb=Zb;this.MO=yc;this.zHa=Vc;this.DH=Sd;this.Iqa=de;this.EHa=jf;this.qsc=Ke;this.aHe=Je;this.lqa=Sh;this.kub=sc;this.Ma=mg}iI(){this.f$n();return this.er.task}MHc(){return aj.a.then(this.iI(),za=>za)}f$n(){if(this.XZg)if(this.XZg=!1,Oa.App.esf()&&Oa.App.fqf()){var za=v.AFrameworkApplication.Ze;
if(za){za=Lj.RealtimeChannel.createInstance("{"+v.AFrameworkApplication.userSessionId+"}",v.AFrameworkApplication.userSessionId,v.AFrameworkApplication.fSi,za,this.lqa,1,this.le,this.Ma.lb("RtcEndpointUrl"),void 0,void 0,null,this.Ma.$("FindSessionOnBootIsEnabled")?ea.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ma.lb("RtcBootToken"));var rb=this.Ma.$("RtcAlwaysOnEnabled"),Zb=new Ie(za,rb?null:Oa.App.jla(),this.Hb,this.MO,$g.cbl,this.zHa,this.DH,this.Iqa,this.EHa,this.qsc,this.aHe,this.kub,
v.AFrameworkApplication.K);Oa.App.rLn(Zb);this.okn(Zb);Zb.init();El.App.O1a=Zb;this.lqa.execute(yc=>{yc.i$a(()=>{Zb.uDc()})});this.er.Gg(Zb)}else l.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else l.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}okn(za){const rb=ea.a.instance;rb.ha("WordEditor.Presence.WordRtcProxy",()=>za).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();
rb.resolve("Common.IRealtimeChannelBasic")}static cbl(){return!1}}Object(m.a)($g,"WordRtcProxyProvider",null,[690,691]);class fh{constructor(){this.W=null;this.Bl=!1}get name(){return"WordEditor.Presence"}init(){l.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Oa.App.rkj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").iI(),Od.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Oa.App.qBc&&qd.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");
if(fh.lJg){const za=this.W.resolve("WordEditor.IMainViewModeManager");za.Qub(this.BHf);fh.Bte=1===za.Hx}}dispose(){if(!this.Bl){this.Bl=!0;Od.iI().continueWith(()=>{rd.a.LA(Od.iI().result)});var za=this.W.resolve("Box4.Presence.MyPresenceUser");za&&za.Aac&&za.Aac.fqn(Od.Hxi)}}zc(za){this.W=za;this.W.ha("Box4.Presence.MyPresenceUser",()=>new Ia).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();za.ha("WordEditor.Presence.IWordPresenceCpFactory",
()=>new tl(za.resolve("Box4.CpConversionManagerImpl"),za.resolve("Box4.IContentControlReader"))).singleInstance();za.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Oi(new L.a(()=>Oa.App.rd),ye.a.instance,za.resolve("WordEditor.Presence.WordRtcProxyProvider").MHc(),za.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();za.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new $g(v.AFrameworkApplication.buildVersion,Oa.App.xa.iq,zb.a.instance,()=>v.AFrameworkApplication.Dk,ea.a.instance.resolve("Box4.Presence.IMyPresenceUser"),
ea.a.instance.Pa("WordEditor.ParagraphWordIdMapping"),ea.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>v.AFrameworkApplication.ua&&Oa.App.xa.jb&&Oa.App.xa.jb.Zc?Oa.App.xa.jb.Zc.Ad:null,ci.instance,()=>ea.a.instance.Pa("WordEditor.IStatusBarUser"),ea.a.instance.Za("Common.ISessionExpirationManager"),ea.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");
za.ha("Box4.Presence.PresenceControlProvider",()=>new sl(fh.oMk(),Ld.a.instance,ea.a.instance.Za("Common.IZoomManager"),ea.a.instance.resolve("Box4.ICoauthCashTelemetry"),da.a.Iq(ea.a.instance.Za("Common.ISystemInitiatedFeedbackWithTimeLapse")),v.AFrameworkApplication.K,za.resolve("Common.IPeopleInfoProvider"))).singleInstance();za.ha("Common.App.Presence.AwayManager",()=>new Gf(ea.a.instance.resolve("Common.IPresenceUser"),ea.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").MHc(),Od.HCl(),
ea.a.instance.resolve("Common.IPresenceConverter"),zb.a.instance,v.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:v.AFrameworkApplication.K.rc("AwayCoauthorThresholdMs",9E5),Object(f.a)(v.AFrameworkApplication.ya,v.AFrameworkApplication.ya.processAction,"processAction"),Oa.App.xa.notificationBar,v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();za.ha("WordEditor.Presence.WordPresenceStatusProvider",()=>new pg(da.a.Iq(ea.a.instance.Za("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();
za.ha("Common.App.Presence.PeopleInfoProvider",()=>new Aa(za.resolve("WordEditor.Presence.WordRtcProxyProvider").MHc(),Oa.App.jla().CWR(()=>Oa.App.jla().result.OA),za.resolve("Common.App.People.IPeopleColorUtils"),za.resolve("Common.IPresenceConverter"),da.a.Iq(za.Za("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();za.ha("Box4.Presence.WordPresenceDataManager",()=>new bl(Oa.App.xa.jb.Zc.Ad)).as("Box4.IPresenceDataManager").singleInstance()}BHf(za,rb){Oa.App.xa&&
Oa.App.xa.eC&&(fh.Igd=null,fh.Bte=1===rb.t9b)}static get tAi(){if(!fh.Igd&&Oa.App.xa&&Oa.App.xa.eC){const za=El.App.fm.eC;fh.Igd=fh.Bte&&fh.lJg?za.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:za.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return fh.Igd}static oMk(){const za=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),rb=v.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),Zb=v.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),
yc=new $b;yc.add(Wa.multipleBrowsersImageClassName,uf.getImageClassWithCluster(v.AFrameworkApplication.bQ,"MoreUsersGlyph16"));yc.add(Wa.multipleBrowserImageClusterPath,v.AFrameworkApplication.mr);yc.add(Wa.peopleImageClassName,uf.getImageClassWithCluster(v.AFrameworkApplication.bQ,za?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));yc.add(Wa.peopleImageClusterPath,v.AFrameworkApplication.mr);yc.add(Wa.zIndex,1);yc.add(Wa.rtl,v.AFrameworkApplication.isRtl);yc.add(Wa.viewportBoundsCallback,
fh.bNl);yc.add(Wa.ignoreEventOnExpandedTooltip,rb);yc.add(Wa.ipWidthAdjustForFlyout,Zb);return za?new qf(yc):new Ff(yc)}static bNl(){return fh.tAi?Ye.a.getElementBounds(fh.tAi):null}}fh.Bte=!0;fh.lJg=v.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");fh.Igd=null;Object(m.a)(fh,"WordPresencePackage",null,[1,2]);var Pi=d(996),jk=d(1373),Cf=d(1002),im=d(127);class ch{constructor(za,rb){this.cNe=za;this.paragraphId=rb}get opType(){return 2}get operation(){return this.cNe}}Object(m.a)(ch,
"RttAppliedAddParagraphOp",null,[692]);class Oj{constructor(za,rb){this.psn=za;this.paragraphId=rb}get opType(){return 6}get operation(){return this.psn}}Object(m.a)(Oj,"RttAppliedReplaceSymbolRangeOp",null,[692]);class Kg{constructor(za,rb){this.tsn=za;this.paragraphId=rb}get opType(){return 1}get operation(){return this.tsn}}Object(m.a)(Kg,"RttAppliedReplaceTextRangeOp",null,[692]);class ul{constructor(za,rb,Zb){this.C5i=za;this.c8d=rb;this.pCc=Zb}get opType(){return 4}get operation(){return this.C5i}get hZj(){return this.C5i.FZb()?
this.pCc:this.c8d}}Object(m.a)(ul,"RttAppliedSplitParagraphOp",null,[692]);class vl{constructor(){this.P4a=new Ja.a}Gtf(za){return za.toString()}txc(za,rb){za=this.Gtf(za);this.P4a.xb(za)||this.P4a.Z(za,new N.a);this.P4a.J(za).add(rb)}gGf(za){switch(za.opType){case 1:var rb=Object(w.a)(Kg,za);this.txc(rb.paragraphId,za);break;case 6:rb=Object(w.a)(Oj,za);this.txc(rb.paragraphId,za);break;case 4:rb=Object(w.a)(ul,za);this.txc(rb.c8d,za);this.txc(rb.pCc,za);break;case 2:rb=Object(w.a)(ch,za),this.txc(rb.paragraphId,
za)}}SQm(za){return this.Khb(za)}Khb(za){za=this.Gtf(za);if(!this.P4a.xb(za))return new N.a;const rb=this.P4a.J(za);this.P4a.remove(za);for(let Zb of rb)Zb.operation&&(Zb.operation.n5=null);return rb}Azl(za){let rb;return({value:rb}=this.P4a.Dc(this.Gtf(za),rb)).returnValue?rb:new N.a}Nel(za){for(let rb of this.P4a.values){if(!rb.count)continue;if(2!==rb.J(0).opType)continue;const Zb=rb.J(0);if(Zb.cNe.kCf===za)return Zb}return null}}Object(m.a)(vl,"RttAppliedOpTracker",null,[672]);var am=d(229),Ug;
(function(za){za[za.C3k=0]="expired";za[za.qAo=1]="dried"})(Ug||(Ug={}));Object(m.b)("RemoveChangeReason",Ug);class xh{constructor(){this.Yva=new am.a}Q_j(za){if(!za)return l.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const rb=za.Mc,Zb=za.mj;this.Yva.xb(rb)||this.Yva.add(rb,new am.a);this.Yva.J(rb).Z(Zb,za);return this.gOk(rb,Zb)?(l.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",rb),this.Yva.J(rb).remove(Zb),
!1):!0}sef(za,rb){if(!this.Yva.xb(za))return null;za=this.Yva.J(za);return za.xb(rb)?za.J(rb):null}WFd(za){const rb=new N.a;for(let Zb of this.Yva.keys){const yc=this.Yva.J(Zb);for(let Vc of yc.keys){const Sd=yc.J(Vc);za(Sd)&&rb.add(Sd)}}return rb}sMi(za,rb){let Zb=null;({value:Zb}=this.Yva.Dc(za.Mc,Zb)).returnValue?(za.activity.nEf(Ug[rb]),Zb.remove(za.mj),Zb.count||this.Yva.remove(za.Mc)):l.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
za.Mc,rb)}wQf(za){this.sMi(za,1)}zQf(za){this.sMi(za,0)}gOk(za,rb){if(!this.Yva.xb(za))return!1;za=this.Yva.J(za);if(!za.xb(rb))return!1;for(var Zb=za.J(rb);Zb;){Zb=Zb.y_;if(Zb===rb)return!0;if(!za.xb(Zb))break;Zb=za.J(Zb)}return!1}}Object(m.a)(xh,"RttDataStore",null,[670,671]);var Ed=d(298),bm=d(64),In=d(292),nf=d(17);class Ph{constructor(za,rb){this.dWd=(Zb,yc)=>{4===this.Rp.opType?l.ULS.shipAssertTag(9204866,355,12===yc.node.type||11===yc.node.type,"Unexpected graph modification detected during RTT edit"):
l.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Khb=()=>{l.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.Xvi=()=>{l.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Rp=za;if(this.No=rb)za=this.No.Te(12),za.rs(this.dWd),za.xv(this.Khb),za.jp(this.Xvi)}dispose(){if(this.No){const za=this.No.Te(12);za.dM(this.dWd);za.Iaa(this.Khb);za.wX(this.Xvi)}}}Object(m.a)(Ph,
"GraphChangeValidator",null,[10]);class um{constructor(za,rb,Zb,yc){this.id=za;this.cpBegin=rb;this.cpEnd=Zb;this.urk=yc}Ymo(za){var rb=this.id===za.id;rb&&(rb=this.urk.replace("\u00a0"," "),za=za.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),rb=rb===za);return rb}}Object(m.a)(um,"RttOpValidator",null,[721]);class Kc{constructor(za,rb){this.n5=this.U3a=this.activity=null;this.opType=za;this.metadata=rb}$gf(){return""}serialize(){return null}}Object(m.a)(Kc,"RttOp",
null,[687]);class dk extends Kc{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){super(Ke,jf);this.Mc=za;this.mj=rb;this.yQ=Zb;this.N2=yc;this.y_=Vc;this.ilb=Sd;this.IG=de}Ith(){return this.yQ.isEqual(this.N2,!0)?new ke.a(0,this.Mc,this.mj,this.yQ,void 0,void 0,void 0,this.IG):new ke.a(1,this.Mc,this.mj,this.yQ,this.Mc,this.mj,this.N2,this.IG)}static Gbj(za){let rb,Zb;var yc=za.lS;if(1===yc.u1d&&(yc.LNa!==yc.VCa||yc.g3a!==yc.Afc))return l.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
Zb=rb=null,za=yc=-1,{returnValue:!1,yQ:Zb,N2:rb,Mc:za,mj:yc};if(yc.IG)return Zb=rb=null,za=yc=-1,{returnValue:!1,yQ:Zb,N2:rb,Mc:za,mj:yc};rb=Zb=yc.yQ;1===yc.u1d&&(rb=yc.N2);za=yc.LNa;yc=yc.g3a;return{returnValue:!0,yQ:Zb,N2:rb,Mc:za,mj:yc}}}Object(m.a)(dk,"RttReplaceRangeOp",Kc,[]);var oi=d(1371),Bd=d(404),uk=d(581);class cl extends uk.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Wl(){return 110}static A9(za,rb){const Zb=new cl;Zb.FileId=za;Zb.RttStatusRecords=rb;return Zb}}Object(m.a)(cl,
"RttStatusRequest",uk.a,[]);class qe{}Object(m.a)(qe,"RttStatusOp",null,[]);class Wf{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(m.a)(Wf,"WireRttStatusOpRecord",null,[]);class dl extends Bd.a{constructor(){super();const {App:za}=d(158);this.KTb=new N.a;this.pEe=new N.a;this.Vj=new oi.a(v.AFrameworkApplication.K.rc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;za.z_.register(this)}mqj(){const za=Date.now();for(let rb of this.KTb)rb.$Fb&&1===rb.$Fb&&(rb.$Fb=2,rb.timeToRender=za-rb.metadata.X3f)}qde(za){const rb=new qe;rb.metadata=za.operation.metadata;rb.opType=za.opType;rb.$Fb=1;this.KTb.add(rb)}get tma(){return"RttStatusReplicator"}f2(){return this.he&&2===this.he.status?!0:1===this.enabled&&this.Vj.zW()?this.DB():!1}DB(){for(let za of this.KTb)if(za.$Fb&&2===za.$Fb)return!0;return!1}wOa(){if(1===this._state){this._state=3;const rb=this.KTb.toArray().filter(Zb=>
2===Zb.$Fb);var za=this.QGk(rb);za=cl.A9(v.AFrameworkApplication.rootQuerySignature,za);rb.forEach(Zb=>this.KTb.remove(Zb));rb.forEach(Zb=>this.pEe.add(Zb));this.he.Vr=za;this.he.WG="RttStatusRequest";this.he.status=1}else 3===this._state&&this.he&&2===this.he.status&&(this.Vj.O_(),2!==this.he.statusCode&&this.KTb.uA(0,this.pEe),this.pEe.clear(),this._state=1)}QGk(za){const rb=[];za.forEach(Zb=>{const yc=new Wf;yc.clientId=Zb.metadata.clientId;yc.clientType=Zb.metadata.clientType;yc.packetId=Zb.metadata.packetId;
yc.packetVersion=Zb.metadata.packetVersion;yc.strictlySequentialId=Zb.metadata.strictlySequentialId;yc.contentType=Zb.opType;yc.contentState=Zb.$Fb;yc.timeToRender=Zb.timeToRender;rb.push(yc)});return rb}Sdc(){return!0}bE(){}forceOutbound(){}}Object(m.a)(dl,"RttStatusReplicator",Bd.a,[]);class Ne{constructor(za,rb,Zb,yc,Vc,Sd){this.packetId=za;this.clientId=rb;this.clientType=Zb;this.X3f=yc;this.packetVersion=Vc;this.strictlySequentialId=Sd}static create(za){let rb=null;null!=za.strictlySequentialId&&
(rb=za.strictlySequentialId);return new Ne(za.packetId,za.clientId,za.client,Date.now(),za.version,rb)}}Object(m.a)(Ne,"RttOpMetadata",null,[]);class rj extends Kc{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke){super(4,Ke);this.y_=0;this.Mc=za;this.mj=rb;this.offset=Zb;this.IG=yc;this.R9f=Vc;this.G3f=Sd;this.Sce=de;this.H3f=jf;this.R9f===this.Mc?this.y_=this.G3f:this.Sce===this.Mc?this.y_=this.H3f:(l.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.y_=0)}FZb(){return this.Mc===
this.Sce}get q5n(){return this.y_}get iqo(){return this.FZb()?this.R9f:this.Sce}get y9i(){return this.FZb()?this.G3f:this.H3f}serialize(){const za=new ke.a(3,this.Mc,this.mj,this.offset,null,null,null,this.IG),rb=new kc(this.R9f,this.G3f,this.Sce,this.H3f);return new Ob(this.metadata.packetId,this.metadata.clientId,1,4,za,null,void 0,void 0,void 0,void 0,rb,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){const rb=za.lS,Zb=za.gKb;return new rj(rb.LNa,rb.g3a,rb.yQ,rb.IG,Zb.FIf,Zb.F3f,
Zb.GIf,Zb.I3f,Ne.create(za))}static vFl(za,rb,Zb){if(1!==za.type)return null;const yc=Zb.NNa(za.O2.characterData,za.O2.qa);return new rj(za.O2.Mc,za.O2.mj,Zb.yhc(yc,za.o5i),za.IG,za.oub.Mc,za.oub.mj,za.Myc.Mc,za.Myc.mj,rb)}}Object(m.a)(rj,"RttSplitParagraphOp",Kc,[667,687]);class vk{constructor(za,rb,Zb,yc){this.$Mm=()=>{this.Isb.mqj()};this.Aha=za;this.Jrc=rb;this.dia=Zb;this.vtb=yc;null!=v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.Isb=new dl,Ed.GraphTransactionManager.instance.h8g(this.$Mm))}Wbk(za,rb,Zb,yc=null){if(rb.isDirty)return yc&&yc.properties.Z(vk.DBi,"1"),!1;const Vc=new Ph(za,rb.Ti);try{if(1===za.opType||6===za.opType){const jf=Object(w.a)(dk,za),Ke=this.GCk(jf,rb);var Sd=Ke.node.characterData;const Je=10<=Ke.cpBegin?Ke.cpBegin-10:0;let Sh=Ke.cpEnd+10<=Sd.length?Ke.cpEnd+10:Sd.length;const sc=Sd.substr(Je,Ke.cpBegin-Je),mg=Sd.substr(Ke.cpEnd,Sh-Ke.cpEnd);Sh=Sh+jf.ilb.length-(Ke.cpEnd-Ke.cpBegin);var de=
new um(Ke.node.id,Je,Sh,sc+jf.ilb+mg);const Lc=6===jf.opType;Sd="";Lc&&(Sd=jf.font);if(!this.$rn(Ke,jf.ilb,Lc,Sd,yc))return!1;let Pj;Pj=1===za.opType?new Kg(jf,rb.id):new Oj(jf,rb.id);rb.oka=za.y_;jf.U3a=de;za.n5=Pj;Zb.gGf(Pj);null!=this.Isb&&this.Isb.qde(Pj)}else return 4===za.opType?this.Vbk(za,rb,Zb):!1}finally{Vc&&Vc.dispose()}return!0}Vbk(za,rb,Zb){const yc=Object(w.a)(rj,za);var Vc=this.vtb.NNa(rb.characterData,rb.qa);Vc=this.vtb.Owb(Vc,yc.offset);if(!this.dfi(gc.a.createTextRange(rb,0,nc.ParagraphReader.textLength(rb))))return!1;
var Sd=wg.GraphIterator.$a(rb);Sd.Bb(10);if(this.A6b(Sd))return!1;let de;Sd=this.dia.Rc(3);try{Sd.Db(rb);const jf=rb.IX();try{const Ke=wg.GraphIterator.$a(rb);Ke.Bb(10);Ke.kd(11);let Je=Ke.currentNode;yc.FZb()&&(Ke.kpf?Je=null:(Ke.QG(),Je=Ke.currentNode));Ke.nc();const Sh=this.Jrc.$wb();Ke.SG(Sh,Je,89);Ke.Ci(Sh);de=rb.clone();const sc=de.IX();try{de.setValue(Tf.a.Mc,yc.iqo);de.setValue(Tf.a.mj,yc.y9i);de.isDirty=!1;Ke.Sf(de,2);Ke.Ci(de);this.uEk(rb,de);const mg=yc.FZb()?de:rb,Lc=yc.FZb()?rb:de;mg.qN=
!0;Lc.qN=!0;this.Aha.aSf(this.Oab(mg,Vc,nc.ParagraphReader.textLength(mg)),"",!1,"");this.Aha.aSf(this.Oab(Lc,0,Vc),"",!1,"");rb.oka=yc.q5n;de.oka=yc.y9i}finally{sc&&sc.dispose()}}finally{jf&&jf.dispose()}Sd.Z1a()}finally{Sd&&Sd.dispose()}rb=new ul(yc,rb.id,de.id);za.n5=rb;Zb.gGf(rb);null!=this.Isb&&this.Isb.qde(rb);return!0}A6b(za){const rb=new wg.GraphIterator;rb.fd(za);rb.kd(11);return bm.ListReader.$h(rb)?(l.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}J7k(za,
rb,Zb){var yc=rb.udb(za.Mc);if(yc.equals(Ge.a.nil))return null;yc=Zb.Eb(yc);if(!yc||!nc.ParagraphReader.oc(yc)||!yc.isConnected)return null;const Vc=wg.GraphIterator.$a(yc);if(!Vc.Bb(23))return null;if(za.Q9f){za=rb.udb(za.Q9f);if(za.equals(Ge.a.nil))return null;Zb=Zb.Eb(za);if(!Zb||!nc.ParagraphReader.oc(Zb)||!Zb.isConnected)return null;Zb=wg.GraphIterator.$a(Zb);if(!Zb.Bb(23))return null;Zb.kd(11);Zb.QG();Zb.Wd();if(Zb.currentNode!==yc)return null}return this.A6b(Vc)?null:Vc}a$n(za,rb,Zb,yc){const Vc=
rb.currentNode,Sd=this.dia.Rc(3);try{Sd.Db(Vc);rb.kd(11);const de=rb.currentNode;rb.nc();const jf=this.Jrc.$wb();rb.SG(jf,de,89);rb.Ci(jf);const Ke=In.a.instance.createInstance(393230),Je=Ke.IX();try{Ke.setValue(nf.a.lo,""),Ke.RBa=!0,yc.MHb(Ke),yc=[0],Ke.setValue(Tf.a.Fq,yc),Ke.setValue(Tf.a.Zs,yc),Ke.RBa=!1,Ke.setValue(Tf.a.Mc,za.kCf),Ke.setValue(Tf.a.mj,za.jCf),Ke.isDirty=!1,rb.Sf(Ke,2),Ke.qN=!0,Ke.oka=za.jCf}finally{Je&&Je.dispose()}Sd.Z1a();za.n5=new ch(za,Ke.id);Zb.gGf(za.n5);null!=this.Isb&&
this.Isb.qde(za.n5)}finally{Sd&&Sd.dispose()}return!0}Oab(za,rb,Zb){return rb===Zb?gc.a.Uc(za,rb):gc.a.createTextRange(za,rb,Zb)}$rn(za,rb,Zb,yc,Vc=null){const Sd=za.node;if(za.cpBegin!==za.cpEnd&&!this.dfi(za))return Vc&&Vc.properties.Z(vk.Edj,"1"),!1;Vc=this.dia.Rc(3);try{Vc.Db(Sd);const de=Sd.IX();try{Sd.qN=!0,this.Aha.aSf(za,rb,Zb,yc)}finally{de&&de.dispose()}Vc.Z1a()}finally{Vc&&Vc.dispose()}return!0}uEk(za,rb){rb.RBa=!0;rb.iva(za.characterData);rb.oka=za.oka;rb.qa.clear();for(var Zb=0;Zb<za.qa.length;Zb++){const yc=
za.qa.J(Zb).qra(rb);rb.qa.add(yc)}rb.qn();if(rb.wordRunProperties.length)for(za=0;za<rb.qa.length;za++){if((Zb=rb.qa.J(za).formatting)&&-1!==Zb.Fe)for(;rb.wordRunProperties.length<=Zb.Fe;)rb.wordRunProperties.xZ(rb.wordRunProperties.length-1,256)}else l.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");rb.RBa=!1}dtf(za){za=wg.GraphIterator.$a(za);za.Bb(23);za.nc();return{returnValue:89===za.role,iterator:za}}fRf(za){const rb=new wg.GraphIterator;rb.fd(za);
rb.nc();const Zb=this.dia.Rc(3);try{Zb.Db(rb.currentNode),za.Fg()}finally{Zb&&Zb.dispose()}}Amn(za){if(za.anchor)if(({iterator:rb}=this.dtf(za)).returnValue)this.fRf(rb);else{var rb=za.Nc.Im;var Zb=this.dia.Rc(3);try{Zb.Db(za),za.load(rb.Eb(za.id)),za.anchor.JW(4)}finally{Zb&&Zb.dispose()}}}BTf(za,rb,Zb){for(let Sd=rb.count-1;0<=Sd;Sd--){var yc=rb.J(Sd);switch(yc.opType){case 4:yc=Object(w.a)(ul,yc);if(!za.id.equals(yc.c8d)){l.ULS.shipAssertTag(9204885,355,za.id.equals(yc.pCc));continue}yc=Zb.Eb(yc.pCc);
if(!yc)break;if(!yc||!nc.ParagraphReader.oc(yc)){l.ULS.shipAssertTag(9204886,355,!1);break}if(!yc.isConnected)continue;var Vc=({iterator:yc}=this.dtf(yc)).returnValue;l.ULS.shipAssertTag(9204887,355,Vc);Vc&&this.fRf(yc);break;case 2:(yc=Object(w.a)(ch,yc),za.id.equals(yc.paragraphId))?za.isConnected&&(Vc=({iterator:yc}=this.dtf(za)).returnValue,l.ULS.shipAssertTag(16820002,355,Vc),Vc&&this.fRf(yc)):l.ULS.shipAssertTag(16820001,355,!1)}}}GCk(za,rb){const Zb=this.vtb.NNa(rb.characterData,rb.qa),yc=
this.vtb.Owb(Zb,za.yQ);za=this.vtb.Owb(Zb,za.N2);return yc===za?gc.a.Uc(rb,yc):gc.a.createTextRange(rb,yc,za)}dfi(za){const rb=za.node.qa,Zb=za.cpBegin;za=za.cpEnd;for(let yc=0;yc<rb.length;yc++){const Vc=rb.J(yc);if(Vc.cp>=za)break;if(Vc.cp>=Zb){if(Vc.Ff)return l.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(Vc.blob)return l.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(Vc.af||Vc.$fb||Vc.L5b)return l.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}vk.DBi="ParagraphAlreadyDirty";vk.Edj="UnsafeWetChange";Object(m.a)(vk,"RttEditor",null,[669]);var Vh=d(1414),zd=d(249);class Za{constructor(){this.A5c=new N.a}add(za){this.A5c.add(za);return!0}WFd(za){const rb=new N.a;for(let Zb of this.A5c)za(Zb)&&rb.add(Zb);return rb}wQf(za){za.activity.nEf("dried");this.A5c.remove(za)}zQf(za){za.activity.nEf("expired");this.A5c.remove(za)}}Object(m.a)(Za,"RttAddParagraphDataStore",null,[]);
class Cb extends Kc{constructor(za,rb,Zb,yc,Vc,Sd,de,jf){super(2,jf);this.Mc=za;this.mj=rb;this.y_=Zb;this.Q9f=yc;this.kCf=Vc;this.jCf=Sd;this.IG=de}serialize(){const za=new ke.a(2,this.Mc,this.mj,null,this.Q9f,null,null,this.IG),rb=new hb(this.y_,this.kCf,this.jCf);return new Ob(this.metadata.packetId,this.metadata.clientId,1,3,za,null,void 0,void 0,rb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){const rb=za.lS,Zb=za.lWb;let yc=null;null!=za.lS.VCa&&(yc=za.lS.VCa);
return new Cb(rb.LNa,rb.g3a,Zb.J3f,yc,Zb.IIf,Zb.y_,rb.IG,Ne.create(za))}static rFl(za,rb){return 3!==za.type?null:new Cb(za.xma.Mc,za.xma.mj,za.dJm.mj,za.sNa?za.sNa.Mc:null,za.Zta.Mc,za.Zta.mj,za.IG,rb)}}Object(m.a)(Cb,"RttAddParagraphOp",Kc,[]);class Rb{constructor(za){this.AU=za}fJi(){this.AU&&this.AU.properties.Z(Rb.LEh,"1")}Xen(za){this.AU&&(this.AU.properties.xb(Rb.zzf)||this.AU.properties.Z(Rb.zzf,(za-this.AU.startTime).toString()))}nEf(za){this.AU&&(this.AU.properties.Z(Rb.LNi,za),this.AU.end())}jgn(za){this.AU&&
this.AU.properties.Z(Rb.LAi,za.toString())}ign(za){this.AU&&this.AU.properties.Z(Rb.eAi,za)}static Dlf(za){za.l3(le.a.vIb,Rb.LEh,Vh.a.F7i);za.l3(le.a.vIb,Rb.R4k,Vh.a.F7i);za.l3(le.a.vIb,Rb.zzf,Vh.a.ofk);za.l3(le.a.vIb,Rb.LNi,Vh.a.Dra);za.l3(le.a.vIb,Rb.LAi,Vh.a.Dra);za.l3(le.a.vIb,Rb.eAi,Vh.a.Dra)}static create(za){if(!za)return null;za=za.oo(le.a.vIb,Rb.bpo);return new Rb(za)}}Rb.LEh="FailedToFindInitialParaID";Rb.R4k="FailedToFindInitialTextID";Rb.zzf="MsecUntilApplied";Rb.LNi="RemovedBecause";
Rb.LAi="PacketVersions";Rb.eAi="OperationType";Rb.bpo=48E4;Object(m.a)(Rb,"RttOpActivity",null,[]);var pc;(function(za){za[za.unknown=0]="unknown";za[za.zGo=1]="replaceTextRangeOp";za[za.Uxo=2]="addParagraphOp";za[za.Rzo=3]="deleteParagraphOp";za[za.yIo=4]="splitParagraphOp";za[za.hEo=5]="mergeParagraphOp";za[za.yGo=6]="replaceSymbolRangeOp"})(pc||(pc={}));Object(m.b)("RttOpType",pc);var Rc=d(134);class wb extends dk{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh){super(yc,Vc,Sd,de,jf,Ke,Je,Sh,6);this.font=
za;this.legacy=rb}$gf(){return"OffsetStart: "+this.yQ+"OffsetEnd: "+this.N2}serialize(){const za=this.Ith();return new Ob(this.metadata.packetId,this.metadata.clientId,1,7,za,null,this.y_,this.ilb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){let rb,Zb,yc,Vc;if(!({yQ:rb,N2:Zb,Mc:yc,mj:Vc}=dk.Gbj(za)).returnValue)return null;let Sd,de;if(1===za.text.length)Sd=!1,de=Rc.AParagraphNode.tB;else if(2===za.text.length)if(oa.a.Jbi(za.text,0)&&oa.a.Ky(za.text,1))Sd=
!0,de=za.text;else return l.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",za.iu),null;else return l.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",za.iu),null;const jf=za.M0c,Ke=Ne.create(za);return new wb(jf.l2f,jf.m2f,Sd,yc,Vc,rb,Zb,za.JKb,de,za.lS.IG,Ke)}}Object(m.a)(wb,"RttReplaceSymbolRangeOp",dk,[667,687]);class Td extends dk{constructor(za,rb,Zb,yc,Vc,Sd,de,jf){super(za,rb,Zb,
yc,Vc,Sd,de,jf,1)}$gf(){return"OffsetStart: "+this.yQ+"OffsetEnd: "+this.N2+"TextAddedLength: "+this.ilb.length}serialize(){const za=this.Ith();return new Ob(this.metadata.packetId,this.metadata.clientId,1,2,za,null,this.y_,this.ilb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){let rb,Zb,yc,Vc;if(!({yQ:rb,N2:Zb,Mc:yc,mj:Vc}=dk.Gbj(za)).returnValue)return null;let Sd="";za.text&&(Sd=za.text);const de=Ne.create(za);return new Td(yc,Vc,rb,Zb,za.JKb,Sd,za.lS.IG,
de)}static sEl(za,rb,Zb){if(za.type)return null;const yc=Zb.NNa(za.O2.characterData,za.O2.qa);return new Td(za.O2.Mc,za.O2.mj,Zb.yhc(yc,za.cpBegin),Zb.yhc(yc,za.cpEnd),za.Zta.mj,za.$ta,za.IG,rb)}}Object(m.a)(Td,"RttReplaceTextRangeOp",dk,[667,687]);class sd{constructor(za,rb,Zb,yc,Vc,Sd,de,jf,Ke,Je,Sh,sc,mg,Lc,Pj,Vk,th,Wh,jg,Ui,Wl){this.Mq=null;this.Zte=this.e4g=!1;this.n9c=!0;this.W8c=!1;this.cRg=0;this.LYg=this.lFe=this.NYg=this.KYg=this.MYg=this.q_g=!1;this.OGf=()=>{l.ULS.sendTraceTag(7685328,
355,50,"All prerequisite ready for RttManager");this.Mq=this.Dca.result;l.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Mq.j1(this.taa)};this.taa=(ef,Wg)=>{if(3===Wg.type||this.W8c&&10===Wg.type)if(this.W8c&&10===Wg.type)this.cRg="boolean"===typeof Wg.WI?Wg.WI?1:0:Wg.WI;else if(this.NRb.value&&!this.NRb.value.IJd)l.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(Wg.WI){if(this.ugn(),(ef=this.TRk(Wg.WI))&&1!==ef.metadata.clientType){this.tgn();
if(this.Bo&&!this.Bo.T$&&(v.AFrameworkApplication.Hf("1i00j689;ba0dg262"),this.q_g))return;if(!this.W8c||2!==this.cRg)switch(this.JTb&&this.n9c&&(this.ITb.rJi(),this.n9c=!1),this.e4g||this.i0l(),ef.opType){case 1:case 6:case 4:if(!({Cg:ef}=this.R_j(ef)).returnValue)break;this.y1g?this.zTi(ef):this.Icj(ef);break;case 2:this.Aic.add(ef),this.c6h(ef),this.y1g?this.zTi(Ge.a.nil):this.Hcj(ef)}}}else l.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.B3k=()=>{const ef=this.zi.value;if(ef){var Wg=
this.aA()-sd.Lmn,uh=this.cob.WFd(zg=>zg.metadata.X3f<Wg);0<uh.count&&this.Yen();var Qj=new zd.a;for(let zg of uh)if(this.cob.zQf(zg),zg.n5)switch(zg.n5.opType){case 1:Qj.add(zg.n5.paragraphId.toString());break;case 6:Qj.add(zg.n5.paragraphId.toString());break;case 4:Qj.add(zg.n5.c8d.toString()),Qj.add(zg.n5.pCc.toString())}uh=this.Aic.WFd(zg=>zg.metadata.X3f<Wg);for(let zg of uh)this.Aic.zQf(zg),zg.n5&&Qj.add(zg.n5.paragraphId.toString());for(let zg of Qj)(Qj=ef.Eb(Ge.a.Of(zg)))?Qj.qN?(this.Hsb.Amn(Qj),
Qj.qN||this.vqc.value.bNi(Qj)):l.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):l.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.zi.UJd&&l.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.Hsb=za;this.cob=rb;this.vqc=Zb;this.NRb=yc;this.DH=Vc;this.Dca=Sd;this.zi=de;this.Hb=jf;this.aA=Ke;this.vtb=Je;this.ld=Sh;this.NBe=mg;this.Hc=Lc;this.y1g=Pj;this.ITb=Vk;this.JTb=
!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1);this.cnb=th;this.xLe=Wh;this.Dsc=new Ek.a(Ya.a.Pj());this.Aic=new Za;sc.execute(sd.Dlf);this.W8c=jg;this.q_g=Ui;this.Bo=Wl}i0l(){const za=new ta.a(3,2,sd.Kon,this.B3k);this.Hb.$b(za);this.e4g=!0}init(){return this.Dca?this.Dca.continueWith(this.OGf):G.Task.W9(!1)}TRk(za){za=Xc(za);if(!za)return null;switch(za.iu){case 2:return Td.create(za);case 7:return wb.create(za);
case 4:return rj.create(za);case 3:return Cb.create(za);default:return l.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",za.iu),null}}R_j(za){let rb=Ge.a.nil;if(!this.cob.Q_j(za))return{returnValue:!1,Cg:rb};this.c6h(za);if(!this.DH)return{returnValue:!1,Cg:rb};const Zb=this.DH.udb(za.Mc);if(Zb.equals(Ge.a.nil)||!this.zi.value.Eb(Zb))return za.activity.fJi(),{returnValue:!1,Cg:rb};this.uJi();return{returnValue:!0,Cg:Zb}}zTi(za){za.equals(Ge.a.nil)||this.Dsc.add(za.toString());
this.Zte||(za=new ta.a(0,1,200,()=>{this.Pao();this.Zte=!1},71),this.Hb.$b(za),this.Zte=!0)}sAn(za){za=new ta.a(0,1,0,za,71);this.Hb.$b(za)}c6h(za){za.activity=Rb.create(this.ld);za.activity.jgn(za.metadata.packetVersion);za.activity.ign(pc[za.opType])}Pao(){var za=this.Aic.WFd(Zb=>!Zb.n5);for(let Zb of za)this.Hcj(Zb);if(this.Dsc.count){za=null;for(var rb of this.Dsc){rb=Ge.a.Of(rb);za=this.zi.value.Eb(rb);break}rb=this.Hc.Rc(3);try{rb.Db(za);for(let Zb of this.Dsc)this.Icj(Ge.a.Of(Zb))}finally{rb&&
rb.dispose()}this.Dsc.clear()}}Icj(za){za=this.zi.value.Eb(za);let rb;const Zb=this.Hc.Rc(3);try{Zb.Db(za);rb=this.ld.oo(le.a.ybh);const yc=this.Cbh(za,rb);rb.end();yc&&this.F2j(yc)}finally{Zb&&Zb.dispose(),this.JTb&&(this.ITb.UOf(1),this.n9c=!0)}}Hcj(za){var rb=this.Hsb.J7k(za,this.DH,this.zi.value);rb&&(this.uJi(),this.Hsb.a$n(za,rb,this.cnb,ea.a.instance.resolve("Box4.IParagraphEditor"))&&(rb=this.zi.value.Eb(za.n5.paragraphId),this.Vbh(rb,za),this.JTb&&(this.ITb.UOf(1),this.n9c=!0)))}F2j(za){this.NBe.continueWith(()=>
{if(1===za.opType){var rb=this.DCl(za);rb&&(this.NBe.result.bNe(rb),this.NBe.result.F2d(!0))}})}DCl(za){const rb=za.serialize();if(2!==rb.iu||rb.lS.VCa&&rb.lS.LNa!==rb.lS.VCa)return null;const Zb=za.yQ.clone();0<za.ilb.length&&(Zb.Klh(),Zb.cp+=za.ilb.length);rb.iu=0;rb.text=null;rb.lS.u1d=0;rb.lS.yQ=Zb;rb.lS.g3a=rb.JKb;rb.lS.VCa=null;rb.lS.Afc=null;rb.lS.N2=null;rb.JKb=null;return pd.tZe(rb,this.DH,this.vtb,()=>this.zi.value,this.xLe.instance)}Vbh(za,rb){return this.vqc.value?this.vqc.value.HZj(za,
rb.metadata.clientId).returnValue?!0:(l.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(l.ULS.shipAssertTag(7866378,355,!!this.vqc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}Bbh(za,rb){this.Cbh(za,rb)}Cbh(za,rb){if(!za)return null;if(!za.anchor)return rb&&rb.properties.Z(sd.rsi,"1"),null;if(!za.hasProperty(Tf.a.Mc))return l.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!za.hasProperty(Tf.a.mj))return l.ULS.sendTraceTag(8197722,
355,15,"Paragraph is missing the TextId property"),null;if(za.hasProperty(Tf.a.wyh)&&za.getValue(Tf.a.wyh))return l.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Zb=za.getValue(Tf.a.Mc);var yc=za.oka;rb&&(rb.properties.Z(sd.XJm,yc.toString()),rb.properties.Z(sd.ZJm,Zb.toString()));yc=this.cob.sef(Zb,yc);if(!yc)return rb&&rb.properties.Z(sd.esi,"1"),null;if(!this.Vbh(za,yc))return rb&&rb.properties.Z(sd.Qqh,"1"),null;let Vc=0,Sd=null;for(;yc;){if(!this.Hsb.Wbk(yc,za,
this.cnb,rb)){rb&&rb.properties.Z(sd.Gjj,"1");break}Vc++;yc.activity.Xen(this.aA());Sd=yc;yc=za.oka;yc=this.cob.sef(Zb,yc)}0<Vc&&this.NIi();rb&&rb.properties.add(sd.Hjj,Vc.toString());return Sd}j2d(za){if(za.hasProperty(Tf.a.Mc)&&za.hasProperty(Tf.a.mj)){var rb=za.getValue(Tf.a.Mc),Zb=za.ia(Tf.a.mj,0),yc=this.ld.oo(le.a.iLi),Vc=this.cnb.SQm(za.id);0<Vc.count&&(this.Hsb.BTf(za,Vc,this.zi.value),this.gnn(za,Vc,Zb));var Sd=this.cnb.Nel(rb);if(Sd&&!za.id.equals(Sd.paragraphId)){const de=this.zi.value;
this.sAn(()=>{const jf=this.cnb.Khb(Sd.paragraphId),Ke=de.Eb(Sd.paragraphId);l.ULS.shipAssertTag(16820032,355,!!Ke,"Could not find added graph node");Ke&&(this.Hsb.BTf(Ke,jf,de),this.Aic.wQf(Sd.cNe))})}this.cob.sef(rb,Zb)||this.vqc.value.bNi(za);this.Bbh(za,yc);yc.end()}}gnn(za,rb,Zb){let yc=!1;for(let Sd=rb.count-1;0<=Sd;Sd--){var Vc=rb.J(Sd);switch(Vc.opType){case 1:case 6:case 4:Vc=Object(w.a)(667,Vc.operation);break;default:continue}Vc.y_===Zb&&(yc=!0,Vc.U3a&&!Vc.U3a.Ymo(za)&&l.ULS.sendTraceTag(8765831,
355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",Vc.opType,Vc.$gf(),za.id,Vc.U3a.id,Vc.U3a.cpBegin,Vc.U3a.cpEnd));yc&&this.cob.wQf(Vc)}yc&&this.NIi()}TSc(za){const rb=this.cnb.Khb(za.id);0<rb.count&&(2===rb.J(0).opType&&rb.removeAt(0),this.Hsb.BTf(za,rb,this.zi.value))}E6d(za){var rb=this.cnb.Azl(za.id);for(let Zb of rb)if(4===Zb.opType&&(rb=Object(w.a)(ul,Zb),za.id.equals(rb.hZj)))return!0;return!1}ugn(){this.MYg||
(l.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.MYg=!0)}tgn(){this.KYg||(l.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.KYg=!0)}uJi(){this.NYg||(l.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.NYg=!0)}NIi(){this.lFe||(l.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.lFe=!0)}Yen(){this.lFe||this.LYg||(l.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.LYg=!0)}static Dlf(za){const rb=
[le.a.ybh,le.a.iLi];for(let Zb of rb)za.l3(Zb,sd.Hjj,Vh.a.Dra),za.l3(Zb,sd.esi,Vh.a.Dra),za.l3(Zb,sd.rsi,Vh.a.Dra),za.l3(Zb,sd.Qqh,Vh.a.Dra),za.l3(Zb,sd.Gjj,Vh.a.Dra),za.l3(Zb,vk.DBi,Vh.a.Dra),za.l3(Zb,vk.Edj,Vh.a.Dra);Rb.Dlf(za)}}sd.Kon=6E4;sd.Lmn=18E4;sd.Hjj="WetChangeCount";sd.esi="NoChangesToApply";sd.rsi="NodeNotConnected";sd.Qqh="CouldNotGetLock";sd.Gjj="WetChangeBlocked";sd.ZJm="NodeWordId";sd.XJm="NodeTextId";Object(m.a)(sd,"RttManager",null,[668]);class Me{constructor(za,rb){this.hSi=0;this.Kdb=
za;this.ryn=rb}rJi(){this.hSi=this.Kdb()}UOf(za){const rb=this.Kdb()-this.hSi;0<=rb&&this.ryn.track(Math.round(rb),0===za?"CTB":"RTP")}}Object(m.a)(Me,"RttPerfCounter",null,[666]);var tf=d(1834);class Pf{constructor(){this.iuc=new tf.a}m3j(za,rb){this.iuc.back()&&rb&&this.iuc.back().pab(za)||this.iuc.enqueue(za)}jyl(){return this.iuc.isEmpty?null:this.iuc.dequeue()}}Object(m.a)(Pf,"RttSendDataStore",null,[665]);class Yh extends Kc{constructor(za,rb,Zb,yc){super(3,yc);this.Mc=za;this.mj=rb;this.IG=
Zb}get y_(){return 0}serialize(){const za=new ke.a(4,this.Mc,this.mj,null,null,null,null,this.IG);return new Ob(this.metadata.packetId,this.metadata.clientId,1,5,za,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){const rb=za.lS;return new Yh(rb.LNa,rb.g3a,rb.IG,Ne.create(za))}static sFl(za,rb){return 4!==za.type?null:new Yh(za.s_b.Mc,za.s_b.mj,za.IG,rb)}}Object(m.a)(Yh,"RttDeleteParagraphOp",Kc,[667,687]);class ti extends Kc{constructor(za,
rb,Zb,yc,Vc,Sd,de,jf){super(5,jf);this.P9f=za;this.x9i=rb;this.hqo=Zb;this.r5n=yc;this.IG=Vc;this.tkj=Sd;this.Bfc=de}get Mc(){return this.P9f}get mj(){return this.x9i}get y_(){return this.P9f===this.tkj?this.Bfc:0}serialize(){const za=new ke.a(5,this.P9f,this.x9i,null,this.hqo,this.r5n,null,this.IG),rb=new Ib(this.tkj,this.Bfc);return new Ob(this.metadata.packetId,this.metadata.clientId,1,6,za,null,void 0,void 0,void 0,rb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(za){const rb=
za.lS,Zb=za.iRc;return new ti(rb.LNa,rb.g3a,rb.VCa,rb.Afc,rb.IG,Zb.HIf,Zb.Bfc,Ne.create(za))}static tFl(za,rb){return 2!==za.type?null:new ti(za.xma.Mc,za.xma.mj,za.sNa.Mc,za.sNa.mj,za.IG,za.ATd.Mc,za.ATd.mj,rb)}}Object(m.a)(ti,"RttMergeParagraphOp",Kc,[667,687]);class Fh{constructor(za,rb,Zb,yc,Vc,Sd){this.Nuc=this.ij=null;this.jca=!1;this.nJe=this.X1g=0;this.Tld=this.g3g=!1;this.nEe=0;this.OGf=()=>{l.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.ij=this.Dca.result;
this.ij.R1d(this)};this.txi=(de,jf)=>{if(this.ij&&2===this.ij.connectionState&&(de=jf.sF,de.length))if(jf.p9)100>this.nJe&&(this.nJe++,l.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",jf.Vgk,this.X1g,this.nJe));else{for(jf=0;jf<de.length;jf++)if(!this.clm(de[jf]))return;for(jf=0;jf<de.length;jf++){let Ke=de[jf];this.LXg.m3j(Ke,!Ke.type&&!jf)}this.Nuc||this.$wi(this.Nuc,this.ij)}};this.Dca=za;this.LXg=rb;this.nca=Zb;this.mt=yc;this.Iqa=Vc;this.ITb=
Sd;this.JTb=!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1)}get Ep(){return this.nca.value}init(){return this.Dca?this.Dca.continueWith(this.OGf):G.Task.W9(!1)}start(){this.jca||(this.mt.Zc?(this.mt.Zc.sF.c7j(this.txi),this.jca=!0):l.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.jca&&(this.jca=!1,this.mt.Zc.sF.bqn(this.txi))}clm(za){return za&&-1!==za.IG?za.type&&3!==
za.type&&1!==za.type?!1:!0:!1}jzm(){this.Tld||(this.g3g||(l.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.g3g=!0),!this.Tld&&5>=this.nEe&&this.nEe++)}xzm(){!this.Tld&&5>=this.nEe&&(l.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.Tld=!0)}$wi(za,rb){this.jzm();za&&(za.Ii||za.ho)&&l.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",za.exception);this.JTb&&this.ITb.rJi();(za=this.uFl(this.LXg.jyl()))?(this.X1g++,this.Nuc=rb.kO(3,xe(za.serialize())),
this.xzm(),this.JTb&&this.ITb.UOf(0),this.Nuc.continueWith(Zb=>{this.$wi(Zb,rb)})):this.Nuc=null}uFl(za){if(!za)return null;if(!this.Ep)return l.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const rb=new Ne(ci.instance.mTh(),this.Ep.pj,1,0,0,xd.instance.wyl());let Zb=null;switch(za.type){case 0:Zb=Td.sEl(za,rb,this.Iqa);break;case 4:Zb=Yh.sFl(za,rb);break;case 3:Zb=Cb.rFl(za,rb);break;case 2:Zb=ti.tFl(za,rb);break;case 1:Zb=rj.vFl(za,
rb,this.Iqa)}return Zb}}Object(m.a)(Fh,"RttSendManager",null,[663]);class Pg{constructor(){this.W=null;this.qwl=()=>Oa.App.rd&&Oa.App.rd.Jq?Oa.App.rd.Jq:(l.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}zc(za){const rb=da.a.Iq(za.Za("Box4.IOutlineElementEditor")),Zb=da.a.Iq(za.Za("Box4.IFeatureHelper")),yc=da.a.Iq(za.Za("Common.IActivityAggregationInfo")),Vc=da.a.Iq(za.Za("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),
Sd=da.a.Iq(za.Za("Box4.CompositionStateManager"));this.W=za;const de=new gg.a;G.Task.WAA.call(null,rb,Zb,yc,Vc,Sd).continueWith(()=>{za.ha("WordEditor.RealTimeTyping.IRttEditor",()=>new vk(za.resolve("Box4.ICharacterPropertiesEditor"),za.resolve("Box4.IOutlineElementEditor"),de,za.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();za.register(Me,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Xd(()=>new Me(Ye.a.lf,Pi.a.lF(17,
1,new jk.a(new Cf.a(.25)))));za.ha("WordEditor.RealTimeTyping.RttManager",()=>new sd(za.resolve("WordEditor.RealTimeTyping.IRttEditor"),new xh(im.a.instance),new L.a(this.qwl),new L.a(()=>Oa.App.A_),za.resolve("WordEditor.ParagraphWordIdMapping"),za.resolve("Box4.Presence.IRtcProxyProvider").iI(),new L.a(()=>Oa.App.xa.jb&&Oa.App.xa.jb.Zc?Oa.App.xa.jb.Zc.Ad:(l.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),zb.a.instance,()=>Date.now(),za.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
im.a.instance,za.Za("Common.IActivityAggregationInfo"),Od.iI(),de,v.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),za.resolve("WordEditor.IRttPerfCounter"),new vl,za.Za("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.DisableRttInFluid",!1),v.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.SkipUpdateGraphWhenComposing",!1),za.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();
za.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new Fh(za.resolve("Box4.Presence.IRtcProxyProvider").iI(),new Pf,new L.a(()=>Oa.App.rd),Oa.App.xa.jb,za.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),za.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.Elf()})}Elf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){sa.a.instance.Pc(new Pg)}}Object(m.a)(Pg,
"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ja.main();Type.registerNamespace("Common.App.CollabControls");Ea.prototype.toString=Pa.a.prototype.toString;
Ia.prototype.toString=Pa.a.prototype.toString;sa.a.instance.Pc(new fh);Pg.main();Type.registerNamespace("RealtimePresenceUI");sa.a.instance.Pc(new Ec);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");Ca.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/16261146/wdjs/WordEditorDS.collab.js.map